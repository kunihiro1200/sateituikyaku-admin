# Design Document

## Overview

å…¬é–‹ç‰©ä»¶ã‚µã‚¤ãƒˆã®è©³ç´°ç”»é¢ã«ãŠã„ã¦ã€ã€ŒãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã€ã¨ã€Œã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã€ãŒè¡¨ç¤ºã•ã‚Œãªããªã£ãŸå•é¡Œã‚’è¨ºæ–­ãƒ»ä¿®æ­£ã—ã¾ã™ã€‚æ—¢å­˜ã®å®Ÿè£…ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã¯æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®è¡¨ç¤ºã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## Architecture

### ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PublicPropertyDetailPage                    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PropertyImageWithFavoriteComment                     â”‚  â”‚
â”‚  â”‚  - ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã‚’ç”»åƒä¸Šã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º          â”‚  â”‚
â”‚  â”‚  - GET /api/public/properties/:id/favorite-comment    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³                                   â”‚  â”‚
â”‚  â”‚  - ä¾¡æ ¼ã€ä½æ‰€ã€é¢ç©ã€ç¯‰å¹´æ•°ãªã©                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AthomeSection                                        â”‚  â”‚
â”‚  â”‚  - Athomeæƒ…å ±ã‚’è¡¨ç¤º                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RecommendedCommentSection                            â”‚  â”‚
â”‚  â”‚  - ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã‚’è¡¨ç¤º                             â”‚  â”‚
â”‚  â”‚  - GET /api/public/properties/:id/recommended-comment â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Routes                                â”‚
â”‚  /api/public/properties/:id/favorite-comment                 â”‚
â”‚  /api/public/properties/:id/recommended-comment              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Services                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ FavoriteComment      â”‚  â”‚ RecommendedComment       â”‚    â”‚
â”‚  â”‚ Service              â”‚  â”‚ Service                  â”‚    â”‚
â”‚  â”‚ - å˜ä¸€ã‚»ãƒ«å–å¾—       â”‚  â”‚ - ã‚»ãƒ«ç¯„å›²å–å¾—           â”‚    â”‚
â”‚  â”‚ - B53/B142/B150      â”‚  â”‚ - B63:L79/B152:L166/     â”‚    â”‚
â”‚  â”‚                      â”‚  â”‚   B149:L163              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GoogleSheetsClient                              â”‚
â”‚  - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—                            â”‚
â”‚  - èªè¨¼å‡¦ç†                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Google Sheets API                               â”‚
â”‚  - æ¥­å‹™ãƒªã‚¹ãƒˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ                                â”‚
â”‚  - athomeã‚·ãƒ¼ãƒˆ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Components and Interfaces

### 1. FavoriteCommentServiceï¼ˆæ—¢å­˜ãƒ»ç¢ºèªæ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/src/services/FavoriteCommentService.ts`

**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:
```typescript
interface FavoriteCommentResult {
  comment: string | null;
  propertyType: string;
}

class FavoriteCommentService {
  async getFavoriteComment(propertyId: string): Promise<FavoriteCommentResult>
  private getCellPosition(propertyType: string): string | null
  private fetchCommentFromSpreadsheet(spreadsheetUrl: string, cellPosition: string): Promise<string | null>
  private extractSpreadsheetId(url: string): string | null
  private getCachedComment(propertyId: string): Promise<FavoriteCommentResult | null>
  private cacheComment(propertyId: string, result: FavoriteCommentResult): Promise<void>
}
```

**ã‚»ãƒ«ä½ç½®ãƒãƒƒãƒ”ãƒ³ã‚°**:
```typescript
const cellMap: Record<string, string> = {
  'åœŸåœ°': 'B53',
  'æˆ¸å»ºã¦': 'B142',
  'æˆ¸å»º': 'B142',
  'ãƒãƒ³ã‚·ãƒ§ãƒ³': 'B150',
  'land': 'B53',
  'detached_house': 'B142',
  'apartment': 'B150',
};
```

**å®Ÿè£…çŠ¶æ³**: âœ… æ­£ã—ãå®Ÿè£…æ¸ˆã¿

### 2. RecommendedCommentServiceï¼ˆæ—¢å­˜ãƒ»ç¢ºèªæ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/src/services/RecommendedCommentService.ts`

**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:
```typescript
interface RecommendedCommentResult {
  comments: string[][]; // è¡Œã”ã¨ã®ã‚³ãƒ¡ãƒ³ãƒˆé…åˆ—
  propertyType: string;
}

class RecommendedCommentService {
  async getRecommendedComment(
    propertyNumber: string,
    propertyType: string,
    propertyId?: string
  ): Promise<RecommendedCommentResult>
  private getCellRange(propertyType: string): string | null
  private fetchCommentsFromSheet(propertyNumber: string, cellRange: string): Promise<string[][]>
  private extractSpreadsheetId(url: string): string | null
  private getCachedComment(propertyId: string): Promise<RecommendedCommentResult | null>
  private cacheComment(propertyId: string, result: RecommendedCommentResult): Promise<void>
}
```

**ã‚»ãƒ«ç¯„å›²ãƒãƒƒãƒ”ãƒ³ã‚°**:
```typescript
const cellRangeMap: Record<string, string> = {
  'åœŸåœ°': 'B63:L79',
  'æˆ¸å»ºã¦': 'B152:L166',
  'æˆ¸å»º': 'B152:L166',
  'ãƒãƒ³ã‚·ãƒ§ãƒ³': 'B149:L163',
  'land': 'B63:L79',
  'detached_house': 'B152:L166',
  'apartment': 'B149:L163',
};
```

**å®Ÿè£…çŠ¶æ³**: âœ… æ­£ã—ãå®Ÿè£…æ¸ˆã¿ï¼ˆã‚»ãƒ«ç¯„å›²å¯¾å¿œï¼‰

### 3. PropertyImageWithFavoriteCommentï¼ˆæ—¢å­˜ãƒ»ç¢ºèªå¿…è¦ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/PropertyImageWithFavoriteComment.tsx`

**Props**:
```typescript
interface PropertyImageWithFavoriteCommentProps {
  propertyId: string;
  canDelete?: boolean;
  canHide?: boolean;
  showHiddenImages?: boolean;
  showFavoriteComment?: boolean;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true
}
```

**å®Ÿè£…çŠ¶æ³**: ğŸ” ç¢ºèªãŒå¿…è¦

### 4. RecommendedCommentSectionï¼ˆæ—¢å­˜ãƒ»ç¢ºèªæ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/RecommendedCommentSection.tsx`

**Props**:
```typescript
interface RecommendedCommentSectionProps {
  propertyId: string;
}

interface RecommendedCommentResponse {
  comments: string[][]; // è¡Œã”ã¨ã®ã‚³ãƒ¡ãƒ³ãƒˆé…åˆ—
  propertyType: string;
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… æ­£ã—ãå®Ÿè£…æ¸ˆã¿

### 5. PublicPropertyDetailPageï¼ˆæ—¢å­˜ãƒ»ç¢ºèªæ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/pages/PublicPropertyDetailPage.tsx`

**ç¾åœ¨ã®å®Ÿè£…**:
```typescript
// ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€
<PropertyImageWithFavoriteComment 
  propertyId={property.id} 
  canDelete={false}
  canHide={isAuthenticated}
  showHiddenImages={isAuthenticated}
  showFavoriteComment={true}  // âœ… æœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
/>

// ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆ
<RecommendedCommentSection propertyId={property.id} />  // âœ… é…ç½®ã•ã‚Œã¦ã„ã‚‹
```

**å®Ÿè£…çŠ¶æ³**: âœ… æ­£ã—ãé…ç½®æ¸ˆã¿

## Data Models

### FavoriteCommentResult

```typescript
interface FavoriteCommentResult {
  comment: string | null;      // ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ï¼ˆå˜ä¸€ãƒ†ã‚­ã‚¹ãƒˆï¼‰
  propertyType: string;         // ç‰©ä»¶ã‚¿ã‚¤ãƒ—
}
```

### RecommendedCommentResult

```typescript
interface RecommendedCommentResult {
  comments: string[][];         // è¡Œã”ã¨ã®ã‚³ãƒ¡ãƒ³ãƒˆé…åˆ—
                                // ä¾‹: [["ã‚³ãƒ¡ãƒ³ãƒˆ1", "ã‚³ãƒ¡ãƒ³ãƒˆ2"], ["ã‚³ãƒ¡ãƒ³ãƒˆ3"]]
  propertyType: string;         // ç‰©ä»¶ã‚¿ã‚¤ãƒ—
}
```

### ã‚»ãƒ«ç¯„å›²ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã¯ã‚»ãƒ«ç¯„å›²ã‹ã‚‰å–å¾—ã•ã‚Œã€ä»¥ä¸‹ã®ã‚ˆã†ã«å‡¦ç†ã•ã‚Œã¾ã™ï¼š

```
ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆä¾‹: åœŸåœ°ã®å ´åˆ B63:L79ï¼‰
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ B  â”‚ C  â”‚ D  â”‚ E  â”‚ F  â”‚ G  â”‚ H  â”‚ I  â”‚ J  â”‚ K  â”‚ L  â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ 63 â”‚é§…è¿‘â”‚    â”‚ä¾¿åˆ©â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â”‚ 64 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â”‚ 65 â”‚å­¦æ ¡â”‚è¿‘ã„â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â”‚... â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

â†“ å‡¦ç†å¾Œ

comments: [
  ["é§…è¿‘", "ä¾¿åˆ©"],      // 63è¡Œç›®ã®éç©ºã‚»ãƒ«
  ["å­¦æ ¡", "è¿‘ã„"],      // 65è¡Œç›®ã®éç©ºã‚»ãƒ«
]
```

## Correctness Properties

*ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®ã™ã¹ã¦ã®æœ‰åŠ¹ãªå®Ÿè¡Œã«ãŠã„ã¦çœŸã§ã‚ã‚‹ã¹ãç‰¹æ€§ã‚„å‹•ä½œã®ã“ã¨ã§ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€äººé–“ãŒèª­ã‚ã‚‹ä»•æ§˜ã¨æ©Ÿæ¢°ã§æ¤œè¨¼å¯èƒ½ãªæ­£ç¢ºæ€§ã®ä¿è¨¼ã¨ã®æ©‹æ¸¡ã—ã¨ãªã‚Šã¾ã™ã€‚*

### Property 1: ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®å–å¾—ã¨è¡¨ç¤º

*For any* å…¬é–‹ç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸ã«ãŠã„ã¦ã€ç‰©ä»¶IDãŒæœ‰åŠ¹ã§ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒå­˜åœ¨ã—ã€è©²å½“ã‚»ãƒ«ã«å€¤ãŒã‚ã‚‹å ´åˆã€ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ãŒç”»åƒã®ä¸Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 1.1, 1.2, 1.3, 1.4, 1.5**

### Property 2: ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã®ã‚»ãƒ«ç¯„å›²å–å¾—

*For any* ç‰©ä»¶ã‚¿ã‚¤ãƒ—ï¼ˆåœŸåœ°/æˆ¸å»ºã¦/ãƒãƒ³ã‚·ãƒ§ãƒ³ï¼‰ã«ãŠã„ã¦ã€æ­£ã—ã„ã‚»ãƒ«ç¯„å›²ï¼ˆB63:L79 / B152:L166 / B149:L163ï¼‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 2.2, 2.3, 2.4**

### Property 3: ã‚»ãƒ«ç¯„å›²ã®é€£çµå‡¦ç†

*For any* ã‚»ãƒ«ç¯„å›²ã«ãŠã„ã¦ã€ç©ºã§ãªã„ã‚»ãƒ«ã®ã¿ãŒæŠ½å‡ºã•ã‚Œã€è¡Œæ§‹é€ ã‚’ä¿æŒã—ãŸã¾ã¾é…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 2.5, 2.6**

### Property 4: ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã®è¡¨ç¤º

*For any* å…¬é–‹ç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸ã«ãŠã„ã¦ã€ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã€åŸºæœ¬æƒ…å ±ã®ä¸‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 2.7, 2.8**

### Property 5: ã‚¨ãƒ©ãƒ¼æ™‚ã®ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

*For any* ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLä¸åœ¨ã€API ã‚¨ãƒ©ãƒ¼ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã©ï¼‰ã«ãŠã„ã¦ã€ãƒšãƒ¼ã‚¸ã¯æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã€ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ãŒéè¡¨ç¤ºã«ãªã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 1.7, 2.9, 6.3, 6.5**

### Property 6: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å‹•ä½œ

*For any* ç‰©ä»¶IDã«ãŠã„ã¦ã€åˆå›å–å¾—å¾Œ5åˆ†é–“ã¯åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¿”ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 6.4**

### Property 7: ç‰©ä»¶ã‚¿ã‚¤ãƒ—ã®ãƒãƒƒãƒ”ãƒ³ã‚°

*For any* ç‰©ä»¶ã‚¿ã‚¤ãƒ—ï¼ˆæ—¥æœ¬èªã¾ãŸã¯è‹±èªè¡¨è¨˜ï¼‰ã«ãŠã„ã¦ã€æ­£ã—ã„ã‚»ãƒ«ä½ç½®ã¾ãŸã¯ã‚»ãƒ«ç¯„å›²ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹

**Validates: Requirements 4.2, 4.3**

## Error Handling

### ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã¨å¯¾å¿œ

| ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ª | å¯¾å¿œ | ãƒ­ã‚° | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿ |
|--------------|------|------|----------------|
| ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLä¸åœ¨ | nullè¿”å´ | âš ï¸ Warning | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |
| Google Sheets APIã‚¨ãƒ©ãƒ¼ | nullè¿”å´ | âŒ Error | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |
| ã‚»ãƒ«ãŒç©º | nullè¿”å´ | â„¹ï¸ Info | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | nullè¿”å´ | âŒ Error | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ©ãƒ¼ | ç„¡è¦–ã—ã¦ç¶šè¡Œ | âš ï¸ Warning | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ |
| ç‰©ä»¶ã‚¿ã‚¤ãƒ—ä¸æ˜ | nullè¿”å´ | â„¹ï¸ Info | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |
| èªè¨¼ã‚¨ãƒ©ãƒ¼ | nullè¿”å´ | âŒ Error | ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤º |

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®åŸå‰‡

1. **ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã§ãƒšãƒ¼ã‚¸ã¯æ­£å¸¸ã«è¡¨ç¤º
2. **è©³ç´°ãªãƒ­ã‚°**: ãƒ‡ãƒãƒƒã‚°ç”¨ã«è©³ç´°ãªæƒ…å ±ã‚’è¨˜éŒ²
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„
4. **ãƒªãƒˆãƒ©ã‚¤ãªã—**: ã‚¨ãƒ©ãƒ¼æ™‚ã¯å³åº§ã«nullã‚’è¿”ã™ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆï¼‰

## Testing Strategy

### è¨ºæ–­ãƒ•ã‚§ãƒ¼ã‚º

#### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIè¨ºæ–­

**ç›®çš„**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª

**ãƒ†ã‚¹ãƒˆé …ç›®**:
- [ ] `/api/public/properties/:id/favorite-comment` ãŒ200ã‚’è¿”ã™
- [ ] `/api/public/properties/:id/recommended-comment` ãŒ200ã‚’è¿”ã™
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« `comment` ã¾ãŸã¯ `comments` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã‚‹
- [ ] å„ç‰©ä»¶ã‚¿ã‚¤ãƒ—ï¼ˆåœŸåœ°/æˆ¸å»ºã¦/ãƒãƒ³ã‚·ãƒ§ãƒ³ï¼‰ã§æ­£ã—ã„ã‚»ãƒ«ä½ç½®/ç¯„å›²ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- [ ] ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒå­˜åœ¨ã—ãªã„å ´åˆã€nullã‚’è¿”ã™
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ï¼ˆ2å›ç›®ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé«˜é€Ÿï¼‰

**è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
```bash
# ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®å–å¾—ãƒ†ã‚¹ãƒˆ
curl http://localhost:3000/api/public/properties/{property-id}/favorite-comment

# ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã®å–å¾—ãƒ†ã‚¹ãƒˆ
curl http://localhost:3000/api/public/properties/{property-id}/recommended-comment
```

#### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºè¨ºæ–­

**ç›®çš„**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**ãƒ†ã‚¹ãƒˆé …ç›®**:
- [ ] `PropertyImageWithFavoriteComment` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹
- [ ] `showFavoriteComment` propãŒ `true` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹
- [ ] ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ãŒç”»åƒä¸Šã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `RecommendedCommentSection` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹
- [ ] ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹
- [ ] ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãŒåŸºæœ¬æƒ…å ±ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹

**è¨ºæ–­æ–¹æ³•**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
2. Networkã‚¿ãƒ–ã§APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª
3. Elementsã‚¿ãƒ–ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å­˜åœ¨ã‚’ç¢ºèª
4. Consoleã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

#### 3. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨ºæ–­

**ç›®çš„**: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**ãƒ†ã‚¹ãƒˆé …ç›®**:
- [ ] `property_listings.storage_location` ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã« `athome` ã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹
- [ ] ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®ã‚»ãƒ«ï¼ˆB53/B142/B150ï¼‰ã«å€¤ãŒå…¥ã£ã¦ã„ã‚‹
- [ ] ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã®ã‚»ãƒ«ç¯„å›²ï¼ˆB63:L79ãªã©ï¼‰ã«å€¤ãŒå…¥ã£ã¦ã„ã‚‹
- [ ] Google Sheets APIã®èªè¨¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹

### ä¿®æ­£ãƒ•ã‚§ãƒ¼ã‚º

#### Unit Tests

**FavoriteCommentService**:
```typescript
describe('FavoriteCommentService', () => {
  test('åœŸåœ°ç‰©ä»¶ã§B53ã‚»ãƒ«ã‹ã‚‰æ–‡è¨€ã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('æˆ¸å»ºã¦ç‰©ä»¶ã§B142ã‚»ãƒ«ã‹ã‚‰æ–‡è¨€ã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ãƒãƒ³ã‚·ãƒ§ãƒ³ç‰©ä»¶ã§B150ã‚»ãƒ«ã‹ã‚‰æ–‡è¨€ã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒãªã„å ´åˆã€nullã‚’è¿”ã™', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ­£ã—ãå‹•ä½œã™ã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });
});
```

**RecommendedCommentService**:
```typescript
describe('RecommendedCommentService', () => {
  test('åœŸåœ°ç‰©ä»¶ã§B63:L79ç¯„å›²ã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('æˆ¸å»ºã¦ç‰©ä»¶ã§B152:L166ç¯„å›²ã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ãƒãƒ³ã‚·ãƒ§ãƒ³ç‰©ä»¶ã§B149:L163ç¯„å›²ã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ç©ºã‚»ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦éç©ºã‚»ãƒ«ã®ã¿ã‚’è¿”ã™', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('è¡Œæ§‹é€ ã‚’ä¿æŒã™ã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });
});
```

#### Integration Tests

**ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ**:
```typescript
describe('å…¬é–‹ç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸', () => {
  test('ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ãŒç”»åƒã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãŒåŸºæœ¬æƒ…å ±ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });

  test('ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });
});
```

#### Property-Based Tests

å„correctness propertyã«å¯¾ã—ã¦ã€property-based testã‚’å®Ÿè£…ã—ã¾ã™ï¼ˆæœ€ä½100å›ã®åå¾©ï¼‰ã€‚

**Property 1ã®ãƒ†ã‚¹ãƒˆ**:
```typescript
// Feature: public-property-comments-display-fix, Property 1: ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®å–å¾—ã¨è¡¨ç¤º
test('Property 1: ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã®å–å¾—ã¨è¡¨ç¤º', async () => {
  // 100å›ä»¥ä¸Šã®ãƒ©ãƒ³ãƒ€ãƒ ãªç‰©ä»¶IDã§ãƒ†ã‚¹ãƒˆ
  // æœ‰åŠ¹ãªç‰©ä»¶IDã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã€ã‚»ãƒ«å€¤ãŒã‚ã‚‹å ´åˆã€
  // ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
});
```

## Diagnostic Tools

### è¨ºæ–­ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆæ–°è¦ä½œæˆï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/public/properties/:id/comments-diagnostic`

**ç›®çš„**: ä¸¡æ–¹ã®ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®çŠ¶æ…‹ã‚’ä¸€åº¦ã«è¨ºæ–­

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "propertyId": "uuid",
  "propertyNumber": "AA12345",
  "propertyType": "åœŸåœ°",
  "spreadsheetUrl": "https://docs.google.com/spreadsheets/d/...",
  "favoriteComment": {
    "cellPosition": "B53",
    "value": "é§…è¿‘ã§ä¾¿åˆ©ï¼",
    "cached": true,
    "error": null
  },
  "recommendedComment": {
    "cellRange": "B63:L79",
    "rowCount": 5,
    "totalCells": 12,
    "cached": false,
    "error": null
  },
  "timestamp": "2026-01-12T10:30:00Z"
}
```

### ãƒ­ã‚°å‡ºåŠ›ã®å¼·åŒ–

ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ä»¥ä¸‹ã®æƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›ï¼š

```typescript
console.log(`[ServiceName] Action: ${action}`);
console.log(`[ServiceName] Property ID: ${propertyId}`);
console.log(`[ServiceName] Property Type: ${propertyType}`);
console.log(`[ServiceName] Spreadsheet URL: ${spreadsheetUrl}`);
console.log(`[ServiceName] Cell Position/Range: ${cellPosition}`);
console.log(`[ServiceName] Result: ${result}`);
console.log(`[ServiceName] Cache Hit: ${cacheHit}`);
```

## Implementation Plan

### Phase 1: è¨ºæ–­ï¼ˆDiagnosisï¼‰

1. **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª**
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ç¢ºèª âœ…
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ç¢ºèª âœ…
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…ç¢ºèª ğŸ”

2. **è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ**
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIè¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºè¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

3. **è¨ºæ–­ã®å®Ÿè¡Œ**
   - å„è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
   - å•é¡Œç®‡æ‰€ã‚’ç‰¹å®š
   - è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ

### Phase 2: ä¿®æ­£ï¼ˆFixï¼‰

è¨ºæ–­çµæœã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’å®Ÿæ–½ï¼š

**ã‚·ãƒŠãƒªã‚ªA: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„**
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®š

**ã‚·ãƒŠãƒªã‚ªB: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ãªã„**
- `PublicPropertyDetailPage` ã®ä¿®æ­£
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®é †åºã®èª¿æ•´

**ã‚·ãƒŠãƒªã‚ªC: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®å•é¡Œ**
- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã®è¨­å®š
- ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã¨ä¿®æ­£

**ã‚·ãƒŠãƒªã‚ªD: èªè¨¼ãƒ»æ¨©é™ã®å•é¡Œ**
- Google Sheets APIèªè¨¼ã®ç¢ºèª
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¨©é™ã®ç¢ºèª

### Phase 3: ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼ï¼ˆTest & Verifyï¼‰

1. **Unit Tests**
   - å„ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ
   - å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

2. **Integration Tests**
   - ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - å„ç‰©ä»¶ã‚¿ã‚¤ãƒ—ã§ã®å‹•ä½œç¢ºèª

3. **Manual Tests**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è¦–è¦šçš„ç¢ºèª
   - å„ãƒ‡ãƒã‚¤ã‚¹ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ/ãƒ¢ãƒã‚¤ãƒ«ï¼‰ã§ã®ç¢ºèª

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆDocumentationï¼‰

1. **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰**
   - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•
   - è¨ºæ–­æ‰‹é †

2. **é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«**
   - ãƒ‡ãƒ¼ã‚¿è¨­å®šæ–¹æ³•
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ–¹æ³•

## Performance Considerations

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Redisï¼ˆ5åˆ†é–“TTLï¼‰
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React Queryï¼ˆ5åˆ†é–“staleTimeï¼‰
- **æœŸå¾…ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ: < 50ms
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹: < 2ç§’

### æœ€é©åŒ–

1. **ä¸¦åˆ—å–å¾—**: ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ã¨ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã‚’ä¸¦åˆ—ã§å–å¾—
2. **éåŒæœŸèª­ã¿è¾¼ã¿**: ãƒšãƒ¼ã‚¸è¡¨ç¤ºã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
3. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**: 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
4. **ãƒªãƒˆãƒ©ã‚¤ãªã—**: ã‚¨ãƒ©ãƒ¼æ™‚ã¯å³åº§ã«nullã‚’è¿”ã™

## Security Considerations

1. **èªè¨¼æƒ…å ±**: ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
2. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: å†…éƒ¨è©³ç´°ã‚’å…¬é–‹ã—ãªã„
3. **å…¥åŠ›æ¤œè¨¼**: ç‰©ä»¶IDã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
4. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: Google Sheets APIã®åˆ¶é™ã‚’å°Šé‡

## Deployment Strategy

### ã‚¹ãƒ†ãƒƒãƒ—1: è¨ºæ–­ã®å®Ÿè¡Œ

```bash
# è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
npm run diagnose:comments
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ä¿®æ­£ã®é©ç”¨

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤
cd backend
npm run build
npm run deploy

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤
cd frontend
npm run build
npm run deploy
```

### ã‚¹ãƒ†ãƒƒãƒ—3: å‹•ä½œç¢ºèª

```bash
# å„ç‰©ä»¶ã‚¿ã‚¤ãƒ—ã§å‹•ä½œç¢ºèª
curl http://localhost:3000/api/public/properties/{land-property-id}/favorite-comment
curl http://localhost:3000/api/public/properties/{house-property-id}/favorite-comment
curl http://localhost:3000/api/public/properties/{apartment-property-id}/favorite-comment
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢

```bash
# Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
redis-cli FLUSHDB
```

## Rollback Plan

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®å¯¾å¿œï¼š

1. **å³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**: å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢**: Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
3. **ãƒ­ã‚°ç¢ºèª**: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
4. **å†è¨ºæ–­**: è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†å®Ÿè¡Œ

## Success Metrics

ä¿®æ­£ãŒæˆåŠŸã—ãŸã¨åˆ¤æ–­ã™ã‚‹åŸºæº–ï¼š

1. âœ… ãŠæ°—ã«å…¥ã‚Šæ–‡è¨€ãŒç”»åƒã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹
2. âœ… ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãŒåŸºæœ¬æƒ…å ±ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹
3. âœ… å„ç‰©ä»¶ã‚¿ã‚¤ãƒ—ã§æ­£ã—ã„ã‚»ãƒ«ä½ç½®/ç¯„å›²ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
4. âœ… ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
5. âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè¨±å®¹ç¯„å›²å†…ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨æ™‚ < 500msï¼‰
6. âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
7. âœ… ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒè¨˜éŒ²ã•ã‚Œãªã„

