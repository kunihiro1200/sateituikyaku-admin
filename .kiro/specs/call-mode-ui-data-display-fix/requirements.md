# Requirements Document

## Introduction

通話モードページ（CallModePage）において、スプレッドシートから同期されたデータが正しく表示されていない問題を解決します。具体的には、以下の6つのセクションでデータが空欄になっています:

1. 物件情報
2. 売主情報のサイトフィールド
3. ステータスセクションの状況（当社）、次電日
4. 訪問予約セクション内
5. 査定計算セクション内
6. 他のセクション内

この問題は、データベースにデータが存在していない、またはスプレッドシート同期時に正しくマッピングされていないことが原因と考えられます。

## Glossary

- **System**: 売主管理システム
- **User**: システムを使用する営業担当者
- **Seller**: 売主（不動産売却を検討している顧客）
- **Call Mode Page**: 通話モードページ（売主との電話対応時に使用する専用画面）
- **Spreadsheet**: Google スプレッドシート（売主データの同期元）
- **Database**: Supabase PostgreSQL データベース（売主データの保存先）
- **SpreadsheetSyncService**: スプレッドシートからデータベースへデータを同期するサービス

## Requirements

### Requirement 1

**User Story:** ユーザーとして、通話モードページで物件情報を確認したい。そうすることで、物件の詳細について顧客と正確に話し合える。

#### Acceptance Criteria

1. WHEN スプレッドシートに物件住所が記載されている THEN システムは物件住所をデータベースに同期する
2. WHEN スプレッドシートに物件種別が記載されている THEN システムは物件種別をデータベースに同期する
3. WHEN スプレッドシートに土地面積が記載されている THEN システムは土地面積をデータベースに同期する
4. WHEN スプレッドシートに建物面積が記載されている THEN システムは建物面積をデータベースに同期する
5. WHEN スプレッドシートに築年、構造、間取り、状況（売主）が記載されている THEN システムはそれらをデータベースに同期する

### Requirement 2

**User Story:** ユーザーとして、通話モードページで売主情報のサイトフィールドを確認したい。そうすることで、どのサイトから反響があったかを把握できる。

#### Acceptance Criteria

1. WHEN スプレッドシートにサイト情報が記載されている THEN システムはサイト情報をデータベースに同期する
2. WHEN サイト情報がデータベースに存在する THEN システムは通話モードページでサイト情報を表示する
3. WHEN サイト情報が存在しない THEN システムは「未設定」と表示する
4. WHEN サイト情報が更新される THEN システムは最新のサイト情報を表示する
5. WHEN サイト情報が除外日の計算に使用される THEN システムは正しい除外日を計算する

### Requirement 3

**User Story:** ユーザーとして、通話モードページでステータスセクションの状況（当社）と次電日を確認したい。そうすることで、顧客の現在の状況と次回連絡日を把握できる。

#### Acceptance Criteria

1. WHEN スプレッドシートに状況（当社）が記載されている THEN システムは状況（当社）をデータベースに同期する
2. WHEN スプレッドシートに次電日が記載されている THEN システムは次電日をデータベースに同期する
3. WHEN 状況（当社）がデータベースに存在する THEN システムは通話モードページで状況（当社）を表示する
4. WHEN 次電日がデータベースに存在する THEN システムは通話モードページで次電日を表示する
5. WHEN 状況（当社）または次電日が更新される THEN システムは最新の情報を表示する

### Requirement 4

**User Story:** ユーザーとして、通話モードページで訪問予約情報を確認したい。そうすることで、訪問スケジュールについて顧客と調整できる。

#### Acceptance Criteria

1. WHEN スプレッドシートに訪問日が記載されている THEN システムは訪問日をデータベースに同期する
2. WHEN スプレッドシートに訪問時間が記載されている THEN システムは訪問時間をデータベースに同期する
3. WHEN スプレッドシートに訪問担当者が記載されている THEN システムは訪問担当者をデータベースに同期する
4. WHEN スプレッドシートに訪問査定取得者が記載されている THEN システムは訪問査定取得者をデータベースに同期する
5. WHEN 訪問予約情報がデータベースに存在する THEN システムは通話モードページで訪問予約情報を表示する

### Requirement 5

**User Story:** ユーザーとして、通話モードページで査定計算情報を確認したい。そうすることで、査定額について顧客と具体的に話し合える。

#### Acceptance Criteria

1. WHEN スプレッドシートに固定資産税路線価が記載されている THEN システムは固定資産税路線価をデータベースに同期する
2. WHEN スプレッドシートに査定額1、査定額2、査定額3が記載されている THEN システムはそれらをデータベースに同期する
3. WHEN スプレッドシートに査定担当者が記載されている THEN システムは査定担当者をデータベースに同期する
4. WHEN 査定情報がデータベースに存在する THEN システムは通話モードページで査定情報を表示する
5. WHEN 査定情報が更新される THEN システムは最新の査定情報を表示する

### Requirement 6

**User Story:** ユーザーとして、通話モードページで「他」セクションの情報を確認したい。そうすることで、その他の重要な情報を把握できる。

#### Acceptance Criteria

1. WHEN スプレッドシートに「他」セクションの情報が記載されている THEN システムはそれらをデータベースに同期する
2. WHEN 「他」セクションの情報がデータベースに存在する THEN システムは通話モードページで情報を表示する
3. WHEN 「他」セクションの情報が存在しない THEN システムは「未設定」と表示する
4. WHEN 「他」セクションの情報が更新される THEN システムは最新の情報を表示する
5. WHEN 「他」セクションの情報が長文の場合 THEN システムはスクロール可能な領域で表示する

### Requirement 7

**User Story:** システム管理者として、スプレッドシート同期時のエラーを確認したい。そうすることで、データ同期の問題を早期に発見できる。

#### Acceptance Criteria

1. WHEN スプレッドシート同期が実行される THEN システムは同期ログを記録する
2. WHEN スプレッドシート同期でエラーが発生する THEN システムはエラーログを記録する
3. WHEN スプレッドシート同期が完了する THEN システムは同期結果を表示する
4. WHEN スプレッドシート同期でフィールドマッピングエラーが発生する THEN システムはどのフィールドでエラーが発生したかを記録する
5. WHEN スプレッドシート同期ログを確認する THEN システムは同期日時、同期件数、エラー件数を表示する

### Requirement 8

**User Story:** 開発者として、スプレッドシートのカラムマッピングを確認したい。そうすることで、どのスプレッドシートカラムがどのデータベースフィールドにマッピングされているかを把握できる。

#### Acceptance Criteria

1. WHEN カラムマッピング設定を確認する THEN システムは全てのマッピング定義を表示する
2. WHEN 物件情報のマッピングを確認する THEN システムは物件関連カラムのマッピングを表示する
3. WHEN 訪問予約のマッピングを確認する THEN システムは訪問関連カラムのマッピングを表示する
4. WHEN 査定情報のマッピングを確認する THEN システムは査定関連カラムのマッピングを表示する
5. WHEN カラムマッピングが不足している THEN システムは不足しているマッピングを特定する

