# AWS電話統合機能 セットアップガイド

このガイドでは、AI電話統合機能を実装する前に必要なAWSサービスのセットアップ手順を説明します。

## 概要

必要なAWSサービス：
- **Amazon Connect** - クラウド型コンタクトセンターサービス（電話システムの中核）
- **Amazon Transcribe** - 音声文字起こしサービス
- **Amazon S3** - 録音ファイル保存用ストレージ
- **Amazon Comprehend** - 感情分析サービス（オプション）

## 推定コスト

### 月間100通話（平均5分/通話）の場合の概算
- Amazon Connect: 約$50-100（基本料金 + 通話料金）
- Amazon Transcribe: 約$12（500分 × $0.024/分）
- Amazon S3: 約$1-5（ストレージ + データ転送）
- Amazon Comprehend: 約$5-10（感情分析を使用する場合）

**合計：月額約$70-120程度**

※実際のコストは使用量により変動します。無料利用枠もあります。

## セットアップ手順

### ステップ1: AWSアカウントの準備

#### 1.1 AWSアカウント作成（未作成の場合）
1. https://aws.amazon.com/jp/ にアクセス
2. 「AWSアカウントを作成」をクリック
3. メールアドレス、パスワード、アカウント名を入力
4. 連絡先情報を入力
5. クレジットカード情報を登録
6. 本人確認（電話認証）
7. サポートプランを選択（基本プランは無料）

#### 1.2 IAMユーザーの作成
1. AWSマネジメントコンソールにログイン
2. IAMサービスを開く
3. 「ユーザー」→「ユーザーを追加」
4. ユーザー名を入力（例：`seller-system-admin`）
5. 「プログラムによるアクセス」と「AWSマネジメントコンソールへのアクセス」を選択
6. 必要な権限を付与：
   - AmazonConnectFullAccess
   - AmazonTranscribeFullAccess
   - AmazonS3FullAccess
   - ComprehendFullAccess（感情分析を使う場合）
7. アクセスキーIDとシークレットアクセスキーを安全に保存

#### 1.3 請求アラートの設定
1. 「Billing」→「Budgets」を開く
2. 「予算を作成」をクリック
3. 月額予算額を設定（例：$200）
4. アラート通知先メールアドレスを設定

### ステップ2: Amazon Connectのセットアップ

#### 2.1 Amazon Connectインスタンスの作成
1. AWSマネジメントコンソールで「Amazon Connect」を検索
2. 「インスタンスを作成」をクリック
3. アクセスURLを設定（例：`your-company-seller-system`）
4. 管理者情報を入力
5. テレフォニーオプション：
   - ✅ 着信を許可
   - ✅ 発信を許可
6. データストレージ：
   - 通話録音用のS3バケットを自動作成（または既存バケットを指定）
7. 「インスタンスを作成」をクリック（作成に数分かかります）

#### 2.2 電話番号の取得
1. Amazon Connectインスタンスを開く
2. 左メニューから「チャネル」→「電話番号」
3. 「電話番号を要求」をクリック
4. 国/地域：日本を選択
5. 電話番号タイプ：
   - **DID（Direct Inward Dialing）** - 直通番号（推奨）
   - または **Toll-Free** - フリーダイヤル
6. 利用可能な番号から選択
7. 説明を入力（例：「売主管理システム用」）
8. 「保存」をクリック

**重要：** 日本の電話番号を取得するには、事前にAWSサポートに連絡して日本での利用を有効化する必要がある場合があります。

#### 2.3 基本的なコンタクトフローの作成
1. 左メニューから「ルーティング」→「コンタクトフロー」
2. 「コンタクトフローを作成」をクリック
3. フロー名を入力（例：「売主通話フロー」）
4. 基本フロー：
   - エントリポイント → 録音の開始 → キューへ転送 → エージェントへ接続
5. 「保存」→「公開」をクリック
6. 取得した電話番号にこのフローを関連付け

### ステップ3: Amazon Transcribeの設定

#### 3.1 サービスの有効化
1. AWSマネジメントコンソールで「Amazon Transcribe」を検索
2. リージョンを確認（東京リージョン：ap-northeast-1を推奨）
3. 「今すぐ始める」をクリック
4. 日本語音声認識が利用可能であることを確認

#### 3.2 カスタム語彙の作成（オプション）
不動産業界特有の用語を認識精度向上のために登録：
1. 「カスタム語彙」→「語彙を作成」
2. 語彙名を入力（例：`real-estate-terms`）
3. 言語：日本語を選択
4. 用語リストをアップロード：
   ```
   不動産
   売主
   買主
   査定
   媒介契約
   専任媒介
   一般媒介
   ```
5. 「語彙を作成」をクリック

### ステップ4: Amazon S3バケットの設定

#### 4.1 録音ファイル用バケットの作成
1. S3サービスを開く
2. 「バケットを作成」をクリック
3. バケット名を入力（例：`seller-system-call-recordings`）
4. リージョン：東京（ap-northeast-1）を選択
5. パブリックアクセス設定：
   - ✅ すべてのパブリックアクセスをブロック（推奨）
6. バケットのバージョニング：有効化（推奨）
7. 暗号化：有効化（SSE-S3またはSSE-KMS）
8. 「バケットを作成」をクリック

#### 4.2 ライフサイクルポリシーの設定
1. 作成したバケットを選択
2. 「管理」タブ→「ライフサイクルルールを作成」
3. ルール名：`archive-old-recordings`
4. ルールスコープ：バケット全体
5. ライフサイクルルールアクション：
   - 90日後：Glacier（アーカイブストレージ）に移行
   - 365日後：削除（法的要件に応じて調整）
6. 「ルールを作成」をクリック

### ステップ5: Amazon Comprehendの設定（オプション）

#### 5.1 サービスの有効化
1. AWSマネジメントコンソールで「Amazon Comprehend」を検索
2. リージョンを確認（東京リージョン推奨）
3. 「今すぐ始める」をクリック
4. 日本語感情分析が利用可能であることを確認

### ステップ6: 認証情報の取得

#### 6.1 アクセスキーの確認
1. IAMサービスを開く
2. 作成したユーザーを選択
3. 「認証情報」タブ
4. 以下の情報を控える：
   - アクセスキーID
   - シークレットアクセスキー
   - Amazon ConnectインスタンスID
   - Amazon ConnectインスタンスARN
   - 取得した電話番号

#### 6.2 環境変数の準備
本システムの`.env`ファイルに以下を追加する準備：
```
AWS_REGION=ap-northeast-1
AWS_ACCESS_KEY_ID=your-access-key-id
AWS_SECRET_ACCESS_KEY=your-secret-access-key
AMAZON_CONNECT_INSTANCE_ID=your-instance-id
AMAZON_CONNECT_INSTANCE_ARN=your-instance-arn
AMAZON_CONNECT_PHONE_NUMBER=+81-xx-xxxx-xxxx
S3_RECORDINGS_BUCKET=seller-system-call-recordings
TRANSCRIBE_CUSTOM_VOCABULARY=real-estate-terms
ENABLE_SENTIMENT_ANALYSIS=true
```

## セットアップ完了チェックリスト

- [ ] AWSアカウント作成完了
- [ ] IAMユーザー作成・権限設定完了
- [ ] 請求アラート設定完了
- [ ] Amazon Connectインスタンス作成完了
- [ ] 電話番号取得完了
- [ ] 基本コンタクトフロー作成完了
- [ ] Amazon Transcribe有効化完了
- [ ] カスタム語彙作成完了（オプション）
- [ ] S3バケット作成完了
- [ ] ライフサイクルポリシー設定完了
- [ ] Amazon Comprehend有効化完了（オプション）
- [ ] 認証情報取得・保存完了

## 次のステップ

セットアップが完了したら：
1. 取得した認証情報を安全に保管
2. 本システムの実装フェーズに進む
3. テスト通話を実施して動作確認

## トラブルシューティング

### 日本の電話番号が取得できない
- AWSサポートに連絡して、日本での電話番号利用を有効化してもらう必要があります
- サポートケースを作成：「Amazon Connectで日本の電話番号を使用したい」

### コストが予想より高い
- 通話時間を確認
- 不要な録音を削除
- ライフサイクルポリシーでアーカイブを早める
- 使用していないリソースを削除

### 音声認識の精度が低い
- カスタム語彙に業界用語を追加
- 通話品質を確認（ノイズが多い場合は改善）
- Amazon Transcribeの最新モデルを使用

## 参考リンク

- [Amazon Connect 公式ドキュメント](https://docs.aws.amazon.com/ja_jp/connect/)
- [Amazon Transcribe 公式ドキュメント](https://docs.aws.amazon.com/ja_jp/transcribe/)
- [AWS料金計算ツール](https://calculator.aws/)
- [AWSサポート](https://console.aws.amazon.com/support/)
