# ç‰©ä»¶å…¬é–‹ã‚µã‚¤ãƒˆç”»åƒè¡¨ç¤ºå•é¡Œ - æ ¹æœ¬åŸå› åˆ†æ

## ğŸ“‹ èª¿æŸ»æ—¥æ™‚
2025å¹´1æœˆ3æ—¥

## ğŸ” å•é¡Œã®ç—‡çŠ¶
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«ã‚ˆã‚‹ã¨ã€`localhost:5173/public/properties`ã§**ç”»åƒãŒä¸€åˆ‡è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„**

## âœ… å‰å›ã®ä¿®æ­£å†…å®¹ï¼ˆå®Œäº†æ¸ˆã¿ï¼‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/src/services/PropertyListingService.ts`
- **å¤‰æ›´å†…å®¹**: Google Drive APIã®å‘¼ã³å‡ºã—ã‚’å‰Šé™¤ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®`image_url`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç›´æ¥ä½¿ç”¨
- **åŠ¹æœ**: ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“ãŒ20-100ç§’ã‹ã‚‰1ç§’æœªæº€ã«æ”¹å–„
- **å®Ÿè£…çŠ¶æ³**: âœ… æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆ217-220è¡Œç›®ã§ç¢ºèªæ¸ˆã¿ï¼‰

## ğŸ”´ æ ¹æœ¬åŸå› ã®ç™ºè¦‹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹
```
ç·ç‰©ä»¶æ•°: 1,000ä»¶
â”œâ”€ å…¬é–‹ç‰©ä»¶ï¼ˆatbb_status = 'å°‚ä»»ãƒ»å…¬é–‹ä¸­'ï¼‰: 152ä»¶
â”‚  â””â”€ image_urlã‚ã‚Š: ç´„80%ï¼ˆã‚µãƒ³ãƒ—ãƒ«5ä»¶ä¸­4ä»¶ï¼‰
â”œâ”€ storage_locationã‚ã‚Š: 126ä»¶ï¼ˆ12.6%ï¼‰
â””â”€ image_urlã‚ã‚Š: 50ä»¶ï¼ˆ5.0%ï¼‰
```

**çµè«–**: å…¬é–‹ç‰©ä»¶ã®å¤§éƒ¨åˆ†ã¯`image_url`ã‚’æŒã£ã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ã¯å­˜åœ¨ã™ã‚‹ âœ…

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "properties": [
    {
      "property_number": "AA13129",
      "property_type": "æˆ¸å»º",
      "address": "å¤§åˆ†å¸‚ç”°å°»åŒ—3-14",
      "price": 19800000,
      "image_url": "https://drive.google.com/uc?export=view&id=...",
      "images": ["https://drive.google.com/uc?export=view&id=..."]
    }
  ]
}
```

**çµè«–**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯æ­£ã—ã`images`é…åˆ—ã‚’è¿”ã—ã¦ã„ã‚‹ âœ…

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœŸå¾…å€¤
```typescript
interface PublicProperty {
  id: string;
  propertyNumber: string;  // âŒ ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹
  address: string;
  price: number;
  propertyType: string;    // âŒ ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹
  images?: string[];
}
```

**çµè«–**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ âŒ

### 4. å®Ÿéš›ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "property_number": "AA13129",  // âš ï¸ ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹
  "property_type": "æˆ¸å»º",       // âš ï¸ ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹
  "images": [...]
}
```

**çµè«–**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã‚’è¿”ã—ã¦ã„ã‚‹ âš ï¸

## ğŸ’¡ æ ¹æœ¬åŸå› 

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ä¸ä¸€è‡´**

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆå®Ÿéš›ï¼‰ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆæœŸå¾…ï¼‰ | ä¸€è‡´ |
|-----------|-------------------|---------------------|------|
| ç‰©ä»¶ç•ªå· | `property_number` | `propertyNumber` | âŒ |
| ç‰©ä»¶ç¨®åˆ¥ | `property_type` | `propertyType` | âŒ |
| ä½æ‰€ | `address` | `address` | âœ… |
| ä¾¡æ ¼ | `price` | `price` | âœ… |
| ç”»åƒ | `images` | `images` | âœ… |

**å½±éŸ¿**:
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ`propertyNumber`ã‚’èª­ã¿å–ã‚Œãªã„ â†’ ç‰©ä»¶ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œãªã„
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ`propertyType`ã‚’èª­ã¿å–ã‚Œãªã„ â†’ ç‰©ä»¶ç¨®åˆ¥ãŒè¡¨ç¤ºã•ã‚Œãªã„
- `images`é…åˆ—ã¯æ­£ã—ãèª­ã¿å–ã‚Œã‚‹ â†’ **ç”»åƒã¯è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš**

## ğŸ¤” ãªãœç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„ã®ã‹ï¼Ÿ

ã•ã‚‰ã«èª¿æŸ»ãŒå¿…è¦ãªå¯èƒ½æ€§ï¼š

### ä»®èª¬1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ãŒä¸å®Œå…¨
`PublicPropertiesPage.tsx`ã§APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã£ãŸå¾Œã€ãƒ‡ãƒ¼ã‚¿ã‚’æ­£ã—ããƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ãªã„å¯èƒ½æ€§

### ä»®èª¬2: ç”»åƒURLã®å½¢å¼å•é¡Œ
Google Driveã®URLå½¢å¼ãŒå¤‰æ›´ã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§èª­ã¿è¾¼ã‚ãªã„å¯èƒ½æ€§

### ä»®èª¬3: CORSå•é¡Œ
Google Driveã‹ã‚‰ã®ç”»åƒèª­ã¿è¾¼ã¿ãŒCORSã‚¨ãƒ©ãƒ¼ã§å¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèª
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä»¥ä¸‹ã‚’ä¾é ¼ï¼š
1. `localhost:5173/public/properties`ã‚’é–‹ã
2. F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
3. Consoleã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
4. Networkã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - APIãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆ`/api/public/properties`ï¼‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
   - ç”»åƒãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çŠ¶æ…‹ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—2: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’çµ±ä¸€
2ã¤ã®é¸æŠè‚¢ï¼š

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›´**
```typescript
// PropertyListingService.ts
const propertiesWithImages = (data || []).map((property) => {
  const images = property.image_url ? [property.image_url] : [];
  return {
    id: property.id,
    propertyNumber: property.property_number,  // å¤‰æ›
    propertyType: property.property_type,      // å¤‰æ›
    address: property.address,
    price: property.price,
    images
  };
});
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›´**
```typescript
// PublicPropertiesPage.tsx
interface PublicProperty {
  id: string;
  property_number: string;  // å¤‰æ›´
  address: string;
  price: number;
  property_type: string;    // å¤‰æ›´
  images?: string[];
}
```

**æ¨å¥¨**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³Aï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å¤‰æ›ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JavaScript/TypeScriptæ…£ç¿’ã«å¾“ã†
- ä»–ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã®ä¸€è²«æ€§

### ã‚¹ãƒ†ãƒƒãƒ—3: ç”»åƒURLå½¢å¼ã®æ¤œè¨¼
å®Ÿéš›ã®ç”»åƒURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥é–‹ã„ã¦ã€èª­ã¿è¾¼ã‚ã‚‹ã‹ç¢ºèª

## ğŸ“Š èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

| é …ç›® | çŠ¶æ…‹ | è©³ç´° |
|------|------|------|
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç”»åƒãƒ‡ãƒ¼ã‚¿ | âœ… æ­£å¸¸ | å…¬é–‹ç‰©ä»¶ã®80%ãŒ`image_url`ã‚’æŒã¤ |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£… | âœ… æ­£å¸¸ | `images`é…åˆ—ã‚’æ­£ã—ãè¿”ã—ã¦ã„ã‚‹ |
| APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ | âš ï¸ å•é¡Œã‚ã‚Š | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãŒã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœŸå¾…å€¤ | âš ï¸ ä¸ä¸€è‡´ | ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã‚’æœŸå¾… |
| ç”»åƒè¡¨ç¤º | âŒ å¤±æ•— | åŸå› ã¯ä¸Šè¨˜ã®ä¸ä¸€è‡´ + è¿½åŠ èª¿æŸ»å¿…è¦ |

## ğŸ¯ å„ªå…ˆåº¦

1. **é«˜**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ç¢ºèªï¼ˆå³åº§ã«å®Ÿè¡Œå¯èƒ½ï¼‰
2. **é«˜**: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®çµ±ä¸€ï¼ˆ30åˆ†ã§ä¿®æ­£å¯èƒ½ï¼‰
3. **ä¸­**: ç”»åƒURLå½¢å¼ã®æ¤œè¨¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/src/services/PropertyListingService.ts` - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…
- `frontend/src/pages/PublicPropertiesPage.tsx` - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- `backend/test-public-api-response.ts` - è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ–°è¦ä½œæˆï¼‰
- `backend/check-image-data.ts` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
