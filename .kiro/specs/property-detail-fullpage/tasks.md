# Implementation Plan - 物件詳細フルページ表示

## 1. 基本ページ構造の作成

- [ ] 1.1 PropertyListingDetailPageコンポーネントを作成
  - `/property-listings/:propertyNumber` ルートで表示される専用ページ
  - URL パラメータから物件番号を取得
  - 基本的なレイアウト構造（ヘッダー、メインコンテンツ、フッター）
  - ローディング状態とエラー状態の表示
  - _Requirements: 1.1, 1.2, 7.2, 7.5_

- [ ] 1.2 App.tsxにルートを追加
  - `/property-listings/:propertyNumber` ルートを追加
  - PropertyListingDetailPageをマウント
  - ProtectedRouteでラップ
  - _Requirements: 1.1, 7.5_

- [ ] 1.3 PropertyListingsPageのナビゲーションを更新
  - 行クリック時にモーダルではなく新ページに遷移
  - 現在の状態（フィルター、ページネーション）をSession Storageに保存
  - _Requirements: 1.1, 1.4, 7.1_

## 2. よく聞かれる項目セクションの実装

- [ ] 2.1 FrequentlyAskedSectionコンポーネントを作成
  - 内覧前伝達事項、固定資産税、管理費、積立金、駐車場、引渡しを表示
  - 大きなフォント（18-24px）で見やすく表示
  - カードベースのレイアウト
  - 編集可能なフィールド
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8_

- [ ] 2.2 PropertyListingDetailPageにFrequentlyAskedSectionを統合
  - ページ上部に配置
  - データバインディング
  - 変更ハンドラーの接続
  - _Requirements: 2.1, 2.8_

## 3. 物件詳細セクションの実装

- [ ] 3.1 PropertyDetailSectionコンポーネントを作成
  - 再利用可能なセクションコンポーネント
  - フィールド定義配列を受け取る
  - グリッドレイアウトでフィールドを表示
  - 各フィールドタイプ（text, number, date, textarea）に対応
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 3.2 基本情報セクションを実装
  - 物件番号、担当名、種別、契約日、決済日、所在地等
  - PropertyDetailSectionを使用
  - _Requirements: 6.1, 6.4, 6.5_

- [ ] 3.3 売主情報セクションを実装
  - 売主名、住所、連絡先、メール
  - PropertyDetailSectionを使用
  - _Requirements: 6.1_

- [ ] 3.4 手数料・価格セクションを実装
  - 手数料、転売差額、売出価格、固定資産税
  - PropertyDetailSectionを使用
  - 価格フォーマット（万円表示）
  - _Requirements: 6.1, 6.5_

- [ ] 3.5 物件詳細セクションを実装
  - 構造、新築年月、間取り、専有面積等
  - PropertyDetailSectionを使用
  - _Requirements: 6.1_

## 4. 買主管理パネルの実装

- [ ] 4.1 BuyerManagementPanelコンポーネントを作成
  - 買主リスト表示エリア
  - 新規作成ボタン
  - 折りたたみ可能な買主作成フォームエリア
  - _Requirements: 3.1, 4.1, 4.3_

- [ ] 4.2 InlineBuyerFormコンポーネントを作成
  - コンパクトなフォームレイアウト
  - 物件番号を自動入力
  - バリデーション
  - 保存/キャンセルボタン
  - _Requirements: 3.2, 3.3, 3.4, 3.6_

- [ ] 4.3 買主リスト表示を実装
  - 買主名、確度、連絡先を表示
  - 空の場合のメッセージ
  - 買主クリックで詳細ページへ（新しいタブ）
  - _Requirements: 4.1, 4.2, 4.3, 4.5_

- [ ] 4.4 買主作成フローを実装
  - 新規作成ボタンクリックでフォーム表示
  - 保存成功後に買主リストを更新
  - フォームをクローズ
  - 成功メッセージ表示
  - _Requirements: 3.1, 3.5, 4.4_

## 5. インライン編集機能の実装

- [ ] 5.1 フィールド変更トラッキングを実装
  - editedDataステートで変更を追跡
  - 変更があれば保存ボタンを有効化
  - 変更内容を視覚的に表示（例：フィールドの背景色変更）
  - _Requirements: 5.1, 5.2, 5.5_

- [ ] 5.2 保存機能を実装
  - 保存ボタンクリックでAPIリクエスト
  - ローディング状態の表示
  - 成功時にデータを再取得してeditedDataをクリア
  - 成功メッセージ表示
  - _Requirements: 5.2, 5.3, 5.4_

- [ ] 5.3 エラーハンドリングを実装
  - 保存失敗時のエラーメッセージ
  - ユーザー入力を保持
  - リトライ機能
  - _Requirements: 5.4, 5.5_

## 6. ナビゲーションと状態管理

- [ ] 6.1 戻るボタンを実装
  - ヘッダーに戻るボタンを配置
  - Session Storageから前の状態を復元
  - 物件リストページに遷移
  - _Requirements: 1.3, 1.4_

- [ ] 6.2 状態保存機能を実装
  - 物件リストページの状態をSession Storageに保存
  - フィルター、ページネーション、検索クエリを保存
  - 戻る時に状態を復元
  - _Requirements: 1.4, 1.5_

- [ ] 6.3 ブラウザ履歴対応を実装
  - ブラウザの戻るボタンで物件リストに戻る
  - 状態を正しく復元
  - _Requirements: 1.5_

- [ ] 6.4 直接URL アクセス対応を実装
  - `/property-listings/:propertyNumber` に直接アクセス可能
  - 物件データを正しく読み込み
  - 存在しない物件番号の場合は404ページ表示
  - _Requirements: 7.2_

## 7. レスポンシブレイアウトの実装

- [ ] 7.1 デスクトップレイアウトを実装
  - 2カラムレイアウト（左：物件詳細、右：買主管理）
  - 画面幅 >1200px で適用
  - _Requirements: 8.1_

- [ ] 7.2 タブレットレイアウトを実装
  - 縦積みレイアウト
  - 画面幅 768px-1200px で適用
  - _Requirements: 8.2_

- [ ] 7.3 モバイルレイアウトを実装
  - シングルカラムレイアウト
  - 折りたたみ可能なセクション
  - 画面幅 <768px で適用
  - _Requirements: 8.3_

- [ ] 7.4 モバイル用買主作成フォームを実装
  - フルスクリーンオーバーレイ表示
  - タッチフレンドリーなボタンサイズ（44x44px以上）
  - _Requirements: 8.4_

- [ ] 7.5 レスポンシブ動作テストを実施
  - 各ブレークポイントでの表示確認
  - リサイズ時のスムーズな遷移
  - データ損失がないことを確認
  - _Requirements: 8.5_

## 8. データフォーマットとUI改善

- [ ] 8.1 日付フォーマット関数を実装
  - 日本語形式（YYYY年MM月DD日）
  - null/undefined の適切な処理
  - _Requirements: 6.4_

- [ ] 8.2 価格フォーマット関数を実装
  - カンマ区切り
  - 万円表示
  - null/undefined の適切な処理
  - _Requirements: 6.5_

- [ ] 8.3 セクション見出しとスタイリングを実装
  - 明確な見出し
  - 視覚的な区切り
  - 一貫したスタイル
  - _Requirements: 6.2_

## 9. アクセシビリティとUX改善

- [ ] 9.1 キーボードナビゲーションを実装
  - Tab キーでフォーカス移動
  - Enter キーで保存
  - Esc キーでキャンセル/戻る
  - _Requirements: なし（UX改善）_

- [ ] 9.2 ARIA ラベルを追加
  - スクリーンリーダー対応
  - フォームフィールドのラベル
  - ボタンの説明
  - _Requirements: なし（アクセシビリティ）_

- [ ] 9.3 ローディング状態の改善
  - スケルトンローダー
  - プログレスインジケーター
  - ローディング中の操作無効化
  - _Requirements: なし（UX改善）_

## 10. 統合とクリーンアップ

- [ ] 10.1 既存モーダルとの共存確認
  - 新ページと既存モーダルが競合しないことを確認
  - 必要に応じて既存コードを調整
  - _Requirements: なし（移行作業）_

- [ ] 10.2 エンドツーエンドテスト
  - 物件リストから詳細ページへの遷移
  - 買主作成フロー
  - 編集と保存
  - 戻るボタンと状態復元
  - _Requirements: 全体_

- [ ] 10.3 パフォーマンス最適化
  - React.memo でコンポーネントを最適化
  - 不要な再レンダリングを削減
  - データキャッシング
  - _Requirements: なし（パフォーマンス）_

- [ ] 10.4 既存モーダルの削除（オプション）
  - PropertyListingDetailModal コンポーネントを削除
  - 関連する未使用コードをクリーンアップ
  - ドキュメント更新
  - _Requirements: なし（クリーンアップ）_

## 11. Final Checkpoint - 全体動作確認

- [ ] 11. Ensure all tests pass, ask the user if questions arise.
