# 実装計画：公開物件サイト検索バー統一

## 概要

ヒーローセクションの検索バーを統一的な検索インターフェースとして強化し、フィルターセクションの重複する所在地検索フィールドを削除します。物件番号（AA, BB, CCで始まる）と所在地検索を自動判定し、シームレスな検索体験を提供します。

## タスク

- [x] 1. 検索クエリ検出ユーティリティの実装
  - `frontend/src/utils/searchQueryDetector.ts` を作成
  - 物件番号パターン（AA, BB, CC）の検出ロジックを実装
  - _要件: 1.1, 1.2_

- [ ]* 1.1 SearchQueryDetector のユニットテストを作成
  - AA, BB, CCで始まる文字列が物件番号として検出されることをテスト
  - それ以外の文字列が所在地として検出されることをテスト
  - エッジケース（空文字列、特殊文字）をテスト
  - _要件: 1.1, 1.2_

- [ ]* 1.2 SearchQueryDetector のプロパティテストを作成
  - **プロパティ 1: 検索クエリの自動検出**
  - **検証: 要件 1.1, 1.2**

- [x] 2. 統一検索フックの実装
  - `frontend/src/hooks/useUnifiedSearch.ts` を作成
  - 検索状態管理、URLパラメータ同期、デバウンス処理を実装
  - _要件: 1.4, 1.5_

- [ ]* 2.1 useUnifiedSearch フックのユニットテストを作成
  - 検索状態の更新をテスト
  - URLパラメータの同期をテスト
  - デバウンス処理（500ms）をテスト
  - _要件: 1.4, 1.5_

- [ ]* 2.2 useUnifiedSearch フックのプロパティテストを作成
  - **プロパティ 2: URL同期の一貫性**
  - **プロパティ 4: デバウンス動作**
  - **検証: 要件 1.4, 1.5**

- [x] 3. UnifiedSearchBar コンポーネントの実装
  - `frontend/src/components/UnifiedSearchBar.tsx` を作成
  - 検索入力フィールド、検索ボタン、レスポンシブデザインを実装
  - ARIA属性とキーボードナビゲーションを追加
  - _要件: 1.1, 1.2, 1.5_

- [ ]* 3.1 UnifiedSearchBar コンポーネントのユニットテストを作成
  - 入力イベントの処理をテスト
  - 検索ボタンのクリックをテスト
  - プレースホルダーの表示をテスト
  - アクセシビリティ属性をテスト
  - _要件: 1.1, 1.2, 1.5_

- [x] 4. PublicPropertyHero への統合
  - `frontend/src/components/PublicPropertyHero.tsx` を更新
  - 既存の検索バーを UnifiedSearchBar に置き換え
  - スタイリングとレイアウトを調整
  - _要件: 1.1, 1.2_

- [x] 5. PublicPropertyFilters の更新
  - `frontend/src/components/PublicPropertyFilters.tsx` を更新
  - 所在地検索フィールドを削除
  - アクティブフィルター表示に検索クエリを追加
  - 検索クエリのクリアボタンを実装
  - _要件: 1.3_

- [ ]* 5.1 アクティブフィルター表示のプロパティテストを作成
  - **プロパティ 3: アクティブフィルター表示**
  - **検証: 要件 1.3**

- [ ] 6. バックエンドAPIの確認と更新
  - 検索クエリパラメータ `q` の処理を確認
  - 物件番号検索と所在地検索の両方に対応していることを確認
  - 必要に応じてAPIエンドポイントを更新
  - _要件: 1.1, 1.2_

- [ ]* 6.1 検索結果の正確性プロパティテストを作成
  - **プロパティ 5: 検索結果の正確性（物件番号）**
  - **プロパティ 6: 検索結果の正確性（所在地）**
  - **検証: 要件 1.1, 1.2**

- [ ] 7. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

- [ ] 8. 統合テストの実装
  - エンドツーエンド検索フローをテスト
  - フィルターとの連携をテスト
  - URLパラメータの永続性をテスト
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 9. スタイリングとレスポンシブデザインの最終調整
  - モバイル、タブレット、デスクトップでの表示を確認
  - ブラウザ互換性をテスト（Chrome, Firefox, Safari, Edge）
  - アクセシビリティをテスト
  - _要件: 1.5_

- [ ] 10. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

## 注記

- `*` マークのタスクはオプションで、より速いMVPのためにスキップ可能
- 各タスクは特定の要件を参照してトレーサビリティを確保
- チェックポイントで段階的な検証を実施
- プロパティテストは普遍的な正確性プロパティを検証
- ユニットテストは特定の例とエッジケースを検証
