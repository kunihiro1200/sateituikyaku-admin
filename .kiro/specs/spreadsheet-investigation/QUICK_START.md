# スプレッドシート調査 - クイックスタートガイド

## 目的

物件リストのスプレッドシートに含まれる全シート名を取得し、正しいシート名を特定します。

## 前提条件

- Node.js がインストールされていること
- `backend/.env` に `PROPERTY_LISTING_SPREADSHEET_ID` が設定されていること
- `google-service-account.json` が存在すること
- サービスアカウントにスプレッドシートへのアクセス権限があること

## 実行手順

### 1. バックエンドディレクトリに移動

```bash
cd backend
```

### 2. スクリプトを実行

```bash
npx ts-node list-property-listing-sheets.ts
```

### 3. 出力結果を確認

スクリプトは以下の形式で出力します:

```
============================================================
スプレッドシート シート名一覧取得
============================================================

スプレッドシートID: [スプレッドシートID]

スプレッドシートのメタデータを取得中...

------------------------------------------------------------
シート数: 3
------------------------------------------------------------

[0] 売主リスト
    シートID: 0
    インデックス: 0
    行数: 1000
    列数: 50

[1] 物件情報
    シートID: 123456
    インデックス: 1
    行数: 500
    列数: 30

[2] 業務リスト
    シートID: 789012
    インデックス: 2
    行数: 800
    列数: 40

============================================================
取得完了
============================================================
```

## 次のステップ

### 1. 正しいシート名を特定

出力結果から、物件リストに該当するシート名を特定します。

### 2. 設定を修正

正しいシート名が分かったら、以下のファイルを修正します:

- `backend/src/services/PropertyListingSyncService.ts`
- `backend/src/config/property-listing-column-mapping.json`
- その他、シート名を参照している箇所

### 3. 動作確認

設定を修正したら、スプレッドシート同期機能が正常に動作することを確認します。

## トラブルシューティング

### エラー: 環境変数が設定されていません

```
環境変数 PROPERTY_LISTING_SPREADSHEET_ID が設定されていません
```

**解決方法:**
1. `backend/.env` ファイルを開く
2. `PROPERTY_LISTING_SPREADSHEET_ID=` の行を確認
3. スプレッドシートIDが正しく設定されているか確認

### エラー: google-service-account.json が見つかりません

```
Error: ENOENT: no such file or directory, open 'google-service-account.json'
```

**解決方法:**
1. プロジェクトルートに `google-service-account.json` が存在するか確認
2. ファイルが存在しない場合は、Google Cloud Consoleからダウンロード
3. ファイルをプロジェクトルートに配置

### エラー: アクセス権限がありません

```
Error: The caller does not have permission
```

**解決方法:**
1. Google スプレッドシートを開く
2. 右上の「共有」ボタンをクリック
3. サービスアカウントのメールアドレスを追加
4. 「閲覧者」または「編集者」権限を付与

## 参考情報

- [Google Sheets API ドキュメント](https://developers.google.com/sheets/api)
- [サービスアカウント認証](https://cloud.google.com/iam/docs/service-accounts)
