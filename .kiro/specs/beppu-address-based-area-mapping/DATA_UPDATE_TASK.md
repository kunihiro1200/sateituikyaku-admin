# 別府市エリアマッピングデータ追加タスク

## 概要

既存の別府市エリアマッピングシステムに、追加の住所データを投入する。
提供されたデータには、⑨-⑮および㊷-㊸のエリア番号に対応する詳細な住所リストが含まれている。

## 背景

現在のシステムには基本的な別府市のエリアマッピングが実装されているが、
より詳細な住所ベースのマッピングデータを追加することで、
配信エリアの精度を向上させる必要がある。

## 提供されたデータ

### ⑨ 青山中学校区
- 南立石一区、南立石二区、南立石生目町、南立石板地町、南立石本町、南立石八幡町
- 堀田、南荘園町、観海寺、鶴見園町、扇山
- 荘園（白菊寮を除く）
- 鶴見（以下を除く：7組・9組・ルミエールの丘）

### ⑩ 中部中学校区
- 荘園北町、緑丘町
- 東荘園4丁目、東荘園5丁目、東荘園6丁目、東荘園7丁目、東荘園8丁目、東荘園9丁目
- 鶴見（7組・9組・ルミエールの丘）
- 荘園（白菊寮のみ）
- 上野口町、天満町
- 東荘園1丁目、東荘園２丁目、東荘園3丁目
- 石垣東１丁目、石垣東２丁目、石垣東3丁目
- 石垣西1丁目、石垣西２丁目、石垣西3丁目
- 駅前町、駅前本町
- 北浜1丁目、北浜２丁目、北浜3丁目
- 北的ヶ浜町、京町、幸町、新港町
- 野口中町、野口元町、富士見町
- 南的ヶ浜町、餅ヶ浜町、元町、弓ヶ浜町、若草町

### ⑪ 北部中学校区
- 亀川四の湯町１区、亀川中央町、亀川東町、亀川浜田町
- 古市町、関の江新町、スパランド豊海
- 野田、内竈
- 国立第1、国立第2、大所、小坂
- 亀川四の湯町２区
- 平田町、照波園町、上平田町、大観山町
- 上人ケ浜町、上人本町、上人仲町、上人西

### ⑫ 朝日中学校区
- 明礬、新別府、馬場、火売、北中、御幸、風呂本
- 井田、鉄輪上、北鉄輪、鉄輪、鉄輪東
- 天間、湯山、竹の内、大畑、小倉
- 朝日ケ丘町

### ⑬ 東山中学校区
- 東山一区、東山二区、城島、山の口、枝郷

### ⑭ 鶴見台中学校区
- 南須賀
- 石垣東4丁目、石垣東5丁目、石垣東6丁目、石垣東7丁目
- 石垣西4丁目、石垣西5丁目、石垣西6丁目、石垣西7丁目、石垣西8丁目、石垣西9丁目、石垣西10丁目
- 春木、上人南、桜ケ丘
- 中須賀元町、中須賀本町、中須賀東町、船小路町、汐見町
- 石垣東8丁目、石垣東9丁目、石垣東10丁目
- 実相寺

### ⑮ 別府西中学校区
- 光町、中島町、原町
- 朝見1丁目、朝見２丁目、朝見3丁目
- 乙原、中央町、田の湯町、上田の湯町
- 青山町、上原町、山の手町、西野口町
- 立田町、南町、松原町、浜町、千代町、末広町、秋葉町、楠町
- 浜脇1丁目、浜脇２丁目、浜脇3丁目
- 浦田、田の口、河内、山家、両郡橋、赤松、柳、鳥越、古賀原、内成

### ㊷ 別府駅周辺
- 中央町、駅前本町、上田の湯町、野口中町、西野口町、駅前町

### ㊸ 鉄輪線より下
- 南立石二区、南立石八幡町、南荘園町、観海寺、鶴見園町
- 荘園（白菊寮を除く）
- 荘園北町、緑丘町
- 東荘園4丁目、東荘園5丁目、東荘園6丁目、東荘園7丁目、東荘園8丁目、東荘園9丁目
- 鶴見（7組・9組・ルミエールの丘）
- 荘園（白菊寮のみ）
- 上野口町、天満町
- 東荘園1丁目、東荘園２丁目、東荘園3丁目
- 石垣東１丁目、石垣東２丁目、石垣東3丁目
- 石垣西1丁目、石垣西２丁目、石垣西3丁目
- 駅前町、駅前本町
- 北浜1丁目、北浜２丁目、北浜3丁目
- 北的ヶ浜町、京町、幸町、新港町
- 野口中町、野口元町、富士見町
- 南的ヶ浜町、餅ヶ浜町、元町、弓ヶ浜町、若草町
- 亀川四の湯町１区、亀川中央町、亀川東町、亀川浜田町
- 古市町、関の江新町、スパランド豊海
- 内竈
- 国立第1、国立第2、大所、小坂
- 亀川四の湯町２区
- 平田町、照波園町、上平田町、大観山町
- 上人ケ浜町、上人本町、上人仲町、上人西
- 新別府、北中、馬場
- 荘園北町、緑丘町
- 東荘園4丁目、東荘園5丁目、東荘園6丁目、東荘園7丁目、東荘園8丁目、東荘園9丁目
- 鶴見（7組・9組・ルミエールの丘）
- 荘園（白菊寮のみ）
- 上野口町、天満町
- 東荘園1丁目、東荘園２丁目、東荘園3丁目
- 石垣東１丁目、石垣東２丁目、石垣東3丁目
- 石垣西1丁目、石垣西２丁目、石垣西3丁目
- 駅前町、駅前本町
- 北浜1丁目、北浜２丁目、北浜3丁目
- 北的ヶ浜町、京町、幸町、新港町
- 野口中町、野口元町、富士見町
- 南的ヶ浜町、餅ヶ浜町、元町、弓ヶ浜町、若草町
- 南須賀
- 石垣東4丁目、石垣東5丁目、石垣東6丁目、石垣東7丁目
- 石垣西4丁目、石垣西5丁目、石垣西6丁目、石垣西7丁目、石垣西8丁目、石垣西9丁目、石垣西10丁目
- 春木、上人南、桜ケ丘
- 中須賀元町、中須賀本町、中須賀東町、船小路町、汐見町
- 石垣東8丁目、石垣東9丁目、石垣東10丁目
- 実相寺
- 光町、中島町、原町
- 朝見1丁目、朝見２丁目、朝見3丁目
- 乙原、中央町、田の湯町、上田の湯町
- 青山町、上原町、山の手町、西野口町
- 立田町、南町、松原町、浜町、千代町、末広町、秋葉町、楠町
- 浜脇1丁目、浜脇２丁目、浜脇3丁目
- 浦田、田の口、河内、山家、両郡橋、赤松、柳、鳥越、古賀原、内成

## タスク

### 1. データ解析と整理

提供されたデータを解析し、`beppu_area_mapping` テーブルに投入可能な形式に整理する。

**注意点:**
- 同じ地域名が複数のエリアに属する場合がある（例: 荘園北町は⑩と㊸の両方）
- 特殊な条件付き地域がある（例: 荘園（白菊寮を除く）、鶴見（7組・9組・ルミエールの丘））
- 丁目の表記揺れに注意（全角数字、半角数字、漢数字）

### 2. データ投入スクリプトの作成

`beppu_area_mapping` テーブルにデータを投入するスクリプトを作成する。

**要件:**
- 既存データとの重複チェック
- 同じ地域名で複数のエリア番号がある場合は複数行として登録
- トランザクション処理で一括投入

### 3. データ検証

投入したデータが正しく登録されているか検証する。

**検証項目:**
- 全ての地域名が登録されているか
- 各エリア番号に対応する地域数が適切か
- 重複データがないか
- 特殊条件の地域が正しく処理されているか

### 4. 既存物件の再計算

新しいマッピングデータに基づいて、既存の別府市物件の配信エリアを再計算する。

**要件:**
- 別府市の全物件を対象
- 新しいマッピングで配信エリアを再計算
- 変更があった物件のみ更新
- 更新ログを記録

### 5. テストと検証

実際の住所データでテストを実行し、正しいエリア番号が返されることを確認する。

**テストケース例:**
- `別府市南立石一区1-2-3` → `⑨` (または `⑨㊸` if 南立石一区 is in ㊸)
- `別府市荘園北町3-15` → `⑩㊸`
- `別府市中央町5-20` → `⑮㊷`
- `別府市亀川四の湯町１区2-5` → `⑪㊸`

## 実装手順

1. データ解析スクリプトを作成して、提供されたデータを構造化
2. INSERT文を生成するスクリプトを作成
3. テスト環境でデータ投入を実行
4. データ検証スクリプトを実行
5. 既存物件の再計算スクリプトを実行
6. 本番環境にデプロイ

## 注意事項

### 特殊な地域の扱い

以下の地域は特殊な条件があるため、注意が必要:

1. **荘園（白菊寮を除く）** → ⑨
2. **荘園（白菊寮のみ）** → ⑩
3. **鶴見（以下を除く：7組・9組・ルミエールの丘）** → ⑨
4. **鶴見（7組・9組・ルミエールの丘）** → ⑩

これらは住所文字列だけでは判別できないため、以下の対応を検討:
- 基本的には「荘園」→⑨、「鶴見」→⑨としてマッピング
- 必要に応じて手動で調整可能にする
- または、より詳細な住所情報（番地など）で判別ロジックを追加

### 複数エリアへの所属

多くの地域が複数のエリア番号に属している（学校区+特別エリア）。
例: 荘園北町 → ⑩（中部中学校区）+ ㊸（鉄輪線より下）

システムは既にこれに対応しており、`lookupDistributionAreas()` メソッドが
複数のマッピングを統合して返す仕組みになっている。

## 期待される結果

- 別府市の全ての地域が詳細なエリア番号にマッピングされる
- 物件の住所から自動的に正しい配信エリア番号が設定される
- 買主への配信がより精密になる
- ㊶（別府市全体）へのフォールバックが減少する

## 成功基準

1. 提供された全ての地域データがデータベースに登録されている
2. テストケースが全て正しいエリア番号を返す
3. 既存の別府市物件の配信エリアが更新されている
4. システムログにエラーがない
5. 手動テストで実際の住所が正しく処理される
