# 実装計画：公開物件詳細ページ追加セクション機能

## 概要

公開物件詳細ページの最下部に「こちらの物件について」と「概算書」の2つのセクションを追加します。

## タスク

- [x] 1. バックエンド: BQ列データ取得メソッドの実装
  - [x] 1.1 PropertyServiceに`getPropertyAbout`メソッドを追加
    - GoogleSheetsClientを使用して物件シートにアクセス
    - 物件番号で行を検索
    - BQ列からデータを取得
    - エラー時はnullを返す
    - _要件: 1.2, 1.3, 3.1_

- [x] 2. バックエンド: 概算書PDF生成メソッドの実装
  - [x] 2.1 PropertyServiceに`generateEstimatePdf`メソッドを追加
    - GoogleSheetsClientを使用して概算書シートにアクセス
    - C2セルに物件番号を入力
    - 計算完了を待機（2秒）
    - PDFエクスポートURLを生成
    - _要件: 2.2, 2.3, 2.4_
  
  - [x] 2.2 `exportSheetAsPdf`プライベートメソッドを追加
    - Google Sheets APIのPDFエクスポートURLを生成
    - A4サイズを指定
    - _要件: 2.4, 2.5_

- [x] 3. バックエンド: APIエンドポイントの追加
  - [x] 3.1 BQ列データ取得エンドポイントを追加
    - `GET /api/public/properties/:propertyNumber/about`
    - PropertyService.getPropertyAboutを呼び出し
    - レスポンス: `{ about: string | null }`
    - _要件: 1.2_
  
  - [x] 3.2 概算書PDF生成エンドポイントを追加
    - `POST /api/public/properties/:propertyNumber/estimate-pdf`
    - PropertyService.generateEstimatePdfを呼び出し
    - レスポンス: `{ pdfUrl: string }`
    - エラー時は500エラーを返す
    - _要件: 2.2, 3.2_

- [x] 4. フロントエンド: PublicPropertyDetailPageの修正
  - [x] 4.1 状態管理の追加
    - `propertyAbout`, `isLoadingAbout`, `isGeneratingPdf`の状態を追加
    - _要件: 1.1_
  
  - [x] 4.2 BQ列データ取得ロジックの実装
    - useEffectで物件データ取得後にBQ列データを取得
    - APIエンドポイントを呼び出し
    - エラー時は何も表示しない
    - _要件: 1.2, 3.1, 3.4_
  
  - [x] 4.3 概算書PDF生成ロジックの実装
    - ボタンクリック時にAPIを呼び出し
    - 生成中はローディング表示
    - 成功時は新しいタブでPDFを開く
    - エラー時はアラートメッセージを表示
    - _要件: 2.1, 2.6, 3.2, 3.3_
  
  - [x] 4.4 「こちらの物件について」セクションの追加
    - propertyAboutが存在する場合のみ表示
    - 改行を保持して表示（whiteSpace: 'pre-wrap'）
    - ページ最下部に配置
    - _要件: 1.1, 1.3, 1.4, 1.5_
  
  - [x] 4.5 「概算書」セクションの追加
    - 「概算書を見る」ボタンを配置
    - 生成中は「生成中...」と表示
    - 「こちらの物件について」セクションの下に配置
    - _要件: 2.1, 3.3_

- [x] 5. 動作確認
  - ローカル環境でバックエンドとフロントエンドを起動
  - BQ列にデータがある物件で「こちらの物件について」が表示されることを確認
  - BQ列にデータがない物件でセクションが非表示になることを確認
  - 「概算書を見る」ボタンをクリックしてPDFが新しいタブで開くことを確認
  - 生成中のローディング表示を確認
  - _要件: 1.1, 1.3, 1.4, 2.1, 2.6, 3.3_

- [x] 6. チェックポイント
  - すべての機能が正常に動作することを確認
  - エラーハンドリングが適切に行われることを確認
  - 質問があればユーザーに確認

## 注意事項

- すべてのタスクは必須の実装タスクです
- Googleスプレッドシートのスキーマ（A列: 物件番号、BQ列: こちらの物件について、C2セル: 物件番号入力）を前提としています
- 概算書シートへの書き込み権限が必要です
- PDF生成には2秒の待機時間を設けています（計算完了を待つため）
