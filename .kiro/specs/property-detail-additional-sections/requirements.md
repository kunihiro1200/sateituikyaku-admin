# 要件ドキュメント：公開物件詳細ページ追加セクション機能

## 概要

公開物件詳細ページの最下部に2つの新しいセクションを追加します：
1. 「こちらの物件について」セクション - 物件シートのBQ列から取得したテキストを表示
2. 「概算書」セクション - クリックすると概算書PDFを生成・表示

## 用語集

- **物件シート**: GoogleスプレッドシートID `1tI_iXaiLuWBggs5y0RH7qzkbHs9wnLLdRekAmjkhcLY`、シート名「物件」
- **概算書シート**: GoogleスプレッドシートID `1M9uVzHWD2ipzoY5Om3h3a2-_uQa9D_UGhpB5U4_nyRc`、シート名「威風専用公開サイト用」
- **BQ列**: 物件シートの「こちらの物件について」の説明文が格納されている列
- **C2セル**: 概算書シートで物件番号を入力するセル

## 要件

### 要件1: 「こちらの物件について」セクションの表示

**ユーザーストーリー**: 公開物件サイトの閲覧者として、物件の詳細な説明を確認したい。

#### 受入基準

1. WHEN 公開物件詳細ページを表示する場合、THE System SHALL ページ最下部に「こちらの物件について」セクションを表示すること
2. WHEN 「こちらの物件について」セクションを表示する場合、THE System SHALL 物件シート（ID: 1tI_iXaiLuWBggs5y0RH7qzkbHs9wnLLdRekAmjkhcLY、シート名: 物件）のBQ列から物件番号に対応する説明文を取得すること
3. WHEN BQ列の値が存在する場合、THE System SHALL その内容を表示すること
4. WHEN BQ列の値が存在しない場合、THE System SHALL セクション全体を非表示にすること
5. WHEN 説明文を表示する場合、THE System SHALL 改行を保持して表示すること

### 要件2: 「概算書」セクションの表示とPDF生成

**ユーザーストーリー**: 公開物件サイトの閲覧者として、物件の概算書をPDFで確認したい。

#### 受入基準

1. WHEN 公開物件詳細ページを表示する場合、THE System SHALL 「こちらの物件について」セクションの下に「概算書」セクションを表示すること
2. WHEN ユーザーが「概算書を見る」ボタンをクリックした場合、THE System SHALL 概算書シート（ID: 1M9uVzHWD2ipzoY5Om3h3a2-_uQa9D_UGhpB5U4_nyRc、シート名: 威風専用公開サイト用）のC2セルに物件番号を入力すること
3. WHEN C2セルに物件番号を入力した場合、THE System SHALL スプレッドシートの計算式が実行されるまで待機すること
4. WHEN 計算が完了した場合、THE System SHALL スプレッドシートをPDF形式でエクスポートすること
5. WHEN PDFを生成した場合、THE System SHALL A4サイズで表示すること
6. WHEN PDFを表示する場合、THE System SHALL 新しいタブまたはウィンドウで開くこと

### 要件3: データ取得とエラーハンドリング

**ユーザーストーリー**: システム管理者として、データ取得エラーが発生してもページ全体の表示に影響しないようにしたい。

#### 受入基準

1. WHEN BQ列のデータ取得に失敗した場合、THE System SHALL エラーをログに記録し、「こちらの物件について」セクションを非表示にすること
2. WHEN 概算書PDF生成に失敗した場合、THE System SHALL ユーザーにエラーメッセージを表示すること
3. WHEN データ取得中の場合、THE System SHALL ローディング表示を行うこと
4. WHEN いずれかのセクションでエラーが発生した場合、THE System SHALL 他のセクションの表示に影響を与えないこと

### 要件4: パフォーマンスとキャッシュ

**ユーザーストーリー**: 公開物件サイトの閲覧者として、ページの読み込みが速いことを期待する。

#### 受入基準

1. WHEN BQ列のデータを取得する場合、THE System SHALL 非同期で取得すること
2. WHEN 概算書PDFを生成する場合、THE System SHALL ユーザーがボタンをクリックした時のみ実行すること
3. WHEN 同じ物件の概算書を再度生成する場合、THE System SHALL 前回の入力をクリアしてから新しい物件番号を入力すること

## 非機能要件

### NFR-1: パフォーマンス
BQ列のデータ取得がページ全体の読み込み速度に大きな影響を与えないこと

### NFR-2: エラーハンドリング
データ取得やPDF生成に失敗しても、ページ全体の表示が正常に行われること

### NFR-3: ユーザビリティ
概算書生成中はローディング表示を行い、ユーザーに処理中であることを明示すること

## 制約条件

1. Googleスプレッドシートのスキーマ変更は行わない
2. 既存のGoogleSheetsClient実装を使用する
3. PDF生成はGoogle Sheets APIのエクスポート機能を使用する
4. 概算書シートのC2セルへの書き込み権限が必要

## 想定される影響範囲

- **影響を受けるファイル**: 
  - `frontend/src/pages/PublicPropertyDetailPage.tsx`（表示ロジック）
  - `backend/src/services/PropertyService.ts`または新規サービス（データ取得・PDF生成ロジック）
  - `backend/src/routes/publicProperties.ts`（APIエンドポイント追加）
- **影響を受けない機能**: 
  - 既存の物件情報表示
  - お問い合わせフォーム
  - 画像表示
