# 要件定義書

## はじめに

本機能拡張は、既存の売主リスト管理システムを拡張し、物件（property）、買主（buyer）、案件（work）の3つの新しいエンティティを同一ワークスペース内で統合管理できるようにするものです。

現在のシステムは「urinusituikyaku（売主リスト）」のみを管理していますが、不動産仲介業務の全工程をカバーするため、以下の4つのデータを統合的に管理します：

1. **urinusituikyaku（売主リスト）** - 無料査定サイトから査定依頼がきた顧客の全情報（既存）
2. **property（物件）** - 媒介契約を取得した物件・売主の情報
3. **buyer（買主）** - 問合せ客の情報（会社のメールや電話に問合せがくる）
4. **work（案件スプシ）** - 媒介契約をとれた物件の業務情報

## 用語集

- **システム**: 不動産統合管理システム
- **売主**: 無料査定を依頼した顧客（urinusituikyaku）
- **売主番号**: 売主を一意に識別する番号（AA + 数字5桁、例：AA00001）
- **物件**: 媒介契約を取得した不動産（property）
- **物件番号**: 物件を一意に識別する番号（売主番号と同一）
- **買主**: 物件に問合せをした顧客（buyer）
- **買主等**: 買主の識別子
- **案件**: 媒介契約をとれた物件の業務管理単位（work）
- **案件スプシ**: 案件管理スプレッドシート
- **媒介契約**: 不動産の売却を仲介する契約
- **内覧**: 買主が物件を見学すること
- **サイト登録**: athome、SUUMOなどの不動産ポータルサイトへの物件掲載
- **売買契約書**: 不動産売買の契約書
- **重説**: 重要事項説明書
- **決済書類**: 金種表、領収書等の決済に必要な書類
- **スタッフ**: システムを利用する従業員（イニシャル、名前、メアド、電話番号、固定休等）

## 要件

### 要件1: 物件管理（property）

**ユーザーストーリー:** 社員として、媒介契約を取得した物件を管理したいので、物件情報と売主情報を記録し、サイト掲載から決済までの進捗を追跡できるようにしたい

#### 受入基準

1. WHEN 媒介契約を取得した場合、システムは売主リストから物件情報を自動コピーして物件レコードを作成しなければならない
2. WHEN 物件レコードを作成する場合、システムは物件番号として売主番号を使用しなければならない
3. WHEN 物件情報を表示する場合、システムは物件所在地、種別、面積、築年、構造等の詳細を表示しなければならない
4. WHEN 物件の問合せを受けた場合、システムは問合せ内容と問合せ元を記録しなければならない
5. WHEN 物件リストを表示する場合、システムはサイト掲載状況、内覧予定、契約進捗でフィルタリングできなければならない

### 要件2: 物件のサイト登録管理

**ユーザーストーリー:** 社員として、物件のポータルサイト掲載状況を管理したいので、athome、SUUMO等への登録状況を記録できるようにしたい

#### 受入基準

1. WHEN 物件をサイトに登録する場合、システムはサイト名（athome、SUUMO等）と登録日を記録しなければならない
2. WHEN サイト登録状況を表示する場合、システムは各サイトの登録有無を一覧表示しなければならない
3. WHEN サイト登録を更新する場合、システムは更新日時と更新者を記録しなければならない
4. WHEN サイトから物件を削除する場合、システムは削除日と削除理由を記録しなければならない

### 要件3: 買主管理（buyer）

**ユーザーストーリー:** 社員として、物件に問合せをした買主を管理したいので、買主情報と問合せ履歴を記録し、内覧スケジュールを管理できるようにしたい

#### 受入基準

1. WHEN 新規問合せを受けた場合、システムは買主の連絡先（名前、電話番号、メールアドレス）を記録しなければならない
2. WHEN 買主レコードを作成する場合、システムは一意の買主等識別子を自動生成しなければならない
3. WHEN 買主が複数物件に問合せた場合、システムは1買主に対して複数の物件問合せを紐付けできなければならない
4. WHEN 買主情報を表示する場合、システムは問合せ履歴、内覧履歴、購入意欲を表示しなければならない
5. WHEN 買主リストをフィルタリングする場合、システムは確度、内覧予定、担当者で絞り込みできなければならない

### 要件4: 内覧管理

**ユーザーストーリー:** 社員として、買主の内覧スケジュールを管理したいので、内覧予約を記録しGoogleカレンダーに連携できるようにしたい

#### 受入基準

1. WHEN 内覧予約を取得した場合、システムは内覧日時、物件、買主、担当者を記録しなければならない
2. WHEN 内覧予約が確定した場合、システムはGoogle Calendar APIを使用して担当者のカレンダーにイベントを作成しなければならない
3. WHEN 内覧が完了した場合、システムは内覧結果（買主の反応、フィードバック）を記録しなければならない
4. WHEN 内覧をキャンセルする場合、システムはGoogleカレンダーからイベントを削除しなければならない
5. WHEN 内覧履歴を表示する場合、システムは物件別、買主別に内覧履歴を表示できなければならない

### 要件5: 案件管理（work）

**ユーザーストーリー:** 社員として、媒介契約をとれた物件の業務進捗を管理したいので、必要な業務タスクと期限を追跡できるようにしたい

#### 受入基準

1. WHEN 媒介契約が成立した場合、システムは物件番号（＝売主番号）をキーとして案件レコードを作成しなければならない
2. WHEN 案件を作成する場合、システムは必要な業務タスク（媒介契約書作成、サイト登録、売買契約書作成、重説作成、決済書類作成）を自動生成しなければならない
3. WHEN 業務タスクを更新する場合、システムは完了日時と担当者を記録しなければならない
4. WHEN 案件の進捗を表示する場合、システムは各タスクの完了状況をチェックリスト形式で表示しなければならない
5. WHEN 案件リストを表示する場合、システムは進捗状況、期限、担当者でフィルタリングできなければならない

### 要件6: 案件の業務タスク管理

**ユーザーストーリー:** 社員として、案件の各業務タスクの期限と担当を管理したいので、納期遅れや漏れを防止できるようにしたい

#### 受入基準

1. WHEN 業務タスクに期限を設定する場合、システムは期限日を記録しなければならない
2. WHEN 期限が近づいた場合、システムは担当者に通知を送信しなければならない
3. WHEN 期限を過ぎた場合、システムは遅延フラグを表示しなければならない
4. WHEN 業務タスクを別の担当者に割り当てる場合、システムは担当者変更履歴を記録しなければならない
5. WHEN 業務タスクの進捗を確認する場合、システムは担当者別のタスク一覧を表示できなければならない

### 要件7: エンティティ間のリレーション

**ユーザーストーリー:** 社員として、売主・物件・買主・案件の関連を把握したいので、各エンティティ間のリンクを辿れるようにしたい

#### 受入基準

1. WHEN 売主詳細を表示する場合、システムは関連する物件レコードへのリンクを表示しなければならない
2. WHEN 物件詳細を表示する場合、システムは関連する売主、買主、案件へのリンクを表示しなければならない
3. WHEN 買主詳細を表示する場合、システムは問合せた物件一覧へのリンクを表示しなければならない
4. WHEN 案件詳細を表示する場合、システムは関連する物件、売主、買主へのリンクを表示しなければならない
5. WHEN 売主番号で検索する場合、システムは売主、物件、案件の全てを横断検索できなければならない

### 要件8: 統合ダッシュボード

**ユーザーストーリー:** 社員として、全体の業務状況を把握したいので、売主・物件・買主・案件の統計を一覧表示できるようにしたい

#### 受入基準

1. WHEN ダッシュボードを表示する場合、システムは売主リストの件数と新規反響数を表示しなければならない
2. WHEN ダッシュボードを表示する場合、システムは物件の掲載数と問合せ数を表示しなければならない
3. WHEN ダッシュボードを表示する場合、システムは買主の件数と内覧予定数を表示しなければならない
4. WHEN ダッシュボードを表示する場合、システムは案件の進捗状況と期限切れタスク数を表示しなければならない
5. WHEN ダッシュボードの期間を変更する場合、システムは指定期間の統計を再計算して表示しなければならない

### 要件9: サイドバーナビゲーション

**ユーザーストーリー:** 社員として、各エンティティに素早くアクセスしたいので、サイドバーから売主・物件・買主・案件リストに遷移できるようにしたい

#### 受入基準

1. WHEN サイドバーを表示する場合、システムは売主リスト、物件リスト、買主リスト、案件リストへのリンクを表示しなければならない
2. WHEN サイドバーのリンクをクリックした場合、システムは対応するリストページに遷移しなければならない
3. WHEN 各リストページを表示する場合、システムは現在のページをサイドバーでハイライト表示しなければならない
4. WHEN サイドバーを表示する場合、システムは各エンティティの未対応件数をバッジ表示しなければならない

### 要件10: スタッフ情報の共通管理

**ユーザーストーリー:** 社員として、担当者情報を一元管理したいので、スタッフのイニシャル、名前、連絡先、固定休を共通データとして使用できるようにしたい

#### 受入基準

1. WHEN 担当者を選択する場合、システムは共通のスタッフマスタから選択できなければならない
2. WHEN スタッフ情報を表示する場合、システムはイニシャル、名前、メールアドレス、電話番号、固定休を表示しなければならない
3. WHEN スタッフ情報を更新する場合、システムは全エンティティで参照されるスタッフ情報を一括更新しなければならない
4. WHEN 担当者別の業務を表示する場合、システムは売主・物件・買主・案件の全てを横断して担当業務を表示できなければならない

