# 公開物件サイト - スマホ地図検索機能修正 タスクリスト

## タスク概要

スマホでの「地図で検索」ボタンのレイアウト問題とGoogle Maps APIエラーを修正します。

---

## タスク1: レスポンシブデザインの修正

### 1.1 PublicPropertiesPage.tsxのレイアウト修正
- [ ] 1.1.1 検索バーと地図検索ボタンのコンテナにレスポンシブスタイルを追加
  - `flexDirection: { xs: 'column', sm: 'row' }`を設定
  - `alignItems: { xs: 'stretch', sm: 'flex-start' }`を設定
  - `gap: 2`を維持

- [ ] 1.1.2 地図検索ボタンにレスポンシブスタイルを追加
  - `minWidth: { xs: 'auto', sm: '140px' }`を設定
  - `width: { xs: '100%', sm: 'auto' }`を設定
  - 既存のスタイル（色、フォントなど）を維持

- [ ] 1.1.3 検索バーのコンテナにレスポンシブスタイルを追加
  - `flex: { xs: 'none', sm: 1 }`を設定

### 1.2 ローカル環境でのテスト
- [ ] 1.2.1 開発サーバーを起動してブラウザで確認
  - `npm run dev`を実行
  - Chrome DevToolsでスマホ画面をエミュレート

- [ ] 1.2.2 各画面サイズでの表示確認
  - iPhone SE（375px × 667px）
  - iPhone 12 Pro（390px × 844px）
  - iPad（768px × 1024px）
  - デスクトップ（1920px × 1080px）

- [ ] 1.2.3 ボタンのタップ領域確認
  - ボタンの高さが44px以上であることを確認
  - ボタンのテキストが省略されていないことを確認

---

## タスク2: Google Maps API設定の確認と修正

### 2.1 Google Cloud Consoleでの確認
- [ ] 2.1.1 APIキーの有効性を確認
  - [Google Cloud Console](https://console.cloud.google.com/)にアクセス
  - プロジェクトを選択
  - 「APIとサービス」→「認証情報」
  - APIキー`AIzaSyD2igeXY-E_MWtJwMYpiv6CYpEiLJuDeYE`を確認

- [ ] 2.1.2 Maps JavaScript APIが有効になっているか確認
  - 「APIとサービス」→「ライブラリ」
  - "Maps JavaScript API"を検索
  - 「有効」になっていることを確認
  - 無効の場合は有効化

- [ ] 2.1.3 請求アカウントが設定されているか確認
  - 「お支払い」セクションを確認
  - 請求アカウントがリンクされていることを確認
  - 未設定の場合は設定

- [ ] 2.1.4 APIキーの制限を確認・修正
  - APIキーの詳細ページを開く
  - 「アプリケーションの制限」が「HTTPリファラー」になっていることを確認
  - 「ウェブサイトの制限」に以下を追加:
    - `https://property-site-frontend-kappa.vercel.app/*`
    - `http://localhost:*`
  - 「API制限」で「Maps JavaScript API」が選択されていることを確認

### 2.2 環境変数の確認
- [ ] 2.2.1 frontend/.env.productionの確認
  - `VITE_GOOGLE_MAPS_API_KEY`が設定されていることを確認
  - 値が正しいAPIキーであることを確認

- [ ] 2.2.2 Vercelの環境変数を確認
  - Vercelダッシュボードにアクセス
  - プロジェクトの「Settings」→「Environment Variables」
  - `VITE_GOOGLE_MAPS_API_KEY`が設定されていることを確認
  - 未設定の場合は追加

### 2.3 PropertyMapViewコンポーネントの確認
- [ ] 2.3.1 PropertyMapView.tsxを開いて実装を確認
  - Google Maps APIの読み込み方法を確認
  - APIキーが正しく渡されているか確認
  - エラーハンドリングが実装されているか確認

- [ ] 2.3.2 エラーハンドリングの追加（必要な場合）
  - `LoadScript`の`onError`プロップを追加
  - エラーメッセージをコンソールに出力
  - ユーザーにわかりやすいエラーメッセージを表示

---

## タスク3: テストとデバッグ

### 3.1 ローカル環境でのテスト
- [ ] 3.1.1 地図検索機能のテスト
  - 「地図で検索」ボタンをクリック
  - 地図が正しく表示されることを確認
  - エラーメッセージが表示されないことを確認

- [ ] 3.1.2 物件マーカーの表示確認
  - 地図上に物件のマーカーが表示されることを確認
  - マーカーをクリックすると物件情報が表示されることを確認

- [ ] 3.1.3 ブラウザのコンソールエラー確認
  - Chrome DevToolsのConsoleタブを開く
  - Google Maps関連のエラーがないことを確認

### 3.2 本番環境へのデプロイ
- [ ] 3.2.1 コードをコミット
  ```bash
  git add .
  git commit -m "fix: スマホでの地図検索ボタンのレイアウトとGoogle Maps APIエラーを修正"
  git push origin main
  ```

- [ ] 3.2.2 Vercelで自動デプロイを確認
  - Vercelダッシュボードでデプロイ状況を確認
  - デプロイが成功したことを確認

### 3.3 本番環境でのテスト
- [ ] 3.3.1 スマホ実機でのテスト
  - iPhoneでアクセス
  - Androidでアクセス
  - 「地図で検索」ボタンが画面内に収まっていることを確認

- [ ] 3.3.2 地図検索機能のテスト
  - 「地図で検索」ボタンをタップ
  - 地図が正しく表示されることを確認
  - エラーメッセージが表示されないことを確認

- [ ] 3.3.3 各画面サイズでのテスト
  - スマホ（縦向き・横向き）
  - タブレット（縦向き・横向き）
  - デスクトップ

---

## タスク4: ドキュメント更新

### 4.1 修正内容の記録
- [ ] 4.1.1 CHANGELOG.mdに修正内容を追加
  - 修正日時
  - 修正内容の概要
  - 影響範囲

- [ ] 4.1.2 README.mdの更新（必要な場合）
  - Google Maps API設定手順を追加
  - トラブルシューティングセクションを追加

---

## タスク5: 監視とフォローアップ

### 5.1 エラー監視
- [ ] 5.1.1 本番環境でのエラー発生状況を監視
  - Google Cloud Consoleで使用量を確認
  - エラーログを確認

- [ ] 5.1.2 ユーザーからのフィードバック収集
  - 地図検索機能が正常に動作しているか確認
  - 新たな問題が報告されていないか確認

### 5.2 パフォーマンス監視
- [ ] 5.2.1 地図の読み込み速度を確認
  - Chrome DevToolsのNetworkタブで確認
  - 3秒以内に表示されることを確認

- [ ] 5.2.2 Google Maps APIの使用量を確認
  - Google Cloud Consoleで使用量を確認
  - 無料枠内に収まっているか確認

---

## 完了条件

すべてのタスクが完了し、以下の条件を満たしていること:

1. ✅ スマホ画面で「地図で検索」ボタンが画面内に収まっている
2. ✅ 「地図で検索」ボタンをタップすると地図が正しく表示される
3. ✅ Google Mapsのエラーメッセージが表示されない
4. ✅ 物件マーカーが地図上に表示される
5. ✅ デスクトップ表示が壊れていない
6. ✅ 本番環境で正常に動作している

---

## 注意事項

- Google Cloud Consoleでの設定変更は慎重に行う
- APIキーの制限を緩めすぎないように注意
- 本番環境でのテストは必ず実施する
- 問題が発生した場合は速やかにロールバックする

---

## 推定作業時間

- タスク1: 1時間
- タスク2: 1〜2時間（Google Cloud Consoleの設定による）
- タスク3: 1時間
- タスク4: 30分
- タスク5: 継続的

**合計**: 約3.5〜4.5時間
