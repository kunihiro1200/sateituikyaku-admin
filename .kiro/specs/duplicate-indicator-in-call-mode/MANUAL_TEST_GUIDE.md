# 重複案件インジケーター機能 - 手動テストガイド

## テスト環境の準備

### 1. アプリケーションの起動

```bash
# ルートディレクトリで実行
start-dev.bat
```

または個別に起動:

```bash
# バックエンド
cd backend
npm run dev

# フロントエンド（別のターミナル）
cd frontend
npm run dev
```

### 2. ログイン

- ブラウザで `http://localhost:5173` にアクセス
- 有効なユーザーアカウントでログイン

## テストケース

### テストケース1: 重複案件が存在する売主での動作確認

**目的**: 重複案件インジケーターが正しく表示され、モーダルが開くことを確認

**手順**:
1. 通話モードページで重複案件を持つ売主を検索（例: AA5681）
2. 売主番号の右隣に「重複 (N)」バッジが表示されることを確認
   - ✅ バッジが警告色（オレンジ）で表示される
   - ✅ バッジがパルスアニメーションする
   - ✅ 正しい重複件数が表示される
3. 重複インジケーターバッジをクリック
   - ✅ モーダルダイアログが開く
   - ✅ ローディングインジケーターが表示される
4. モーダルの内容を確認
   - ✅ 各重複案件がカードで表示される
   - ✅ 売主番号、名前、反響日が表示される
   - ✅ マッチタイプ（電話番号/メールアドレス/両方）が表示される
   - ✅ マッチタイプに応じた色分けがされている
     - 両方: 赤（error）
     - 電話番号: オレンジ（warning）
     - メールアドレス: 青（info）

**期待結果**: すべての項目が正しく表示される

---

### テストケース2: スプレッドシートコメントの表示確認

**目的**: 重複案件のコメントが正しく表示されることを確認

**手順**:
1. テストケース1の続きから、モーダル内の重複案件カードを確認
2. 「スプレッドシートコメント」セクションを確認
   - ✅ コメントがある場合: グレーの背景で表示される
   - ✅ コメントがない場合: 「コメントはありません」と表示される
   - ✅ 改行が保持されている
   - ✅ 長いコメントは折り返される

**期待結果**: コメントが読みやすく表示される

---

### テストケース3: コミュニケーション履歴の表示確認

**目的**: 重複案件の活動履歴が正しく表示されることを確認

**手順**:
1. テストケース1の続きから、モーダル内の重複案件カードを確認
2. 「コミュニケーション履歴（最新20件）」セクションを確認
   - ✅ 履歴がある場合: 各活動が表示される
   - ✅ 履歴がない場合: 「履歴はありません」と表示される
3. 各活動項目を確認
   - ✅ 活動タイプに応じたアイコンが表示される
     - 電話: 📞 アイコン
     - メール: ✉️ アイコン
     - SMS: 💬 アイコン
   - ✅ 日時が日本語形式で表示される
   - ✅ 担当者名が表示される
   - ✅ 活動内容が表示される
4. 履歴が20件以上ある場合
   - ✅ 最新20件のみ表示される
   - ✅ スクロールバーが表示される

**期待結果**: 履歴が時系列で見やすく表示される

---

### テストケース4: 売主詳細ページへのリンク確認

**目的**: 重複案件から売主詳細ページに遷移できることを確認

**手順**:
1. テストケース1の続きから、モーダル内の売主番号をクリック
   - ✅ 売主番号がリンクとして表示される（青色）
   - ✅ ホバー時に下線が表示される
2. 売主番号をクリック
   - ✅ 新しいタブで売主詳細ページが開く
   - ✅ 元の通話モードページは開いたまま
   - ✅ モーダルも開いたまま

**期待結果**: 新しいタブで詳細ページが開き、元のページは保持される

---

### テストケース5: モーダルの閉じる動作確認

**目的**: モーダルが複数の方法で閉じられることを確認

**手順**:
1. テストケース1の続きから、モーダルを開いた状態で以下を試す

**方法1: 閉じるボタン**
- ✅ 右上の×ボタンをクリック
- ✅ モーダルが閉じる

**方法2: モーダル外クリック**
- ✅ モーダルの外側（背景）をクリック
- ✅ モーダルが閉じる

**方法3: Escキー**
- ✅ Escキーを押す
- ✅ モーダルが閉じる

**期待結果**: すべての方法でモーダルが正しく閉じる

---

### テストケース6: 重複案件がない売主での動作確認

**目的**: 重複がない場合にインジケーターが表示されないことを確認

**手順**:
1. 通話モードページで重複案件を持たない売主を検索
2. 売主番号の右隣を確認
   - ✅ 重複インジケーターバッジが表示されない
   - ✅ ページは正常に表示される

**期待結果**: 重複インジケーターが表示されず、通常通り動作する

---

### テストケース7: 複数の重複案件がある場合の確認

**目的**: 複数の重複案件が正しく表示されることを確認

**手順**:
1. 通話モードページで複数の重複案件を持つ売主を検索
2. 重複インジケーターバッジをクリック
3. モーダル内を確認
   - ✅ すべての重複案件がカードで表示される
   - ✅ 各カードが独立して表示される
   - ✅ スクロールして全ての重複案件を確認できる

**期待結果**: すべての重複案件が見やすく表示される

---

### テストケース8: エラーハンドリングの確認

**目的**: エラー時の動作を確認

**手順**:

**シナリオ1: 重複検出API失敗**
1. ネットワークをオフラインにする
2. 通話モードページを開く
   - ✅ ページは正常に表示される
   - ✅ 重複インジケーターは表示されない
   - ✅ エラーメッセージは表示されない（ユーザーには通知しない）
   - ✅ コンソールにエラーログが記録される

**シナリオ2: 詳細情報取得失敗**
1. ネットワークを不安定にする（開発者ツールでスロットリング）
2. 重複インジケーターをクリック
   - ✅ モーダルが開く
   - ✅ エラーメッセージが表示される
   - ✅ 「再試行」ボタンが表示される
3. 「再試行」ボタンをクリック
   - ✅ 再度データ取得を試みる

**期待結果**: エラーが適切に処理され、ユーザーに適切なフィードバックが提供される

---

### テストケース9: パフォーマンスの確認

**目的**: 機能が快適に動作することを確認

**手順**:
1. 通話モードページを開く
   - ✅ ページの初期表示が遅延しない（重複検出は非同期）
   - ✅ 2秒以内に重複インジケーターが表示される
2. 重複インジケーターをクリック
   - ✅ モーダルが即座に開く
   - ✅ 3秒以内に詳細情報が表示される
3. 10件の重複案件がある場合
   - ✅ 5秒以内にすべての詳細情報が表示される

**期待結果**: すべての操作が快適に動作する

---

### テストケース10: キャッシュの動作確認

**目的**: セッションキャッシュが正しく機能することを確認

**手順**:
1. 通話モードページで重複案件を持つ売主を開く
2. 重複インジケーターをクリックしてモーダルを開く
3. モーダルを閉じる
4. 再度重複インジケーターをクリック
   - ✅ 詳細情報が即座に表示される（キャッシュから取得）
   - ✅ ローディングインジケーターが表示されない
5. ページをリロード
6. 重複インジケーターをクリック
   - ✅ ローディングインジケーターが表示される
   - ✅ 詳細情報が再取得される

**期待結果**: キャッシュが正しく機能し、パフォーマンスが向上する

---

## テスト用データ

### 重複案件を持つ売主の例

以下の売主番号で重複案件の動作を確認できます:

- **AA5681**: 複数の重複案件を持つ可能性がある
- **AA12903**: 重複案件を持つ可能性がある
- **AA12923**: 重複案件を持つ可能性がある

### 重複案件を持たない売主の例

新規作成した売主や、ユニークな連絡先情報を持つ売主を使用してください。

---

## チェックリスト

すべてのテストケースを実施し、以下のチェックリストを完了してください:

- [ ] テストケース1: 重複案件が存在する売主での動作確認
- [ ] テストケース2: スプレッドシートコメントの表示確認
- [ ] テストケース3: コミュニケーション履歴の表示確認
- [ ] テストケース4: 売主詳細ページへのリンク確認
- [ ] テストケース5: モーダルの閉じる動作確認
- [ ] テストケース6: 重複案件がない売主での動作確認
- [ ] テストケース7: 複数の重複案件がある場合の確認
- [ ] テストケース8: エラーハンドリングの確認
- [ ] テストケース9: パフォーマンスの確認
- [ ] テストケース10: キャッシュの動作確認

---

## 問題が見つかった場合

問題が見つかった場合は、以下の情報を記録してください:

1. **テストケース番号**
2. **問題の詳細**
3. **再現手順**
4. **期待される動作**
5. **実際の動作**
6. **スクリーンショット**（可能であれば）
7. **ブラウザのコンソールエラー**

---

## テスト完了後

すべてのテストケースが成功したら:

1. チェックリストを完了としてマーク
2. タスク5.1を完了としてマーク
3. 次のタスク（5.2 ユーザーガイドを更新）に進む

問題が見つかった場合は:

1. 問題を記録
2. 開発者に報告
3. 修正後に再テスト
