# 実装計画: 買主詳細ナビゲーション修正

## 概要

このドキュメントは、買主詳細ページにおけるナビゲーションの一貫性を確保するための実装タスクを定義します。システム全体で`buyer_number`を主要な識別子として統一し、UUIDベースの`id`から移行します。

## タスク

- [x] 1. フロントエンドコンポーネントの修正
  - RelatedBuyersSectionとUnifiedInquiryHistoryTableのナビゲーションロジックを修正
  - `id`から`buyer_number`への変更
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 1.1 RelatedBuyersSectionコンポーネントの修正
  - `frontend/src/components/RelatedBuyersSection.tsx`を修正
  - ナビゲーションを`/buyers/${buyer.id}`から`/buyers/${buyer.buyer_number}`に変更
  - `buyer_number`が存在しない場合のエラーハンドリングを追加
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 1.2 UnifiedInquiryHistoryTableコンポーネントの修正
  - `frontend/src/components/UnifiedInquiryHistoryTable.tsx`を修正
  - ナビゲーションを`/buyers/${inquiry.buyer?.id}`から`/buyers/${inquiry.buyer?.buyer_number}`に変更
  - `buyer_number`が存在しない場合はプレーンテキストとして表示
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ]* 1.3 RelatedBuyersSectionのユニットテスト
  - `buyer_number`が存在する場合、正しいURLが生成されることを確認
  - `buyer_number`が存在しない場合、リンクがレンダリングされないことを確認
  - _要件: 2.1, 2.4_

- [ ]* 1.4 UnifiedInquiryHistoryTableのユニットテスト
  - `buyer_number`が存在する場合、正しいURLが生成されることを確認
  - `buyer_number`が存在しない場合、プレーンテキストが表示されることを確認
  - _要件: 3.1, 3.4_

- [x] 2. ルーティング設定の更新
  - App.tsxのルート定義を更新
  - URLパラメータ名を`id`から`buyer_number`に変更
  - _要件: 4.1, 4.2_

- [x] 2.1 App.tsxのルート定義を更新
  - `frontend/src/App.tsx`を修正
  - ルートパスを`/buyers/:id`から`/buyers/:buyer_number`に変更
  - _要件: 4.1_

- [x] 3. BuyerDetailPageの修正
  - URLパラメータの解析を更新
  - エラーハンドリングを追加
  - _要件: 4.2, 4.3, 4.4_

- [x] 3.1 BuyerDetailPageのパラメータ解析を修正
  - `frontend/src/pages/BuyerDetailPage.tsx`を修正
  - `useParams`で`id`の代わりに`buyer_number`を取得
  - `buyer_number`を数値に変換し、検証
  - _要件: 4.2, 4.3_

- [x] 3.2 BuyerDetailPageのエラーハンドリングを追加
  - 無効な`buyer_number`の場合、エラーメッセージを表示
  - 存在しない`buyer_number`の場合、404エラーを表示
  - 買主一覧ページへの戻るリンクを提供
  - _要件: 4.4_

- [ ]* 3.3 BuyerDetailPageのユニットテスト
  - 有効な`buyer_number`でデータが正しく取得されることを確認
  - 無効な`buyer_number`でエラーが表示されることを確認
  - 存在しない`buyer_number`で404エラーが表示されることを確認
  - _要件: 4.3, 4.4_

- [x] 4. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

- [ ]* 5. プロパティベーステストの実装
  - fast-checkを使用してプロパティテストを実装
  - 各プロパティテストは最低100回の反復で実行
  - _要件: すべて_

- [ ]* 5.1 プロパティ1のテスト: ナビゲーションURL一貫性
  - **プロパティ1: ナビゲーションURL一貫性**
  - **検証要件: 2.2, 3.2**
  - *すべての*有効な`buyer_number`値に対して、生成されるURLが`/buyers/{buyer_number}`形式であることを検証

- [ ]* 5.2 プロパティ2のテスト: buyer_number存在性チェック
  - **プロパティ2: buyer_number存在性チェック**
  - **検証要件: 2.4, 3.4**
  - *すべての*買主データオブジェクトに対して、`buyer_number`が存在する場合のみリンクがレンダリングされることを検証

- [ ]* 5.3 プロパティ3のテスト: URLパラメータ解析一貫性
  - **プロパティ3: URLパラメータ解析一貫性**
  - **検証要件: 4.1, 4.3**
  - *すべての*URLパラメータに対して、`buyer_number`として正しく解析され、数値として検証されることを確認

- [ ]* 5.4 プロパティ4のテスト: コンポーネント間データ伝達一貫性
  - **プロパティ4: コンポーネント間データ伝達一貫性**
  - **検証要件: 5.3**
  - *すべての*コンポーネント間のデータ伝達において、`buyer_number`が使用されることを検証

- [ ]* 5.5 プロパティ5のテスト: API呼び出し識別子一貫性
  - **プロパティ5: API呼び出し識別子一貫性**
  - **検証要件: 6.1, 6.2**
  - *すべての*API呼び出しにおいて、`buyer_number`がパラメータとして使用されることを検証

- [ ]* 6. 統合テストの実装
  - エンドツーエンドのナビゲーションフローをテスト
  - _要件: すべて_

- [ ]* 6.1 エンドツーエンドナビゲーションテスト
  - 買主一覧から買主詳細へのナビゲーションをテスト
  - 関連買主セクションからのナビゲーションをテスト
  - 問い合わせ履歴テーブルからのナビゲーションをテスト
  - _要件: 2.1, 3.1_

- [ ]* 6.2 エラーケースの統合テスト
  - 無効な`buyer_number`でのアクセスをテスト
  - 存在しない`buyer_number`でのアクセスをテスト
  - _要件: 4.4_

- [ ] 7. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

## 注意事項

- `*`マークが付いたタスクはオプションで、より速いMVPのためにスキップ可能です
- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントは段階的な検証を保証します
- プロパティテストは普遍的な正確性プロパティを検証します
- ユニットテストは特定の例とエッジケースを検証します
