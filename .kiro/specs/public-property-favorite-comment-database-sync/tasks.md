# Implementation Plan: お気に入り文言のデータベース同期

## Overview

スプレッドシートから「お気に入り文言」を取得し、`property_details` テーブルに保存するバッチスクリプトを作成します。既存のコード（バックエンド・フロントエンド）は変更不要です。

## Tasks

- [x] 1. バッチ同期スクリプトの作成
  - `sync-favorite-comments-to-database.ts` を作成
  - 公開中物件のみを対象にする
  - FavoriteCommentService を使用してスプレッドシートから取得
  - property_details テーブルに保存
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7_

- [ ] 2. コマンドラインオプションの実装
  - `--force`: 既存データを上書き
  - `--dry-run`: 実際には保存しない（テスト用）
  - `--limit N`: 処理する物件数を制限
  - `--property-number`: 特定の物件のみ処理
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 3. 進捗表示とロギングの実装
  - 処理中の物件番号を表示
  - 成功/失敗をカウント
  - エラーメッセージを詳細に記録
  - 最後にサマリーレポートを表示
  - _Requirements: 1.5, 4.4, 5.1, 5.2, 5.3, 5.4_

- [ ] 4. エラーハンドリングの実装
  - スプレッドシートURL未設定の場合
  - Google Sheets API エラーの場合
  - セルが空の場合
  - データベース保存エラーの場合
  - すべてのエラーで他の物件の処理を継続
  - _Requirements: 1.4, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 5. Checkpoint - テスト実行
  - 5件の物件でテスト実行
  - データベースに正しく保存されているか確認
  - エラーハンドリングが正しく動作するか確認
  - ユーザーに確認を求める

- [ ] 6. API エンドポイントの動作確認
  - `/api/public/properties/:id/complete` が `favorite_comment` を返すか確認
  - データベースから正しく取得できているか確認
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 7. フロントエンドの動作確認
  - 公開物件サイトの詳細画面を開く
  - お気に入り文言が表示されるか確認
  - スタイルが正しく適用されているか確認
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 8. Checkpoint - 部分的な同期実行
  - 10-20件の物件で同期を実行
  - 結果を確認
  - 問題があれば修正
  - ユーザーに確認を求める

- [ ] 9. 全体同期の実行
  - すべての公開中物件で同期を実行
  - 進捗をモニタリング
  - エラーログを確認
  - _Requirements: 4.1, 4.4, 4.5_

- [ ] 10. 最終確認
  - データベースの `favorite_comment` カバレッジを確認
  - 公開物件サイトで複数の物件を確認
  - エラーログを確認
  - サマリーレポートを生成

- [ ] 11. ドキュメント作成
  - スクリプトの使用方法を README に追加
  - トラブルシューティングガイドを作成
  - 今後の運用方法を記載

## Notes

- 既存のコード（バックエンド・フロントエンド）は変更不要
- FavoriteCommentService と PropertyDetailsService をそのまま使用
- エラーハンドリングは常にグレースフルデグラデーションを優先
- 段階的なロールアウトで安全性を確保

