# Requirements Document

## Introduction

売主リストをスプレッドシートから同期する際、売主情報は正しく同期されるが、関連する物件情報が作成されない問題を解決します。現在、通話モードページで売主を表示すると「物件情報が登録されていません」と表示され、物件番号、住所、物件種別などの物件詳細が確認できない状態です。この機能では、売主同期時に物件情報も自動的に作成・更新されるようにします。

## Glossary

- **System**: 売主管理システム
- **Seller**: 売主（不動産売却を検討している顧客）
- **Property**: 物件（売主が所有する不動産）
- **Spreadsheet**: Google スプレッドシート（売主リスト）
- **Database**: PostgreSQL データベース
- **Seller_Sync_Service**: 売主同期サービス
- **Property_Listings**: 物件情報テーブル

## Requirements

### Requirement 1

**User Story:** システム管理者として、売主リストを同期する際に物件情報も自動的に作成されることを期待する。そうすることで、通話モードページで物件詳細を確認できる。

#### Acceptance Criteria

1. WHEN 売主リストから売主データを同期する THEN システムは売主に関連する物件情報も同時に作成する
2. WHEN スプレッドシートに物件番号が存在する THEN システムは物件番号を使用して物件レコードを作成する
3. WHEN 物件レコードが既に存在する THEN システムは既存レコードを更新する
4. WHEN 物件レコードが存在しない THEN システムは新規レコードを作成する
5. WHEN 売主に物件番号が設定されていない THEN システムは物件レコードを作成しない

### Requirement 2

**User Story:** システム管理者として、スプレッドシートの物件情報フィールドがデータベースに正しくマッピングされることを期待する。そうすることで、物件詳細が正確に保存される。

#### Acceptance Criteria

1. WHEN スプレッドシートに物件住所が存在する THEN システムは物件レコードの`address`フィールドに保存する
2. WHEN スプレッドシートに物件種別が存在する THEN システムは物件レコードの`property_type`フィールドに保存する
3. WHEN スプレッドシートに土地面積が存在する THEN システムは物件レコードの`land_area`フィールドに保存する
4. WHEN スプレッドシートに建物面積が存在する THEN システムは物件レコードの`building_area`フィールドに保存する
5. WHEN スプレッドシートに築年月が存在する THEN システムは物件レコードの`construction_year_month`フィールドに保存する

### Requirement 3

**User Story:** システム管理者として、物件情報が売主情報と正しく関連付けられることを期待する。そうすることで、通話モードページで売主と物件の情報を一緒に表示できる。

#### Acceptance Criteria

1. WHEN 物件レコードを作成する THEN システムは`seller_id`フィールドに売主IDを設定する
2. WHEN 物件レコードを作成する THEN システムは`property_number`フィールドに物件番号を設定する
3. WHEN 売主レコードを作成する THEN システムは`property_number`フィールドに物件番号を設定する
4. WHEN 通話モードページで売主を表示する THEN システムは関連する物件情報を取得して表示する
5. WHEN 物件情報が存在しない THEN システムは「物件情報が登録されていません」と表示する

### Requirement 4

**User Story:** システム管理者として、物件情報の作成・更新がトランザクション内で実行されることを期待する。そうすることで、データの整合性が保たれる。

#### Acceptance Criteria

1. WHEN 売主同期処理を実行する THEN システムは売主情報と物件情報の作成・更新を同一トランザクション内で実行する
2. WHEN 物件情報の作成に失敗する THEN システムは売主情報の作成もロールバックする
3. WHEN 売主情報の作成に失敗する THEN システムは物件情報の作成もロールバックする
4. WHEN トランザクションが成功する THEN システムは売主情報と物件情報の両方をコミットする
5. WHEN トランザクションが失敗する THEN システムはエラーログを記録して処理を中断する

### Requirement 5

**User Story:** システム管理者として、物件情報の作成・更新ログが記録されることを期待する。そうすることで、問題発生時にトラブルシューティングができる。

#### Acceptance Criteria

1. WHEN 物件レコードを作成する THEN システムは作成ログを記録する
2. WHEN 物件レコードを更新する THEN システムは更新ログを記録する
3. WHEN 物件情報の作成に失敗する THEN システムはエラーログを記録する
4. WHEN ログを記録する THEN システムは売主番号、物件番号、操作内容を含める
5. WHEN ログを記録する THEN システムはタイムスタンプを含める

### Requirement 6

**User Story:** システム管理者として、既存の売主データに対して物件情報を一括作成できることを期待する。そうすることで、過去の売主データにも物件情報を追加できる。

#### Acceptance Criteria

1. WHEN 一括物件作成スクリプトを実行する THEN システムは物件番号を持つ全ての売主に対して物件レコードを作成する
2. WHEN 物件レコードが既に存在する THEN システムはスキップする
3. WHEN 物件レコードが存在しない THEN システムは新規作成する
4. WHEN 一括作成処理を実行する THEN システムは進捗状況をログに出力する
5. WHEN 一括作成処理が完了する THEN システムは作成件数とスキップ件数を報告する

### Requirement 7

**User Story:** ユーザーとして、通話モードページで物件情報が正しく表示されることを期待する。そうすることで、顧客との通話時に物件詳細を確認できる。

#### Acceptance Criteria

1. WHEN 通話モードページを開く THEN システムは売主に関連する物件情報を取得する
2. WHEN 物件情報が存在する THEN システムは物件番号、住所、物件種別、土地面積、建物面積を表示する
3. WHEN 物件情報が存在しない THEN システムは「物件情報が登録されていません」と表示する
4. WHEN 物件種別が英語コードの場合 THEN システムは日本語ラベルに変換して表示する
5. WHEN 物件情報を更新する THEN システムは通話モードページに最新の情報を反映する

