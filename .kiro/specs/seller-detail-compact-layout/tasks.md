# Implementation Plan - 売主詳細画面コンパクトレイアウト

## 1. 基本コンポーネントの作成

- [x] 1.1 EditableSectionコンポーネントを作成
  - セクションヘッダーに編集/キャンセル/保存ボタンを配置
  - 読み取り専用モードと編集モードの切り替え
  - 保存中のローディング状態表示
  - _Requirements: 9.1, 9.2, 9.3, 10.1, 10.3_

- [x] 1.2 CollapsibleSectionコンポーネントを作成
  - ヘッダークリックで展開/折りたたみ
  - 件数表示機能（オプション）
  - スムーズなアニメーション
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 1.3 CompactBuyerListコンポーネントを作成
  - 固定高さ（300-350px）のコンテナ
  - 内部スクロール機能
  - 買主情報を1行で表示（氏名、受付日、内覧日、買付有無）
  - 空の場合の「買主なし」メッセージ
  - スクロール可能時の下部フェード効果
  - _Requirements: 1.2, 1.3, 4.1, 4.2, 4.3, 4.4, 8.1, 8.2, 8.3, 8.4, 8.5_

## 2. レイアウト構造の変更

- [x] 2.1 SellerDetailPageのレイアウトを2カラムに変更
  - デスクトップ（>1200px）: 2カラムグリッド（7/12 + 5/12）
  - タブレット（768-1200px）: 1カラム縦積み
  - モバイル（<768px）: 1カラム縦積み
  - _Requirements: 5.1, 5.5_

- [x] 2.2 セクション間のパディングとマージンを削減
  - セクションパディング: 24px → 12px
  - セクションマージン: 24px → 8-12px
  - グリッドスペーシング: spacing={3} → spacing={2}
  - _Requirements: 5.2, 5.3_

- [x] 2.3 査定情報セクションを上部に配置
  - 大きなフォントサイズ（18-20px）で金額を表示
  - 横並びレイアウト（例: 3,500万円 ～ 3,800万円 ～ 4,000万円）
  - 査定担当者名を小さいテキストで表示
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

## 3. 物件情報セクションのコンパクト化

- [x] 3.1 物件情報のフォントサイズを削減
  - ラベル: 11-12px
  - 値: 13-14px
  - 適切な行間を維持
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3.2 物件情報のフィールド順序を変更
  - 上部: 住所、種別、土地面積、間取り
  - 下部: 建物面積、築年、構造、契約日、決済日
  - 空フィールドは非表示
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.3 物件情報セクションにEditableSectionを適用
  - 読み取り専用モード: フォーマットされたテキスト表示
  - 編集モード: 入力フィールド表示
  - 編集/保存/キャンセルボタン
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 10.1, 10.2, 10.3, 10.4_

## 4. 売主情報セクションの編集機能実装

- [x] 4.1 売主情報セクションにEditableSectionを適用
  - 読み取り専用モード: テキスト表示
  - 編集モード: TextField表示（氏名、住所、電話番号）
  - 編集/保存/キャンセルボタン
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 10.1, 10.2, 10.3, 10.4_

- [ ] 4.2 売主情報の保存処理を実装
  - PUT /api/sellers/:id エンドポイント呼び出し
  - 売主情報のみを送信（name, address, phoneNumber）
  - 成功時: データ再取得、編集モード終了、成功メッセージ表示
  - エラー時: エラーメッセージ表示、編集モード維持
  - _Requirements: 9.4, 9.5_

## 5. 管理情報セクションの編集機能実装

- [ ] 5.1 管理情報セクションにEditableSectionを適用
  - 読み取り専用モード: テキスト/チップ表示
  - 編集モード: Select/TextField表示
  - 編集/保存/キャンセルボタン
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 10.1, 10.2, 10.3, 10.4_

- [ ] 5.2 管理情報の保存処理を実装
  - PUT /api/sellers/:id エンドポイント呼び出し
  - 管理情報のみを送信（status, confidence, nextCallDate等）
  - 成功時: データ再取得、編集モード終了、成功メッセージ表示
  - エラー時: エラーメッセージ表示、編集モード維持
  - _Requirements: 9.4, 9.5_

## 6. 買主リストの実装

- [x] 6.1 CompactBuyerListを統合
  - 既存のBuyerTableをCompactBuyerListに置き換え
  - 固定高さコンテナ内に配置
  - 買主データをCompactBuyerListに渡す
  - _Requirements: 1.2, 1.3, 8.1, 8.2, 8.3_

- [x] 6.2 買主表示フォーマットを実装
  - 1行表示: [氏名] | 受付: YYYY/MM/DD | 内覧: YYYY/MM/DD | 買付: あり/なし
  - 確度レベルのカラーバッジ（A: green, B: blue, C: orange）
  - 日付フォーマット関数
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

## 7. 折りたたみセクションの実装

- [x] 7.1 Google Chat通知セクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 7.2 訪問査定予約セクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - 件数表示（予約数）
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 7.3 AI電話統合セクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - 件数表示（通話履歴数）
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 7.4 追客ログセクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - 件数表示（ログ数）
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 7.5 業務依頼セクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - 件数表示（依頼数）
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 7.6 メール送信履歴セクションを折りたたみ可能に
  - CollapsibleSectionでラップ
  - 件数表示（メール数）
  - デフォルトは折りたたみ状態
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

## 8. 状態管理の実装

- [ ] 8.1 セクション編集状態の管理
  - editingStatesステート追加（sellerInfo, propertyInfo, managementInfo）
  - 一度に1つのセクションのみ編集可能にする制御
  - _Requirements: 10.5_

- [ ] 8.2 編集データの管理
  - editedDataステート追加（seller, property, management）
  - フィールド変更時にeditedDataを更新
  - キャンセル時にeditedDataをクリア
  - _Requirements: 9.4, 10.4_

- [ ] 8.3 保存状態の管理
  - savingSectionステート追加
  - 保存中のセクションを追跡
  - 保存中は他のセクションの編集を無効化
  - _Requirements: 9.4_

- [ ] 8.4 折りたたみ状態の管理
  - expandedSectionsステート追加
  - 各セクションの展開/折りたたみ状態を保存
  - _Requirements: 6.2, 6.3_

## 9. レスポンシブ対応

- [ ] 9.1 デスクトップレイアウトの実装
  - 2カラムグリッド（>1200px）
  - 左カラム: 管理情報 + 物件情報
  - 右カラム: 買主リスト + 売主情報
  - _Requirements: 5.1_

- [ ] 9.2 タブレットレイアウトの実装
  - 1カラムレイアウト（768-1200px）
  - 縦積み表示
  - パディング調整
  - _Requirements: 5.5_

- [ ] 9.3 モバイルレイアウトの実装
  - 1カラムレイアウト（<768px）
  - フォントサイズをさらに削減（-1px）
  - パディングを最小化（6-8px）
  - _Requirements: 5.5_

## 10. パフォーマンス最適化

- [ ] 10.1 React.memoでセクションコンポーネントを最適化
  - EditableSection, CompactBuyerList, CollapsibleSectionをメモ化
  - 不要な再レンダリングを防止
  - _Requirements: なし（パフォーマンス）_

- [ ] 10.2 フィールド変更のデバウンス実装
  - テキスト入力を300msデバウンス
  - Select/Checkboxは即座に更新
  - _Requirements: なし（パフォーマンス）_

- [ ] 10.3 買主リストの仮想化（オプション）
  - 買主数が20を超える場合にreact-windowを使用
  - 表示されている行のみレンダリング
  - _Requirements: なし（パフォーマンス）_

## 11. アクセシビリティ対応

- [ ] 11.1 キーボードナビゲーションの実装
  - Tab: セクション間とボタン間の移動
  - Enter: 編集/保存/キャンセルボタンの実行
  - Escape: 編集モードのキャンセル
  - _Requirements: なし（アクセシビリティ）_

- [ ] 11.2 ARIAラベルの追加
  - 編集/保存/キャンセルボタンにaria-label
  - 折りたたみセクションにaria-expanded
  - スクリーンリーダー対応
  - _Requirements: なし（アクセシビリティ）_

## 12. スタイリングとUI改善

- [ ] 12.1 査定情報セクションのスタイリング
  - 大きなフォント（18-20px）
  - 横並びレイアウト
  - 目立つ表示
  - _Requirements: 7.1, 7.2_

- [ ] 12.2 編集モードのビジュアルインジケーター
  - 編集中のセクションに左ボーダー（3px solid primary）
  - 背景色の微調整
  - _Requirements: なし（UX改善）_

- [ ] 12.3 買主リストのスクロールインジケーター
  - スクロール可能な場合に下部フェード効果
  - スクロールバーのスタイリング
  - _Requirements: 8.5_

- [ ] 12.4 セクションヘッダーのスタイリング
  - コンパクトなタイポグラフィ（16-18px）
  - 一貫したスタイル
  - 視覚的な区切り
  - _Requirements: 5.3_

## 13. エラーハンドリングとバリデーション

- [ ] 13.1 保存時のエラーハンドリング
  - ネットワークエラーの処理
  - バリデーションエラーの表示
  - エラー時は編集モードを維持
  - _Requirements: 9.5_

- [ ] 13.2 フィールドバリデーション
  - 必須フィールドのチェック
  - フォーマットバリデーション（電話番号、メールなど）
  - インラインエラーメッセージ
  - _Requirements: なし（データ整合性）_

## 14. テストとデバッグ

- [ ] 14.1 コンポーネント単体テスト
  - EditableSectionの動作テスト
  - CompactBuyerListのレンダリングテスト
  - CollapsibleSectionの展開/折りたたみテスト
  - _Requirements: なし（品質保証）_

- [ ] 14.2 編集フローの統合テスト
  - 各セクションの編集→保存フロー
  - キャンセル時のデータ復元
  - 複数セクションの順次編集
  - _Requirements: なし（品質保証）_

- [ ] 14.3 レスポンシブ動作テスト
  - 各ブレークポイントでの表示確認
  - リサイズ時の動作確認
  - モバイルデバイスでの実機テスト
  - _Requirements: なし（品質保証）_

## 15. ドキュメントとクリーンアップ

- [ ] 15.1 既存の編集ボタンとロジックを削除
  - 物件情報セクションの既存編集ボタンを削除
  - 売主情報セクションの既存編集ボタンを削除
  - 未使用のステート変数を削除
  - _Requirements: なし（クリーンアップ）_

- [ ] 15.2 コードコメントとドキュメント更新
  - 新しいコンポーネントにJSDocコメント追加
  - README更新（必要に応じて）
  - _Requirements: なし（ドキュメント）_

## 16. Final Checkpoint - 全体動作確認

- [ ] 16. Ensure all tests pass, ask the user if questions arise.
