# 売主リスト ステータス表示ロジック実装

## 概要

売主リスト（ローカル環境）において、複数の条件に基づいてステータスを表示する機能を実装します。

---

## ユーザーストーリー

### US-1: 当日TEL（未着手）の表示
**As a** 営業担当者  
**I want to** 次電日が過去で追客中かつ不通でない売主を確認したい  
**So that** 当日中に電話すべき売主を見逃さない

### US-2: 不通ステータスの表示
**As a** 営業担当者  
**I want to** 不通の売主を一目で確認したい  
**So that** 不通の売主に対して適切なフォローアップができる

### US-3: 訪問日前日の表示
**As a** 営業担当者  
**I want to** 翌日訪問予定の売主を前日に確認したい  
**So that** 訪問準備を事前に行える

### US-4: 当日TEL（担当名）の表示
**As a** 営業担当者  
**I want to** 電話担当が割り当てられている売主を確認したい  
**So that** 担当者が当日中に電話すべき売主を把握できる

### US-5: Pinrich空欄の表示
**As a** 営業担当者  
**I want to** Pinrich情報が未入力の売主を確認したい  
**So that** データの入力漏れを防げる

---

## 受入基準

### AC-1: 当日TEL（未着手）の表示条件

**Given** 売主リストが表示されている  
**When** 以下の全ての条件を満たす売主がいる場合：
- 次電日が今日を含めて過去である
- 状況（当社）カラムに「追客中」という文言を含む
- 不通カラム（スプレッドシートID: `1wKBRLWbT6pSKa9IlTDabjhjTnfs_GxX6Rn6M6kbio1I` のJ列）が空欄である

**Then** その売主のステータスに「当日TEL（未着手）」と表示される

---

### AC-2: 不通ステータスの表示条件

**Given** 売主リストが表示されている  
**When** 不通カラム（スプレッドシートID: `1wKBRLWbT6pSKa9IlTDabjhjTnfs_GxX6Rn6M6kbio1I` のJ列）に値がある売主がいる場合  
**Then** その売主のステータスに「不通」と表示される

---

### AC-3: 訪問日前日の表示条件

**Given** 売主リストが表示されている  
**When** 以下の条件を満たす売主がいる場合：
- 訪問日（注意：訪問取得日ではない）が翌日である
- ただし、水曜日は休みのため、訪問日が木曜日の場合は火曜日（前々日）に表示される

**Then** その売主のステータスに「訪問日前日」と表示される

**例**:
- 今日が火曜日、訪問日が水曜日 → 「訪問日前日」表示
- 今日が火曜日、訪問日が木曜日 → 「訪問日前日」表示（水曜休みのため）
- 今日が月曜日、訪問日が火曜日 → 「訪問日前日」表示
- 今日が月曜日、訪問日が木曜日 → 表示されない

---

### AC-4: 当日TEL（担当名）の表示条件

**Given** 売主リストが表示されている  
**When** 以下の全ての条件を満たす売主がいる場合：
- 電話担当（任意）カラムに誰かのイニシャルが入っている
- 次電日が本日を含めて過去である

**Then** その売主のステータスに「当日TEL（担当名）」と表示される（担当名はイニシャル）

**例**:
- 電話担当カラムに「A」、次電日が昨日 → 「当日TEL（A）」表示
- 電話担当カラムに「B」、次電日が今日 → 「当日TEL（B）」表示
- 電話担当カラムが空欄、次電日が昨日 → 表示されない

---

### AC-5: Pinrich空欄の表示条件

**Given** 売主リストが表示されている  
**When** Pinrichカラムが空欄の売主がいる場合  
**Then** その売主のステータスに「Pinrich空欄」と表示される

---

### AC-6: 複数ステータスの表示

**Given** 売主リストが表示されている  
**When** 1つの売主が複数のステータス条件を満たす場合  
**Then** 全てのステータスがカンマ区切りで表示される

**表示形式**: `ステータス1, ステータス2, ステータス3`

**例**:
- 不通カラムに値があり、かつPinrichが空欄 → 「不通, Pinrich空欄」
- 訪問日が翌日で、かつ電話担当がある → 「訪問日前日, 当日TEL（A）」
- 次電日が過去で追客中、かつPinrichが空欄 → 「当日TEL（未着手）, Pinrich空欄」

**注意**: 優先順位は設けず、条件を満たす全てのステータスを表示する

---

### AC-7: ステータスの表示位置

**Given** 売主リストが表示されている  
**When** ステータス条件を満たす売主がいる場合  
**Then** テーブルの「ステータス」カラムに表示される

**表示位置**: 
- 既存の「ステータス」カラム（スクリーンショット参照）
- テーブルの右側に配置

---

## データソース

### スプレッドシート情報

**スプレッドシートID**: `1wKBRLWbT6pSKa9IlTDabjhjTnfs_GxX6Rn6M6kbio1I`

**関連カラム**:
- **不通**: J列（10列目）
- **次電日**: D列（4列目）
- **状況（当社）**: AH列（34列目）
- **訪問日 Y/M/D**: AB列（28列目）
- **電話担当（任意）**: CQ列（95列目）
- **Pinrich**: BF列（58列目）

**日付フォーマット**:
- 訪問日 Y/M/D: `2026/1/27`形式（スラッシュ区切り）
- 次電日: `2026/1/27`形式（スラッシュ区切り）

**休業日**:
- 水曜日のみ休み
- 祝日は考慮しない

---

## 非機能要件

### NFR-1: パフォーマンス
- ステータス判定は1秒以内に完了すること
- 売主リストの表示速度に影響を与えないこと

### NFR-2: 保守性
- ステータス判定ロジックは独立した関数として実装すること
- 優先順位の変更が容易であること

### NFR-3: 拡張性
- 新しいステータス条件を追加しやすい設計であること

---

## 制約事項

1. **環境**: ローカル環境のみで使用
2. **休業日**: 水曜日のみ休み（訪問日前日の計算に影響）
3. **日付比較**: 「今日を含めて過去」は、今日の日付 >= 次電日
4. **訪問日**: 訪問取得日ではなく、訪問日（AB列）を使用
5. **複数ステータス**: 全てのステータスをカンマ区切りで表示
6. **日付フォーマット**: `2026/1/27`形式（スラッシュ区切り、Y/M/D）

---

## 除外事項

- 本番環境への展開（ローカル環境のみ）
- ステータスの編集機能（表示のみ）
- ステータスに基づくフィルタリング機能（将来的に検討）

---

## 確認完了事項

### ✅ 全ての確認が完了しました

1. **カラム名の確認** ✅
   - 次電日: D列
   - 状況（当社）: AH列
   - 訪問日 Y/M/D: AB列
   - 電話担当（任意）: CQ列
   - Pinrich: BF列
   - 不通: J列

2. **表示位置** ✅
   - 現在の「ステータス」カラムに表示（スクリーンショット参照）
   - テーブルの右側に表示される

3. **複数ステータスの扱い** ✅
   - **オプションB**: 複数のステータスを全て表示
   - 例: 「不通, Pinrich空欄」のように複数表示

4. **休業日** ✅
   - 水曜日のみ休み
   - 祝日は考慮しない

5. **次電日のフォーマット** ✅
   - `2026/1/27`形式（スラッシュ区切り、Y/M/D）

---

**作成日**: 2026年1月27日  
**最終更新日**: 2026年1月27日  
**ステータス**: ✅ 要件定義完了
