# おすすめコメント表示機能 - タスクリスト

## フェーズ1: バックエンド実装

### タスク1.1: RecommendedCommentService の作成
- [ ] `backend/src/services/RecommendedCommentService.ts` を作成
- [ ] 物件タイプからセル位置を取得するメソッドを実装
- [ ] スプレッドシートからコメントを取得するメソッドを実装
- [ ] エラーハンドリングとログ出力を実装
- [ ] TypeScript型定義を追加

**推定時間**: 2時間

### タスク1.2: APIエンドポイントの追加
- [ ] `backend/src/routes/publicProperties.ts` に新しいルートを追加
- [ ] `GET /api/public/properties/:id/recommended-comment` エンドポイントを実装
- [ ] 物件情報の取得とコメント取得を統合
- [ ] エラーレスポンスの実装
- [ ] レスポンス形式の検証

**推定時間**: 1.5時間

### タスク1.3: ユニットテストの作成
- [ ] `backend/src/services/__tests__/RecommendedCommentService.test.ts` を作成
- [ ] セル位置取得のテストケースを作成
- [ ] コメント取得のテストケースを作成
- [ ] エラーハンドリングのテストケースを作成
- [ ] モックを使用したスプレッドシートアクセスのテスト

**推定時間**: 2時間

## フェーズ2: フロントエンド実装

### タスク2.1: RecommendedCommentSection コンポーネントの作成
- [ ] `frontend/src/components/RecommendedCommentSection.tsx` を作成
- [ ] Material-UIを使用したUIデザインの実装
- [ ] ローディング状態の実装
- [ ] エラー状態の実装
- [ ] レスポンシブデザインの実装

**推定時間**: 2時間

### タスク2.2: publicApi サービスの拡張
- [ ] `frontend/src/services/publicApi.ts` に新しいメソッドを追加
- [ ] `getRecommendedComment` 関数を実装
- [ ] エラーハンドリングを実装
- [ ] TypeScript型定義を追加

**推定時間**: 0.5時間

### タスク2.3: PublicPropertyDetailPage の更新
- [ ] `frontend/src/pages/PublicPropertyDetailPage.tsx` を更新
- [ ] RecommendedCommentSection コンポーネントをインポート
- [ ] 画像ギャラリーの下にコンポーネントを配置
- [ ] レイアウトの調整

**推定時間**: 0.5時間

### タスク2.4: コンポーネントテストの作成
- [ ] `frontend/src/components/__tests__/RecommendedCommentSection.test.tsx` を作成
- [ ] レンダリングテストを作成
- [ ] ローディング状態のテストを作成
- [ ] エラー状態のテストを作成
- [ ] コメント表示のテストを作成

**推定時間**: 1.5時間

## フェーズ3: 統合とテスト

### タスク3.1: インテグレーションテスト
- [ ] バックエンドとフロントエンドの統合テスト
- [ ] 各物件タイプ（土地、戸建て、マンション）でテスト
- [ ] コメントがない場合のテスト
- [ ] エラーケースのテスト

**推定時間**: 2時間

### タスク3.2: E2Eテスト
- [ ] 公開物件詳細ページでのE2Eテストを作成
- [ ] コメント表示の確認
- [ ] レスポンシブデザインの確認
- [ ] エラーハンドリングの確認

**推定時間**: 1.5時間

### タスク3.3: パフォーマンステスト
- [ ] ページ読み込み時間の測定
- [ ] スプレッドシートアクセスのレスポンスタイムを測定
- [ ] キャッシングの動作確認
- [ ] 並列リクエストの動作確認

**推定時間**: 1時間

## フェーズ4: ドキュメントとデプロイ

### タスク4.1: ドキュメント作成
- [ ] API仕様書の更新
- [ ] README の更新
- [ ] 運用マニュアルの作成
- [ ] トラブルシューティングガイドの作成

**推定時間**: 1.5時間

### タスク4.2: デプロイ準備
- [ ] 環境変数の確認
- [ ] デプロイスクリプトの更新
- [ ] ロールバック手順の確認
- [ ] モニタリング設定の確認

**推定時間**: 1時間

### タスク4.3: 本番デプロイ
- [ ] ステージング環境へのデプロイ
- [ ] ステージング環境での動作確認
- [ ] 本番環境へのデプロイ
- [ ] 本番環境での動作確認
- [ ] エラーログの監視

**推定時間**: 2時間

## フェーズ5: 監視と改善

### タスク5.1: 監視設定
- [ ] エラーログの監視設定
- [ ] パフォーマンスメトリクスの設定
- [ ] アラート設定
- [ ] ダッシュボードの作成

**推定時間**: 1時間

### タスク5.2: フィードバック収集と改善
- [ ] ユーザーフィードバックの収集
- [ ] パフォーマンスデータの分析
- [ ] 改善点の特定
- [ ] 優先順位付け

**推定時間**: 継続的

## 総推定時間

- **フェーズ1**: 5.5時間
- **フェーズ2**: 4.5時間
- **フェーズ3**: 4.5時間
- **フェーズ4**: 4.5時間
- **フェーズ5**: 1時間

**合計**: 約20時間（2.5日）

## 依存関係

- タスク1.2は1.1に依存
- タスク1.3は1.1と1.2に依存
- タスク2.2は1.2に依存
- タスク2.3は2.1と2.2に依存
- タスク3.1は全てのフェーズ1と2のタスクに依存
- タスク4.3は全てのフェーズ3のタスクに依存

## リスクと対策

### リスク1: スプレッドシートの構造変更
**対策**: セル位置を環境変数で管理できるようにする

### リスク2: スプレッドシートアクセスのパフォーマンス
**対策**: キャッシング戦略を強化、CDNの活用

### リスク3: 物件タイプの不一致
**対策**: 物件タイプのマッピングテーブルを作成、ログで監視

### リスク4: 認証エラー
**対策**: サービスアカウントの権限を事前確認、エラーログの監視

## 次のステップ

1. 要件定義と設計のレビュー
2. タスクの優先順位付け
3. 開発環境のセットアップ
4. フェーズ1の実装開始
