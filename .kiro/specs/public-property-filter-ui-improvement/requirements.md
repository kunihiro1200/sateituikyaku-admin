# 物件公開サイト フィルターUI改善

## 概要
物件公開サイトのフィルターUIを再構成し、物件タイプボタンを最上部に配置した新しい垂直レイアウトを実装します。既存のフィルター機能はすべて維持しながら、ユーザビリティを向上させます。

## 背景
- **TASK 1 (完了)**: PropertyTypeFilterButtonsコンポーネントを削除
- **TASK 2 (完了)**: 7つのNode.jsプロセスとキャッシュ問題を解決
- **TASK 3 (進行中)**: 新しいフィルターレイアウトの実装

## ユーザーストーリー

### US-1: 物件タイプフィルター（最上部）
**As a** 物件を探しているユーザー  
**I want to** 物件タイプ（戸建て、マンション、土地、収益物件）をボタンで選択できる  
**So that** 興味のある物件タイプに素早く絞り込める

**受け入れ基準:**
- [ ] 物件タイプボタンが「物件を絞り込む」セクションの最上部に表示される
- [ ] 4つのボタン: 戸建て、マンション、土地、収益物件
- [ ] 複数選択可能（トグル動作）
- [ ] 選択されたボタンは視覚的に区別される
- [ ] 選択状態がURLクエリパラメータに反映される
- [ ] ページリロード時に選択状態が復元される

### US-2: 価格帯フィルター（2番目）
**As a** 予算が決まっているユーザー  
**I want to** 価格範囲を指定できる  
**So that** 予算内の物件だけを表示できる

**受け入れ基準:**
- [ ] 最低価格と最高価格の入力フィールドが表示される
- [ ] 単位は「万円」で表示
- [ ] 入力値のバリデーション（最低価格 ≤ 最高価格）
- [ ] Enterキーまたはフォーカスアウトで適用
- [ ] 既存の機能を完全に維持

### US-3: 築年数フィルター（3番目）
**As a** 築年数にこだわりがあるユーザー  
**I want to** 築年数範囲を指定できる  
**So that** 希望する築年数の物件だけを表示できる

**受け入れ基準:**
- [ ] 最小築年数と最大築年数の入力フィールドが表示される
- [ ] 単位は「年」で表示
- [ ] 入力値のバリデーション（最小 ≤ 最大、0以上）
- [ ] Enterキーまたはフォーカスアウトで適用
- [ ] 既存の機能を完全に維持

### US-4: フィルター状態管理
**As a** ユーザー  
**I want to** 適用中のフィルターを確認・削除できる  
**So that** 現在の絞り込み条件を把握し、簡単に変更できる

**受け入れ基準:**
- [ ] 適用中のフィルターがチップで表示される
- [ ] 各チップに削除ボタンがある
- [ ] 「すべてクリア」ボタンで全フィルターを解除
- [ ] 検索結果件数が表示される
- [ ] URLクエリパラメータと同期

## 技術要件

### コンポーネント構造
```
PublicPropertyListingPage
├── PublicPropertyHero (検索バー)
└── PublicPropertyFilters (新レイアウト)
    ├── 物件タイプボタン群 (新規追加)
    ├── 価格範囲入力 (既存)
    ├── 築年数範囲入力 (既存)
    ├── アクティブフィルタチップ (既存)
    └── すべてクリアボタン (既存)
```

### データフロー
1. **物件タイプ選択**: `types: string[]` として管理
2. **価格範囲**: `minPrice: number`, `maxPrice: number` (既存)
3. **築年数範囲**: `minAge: number`, `maxAge: number` (既存)
4. **URL同期**: すべてのフィルター状態をクエリパラメータに反映

### API連携
- `usePublicProperties` フックは既に `types` パラメータをサポート
- バックエンドAPIは複数物件タイプフィルターに対応済み

## 実装ファイル

### 修正が必要なファイル
1. **frontend/src/components/PublicPropertyFilters.tsx**
   - 物件タイプボタン群を追加
   - レイアウトを垂直構造に再構成
   - 既存の価格・築年数フィルター機能を維持

2. **frontend/src/pages/PublicPropertyListingPage.tsx**
   - フィルター状態管理の確認（変更不要の可能性が高い）

3. **frontend/src/types/publicProperty.ts**
   - `PublicPropertyFilters` インターフェースの確認（既に `types` フィールドあり）

### 新規作成は不要
- 既存のコンポーネントとフックを活用

## UI/UXガイドライン

### レイアウト
```
┌─────────────────────────────────────┐
│ 物件を絞り込む                        │
├─────────────────────────────────────┤
│ 物件タイプ                           │
│ [戸建て] [マンション] [土地] [収益物件] │ ← 最上部
├─────────────────────────────────────┤
│ 価格帯（万円）                        │
│ [最低価格] 〜 [最高価格]              │ ← 2番目
├─────────────────────────────────────┤
│ 築年数（年）                          │
│ [最小築年数] 〜 [最大築年数]          │ ← 3番目
├─────────────────────────────────────┤
│ 適用中のフィルタ                      │
│ [チップ1] [チップ2] ...              │
├─────────────────────────────────────┤
│ 12件の物件が見つかりました            │
│ [すべてクリア]                        │
└─────────────────────────────────────┘
```

### スタイリング
- **物件タイプボタン**:
  - 未選択: `variant="outlined"`, `color="default"`
  - 選択済み: `variant="contained"`, `color="primary"`
  - ホバー時に視覚的フィードバック
  - レスポンシブ: モバイルでは2列表示

- **入力フィールド**:
  - Material-UI TextField コンポーネント
  - 既存のスタイルを維持

- **チップ**:
  - Material-UI Chip コンポーネント
  - 削除可能（onDelete prop）

## 非機能要件

### パフォーマンス
- [ ] フィルター変更時の不要な再レンダリングを防ぐ
- [ ] URLクエリパラメータの更新は `replace: true` で履歴を汚さない
- [ ] デバウンス不要（ボタンクリックとEnter/Blurで適用）

### アクセシビリティ
- [ ] キーボード操作可能（Tab, Enter, Space）
- [ ] スクリーンリーダー対応（適切なaria-label）
- [ ] フォーカス状態の視覚的表示

### ブラウザ互換性
- [ ] Chrome, Firefox, Safari, Edge の最新版
- [ ] モバイルブラウザ対応

## テスト要件

### 手動テスト
1. **物件タイプフィルター**
   - [ ] 各ボタンをクリックして選択/解除できる
   - [ ] 複数選択が可能
   - [ ] URLに反映される
   - [ ] ページリロード後も状態が保持される

2. **価格・築年数フィルター**
   - [ ] 既存の機能が正常に動作する
   - [ ] バリデーションエラーが適切に表示される

3. **統合テスト**
   - [ ] すべてのフィルターを組み合わせて使用できる
   - [ ] 「すべてクリア」で全フィルターが解除される
   - [ ] 検索結果が正しく絞り込まれる

### 自動テスト（推奨）
- コンポーネントの単体テスト
- フィルター状態管理のテスト

## 成功基準
1. ✅ 物件タイプボタンが最上部に表示される
2. ✅ 既存のフィルター機能がすべて動作する
3. ✅ URLクエリパラメータと同期する
4. ✅ レスポンシブデザインが機能する
5. ✅ キャッシュ問題が発生しない（Task 2で解決済み）

## リスクと対策

### リスク1: キャッシュ問題の再発
**対策**: 
- 開発サーバーを完全に停止してから再起動
- ブラウザのハードリフレッシュ（Ctrl+Shift+R）

### リスク2: 既存機能の破壊
**対策**:
- 既存のフィルターロジックは変更しない
- 段階的な実装とテスト

## 参考情報

### 関連ドキュメント
- PROPERTY_TYPE_FILTER_BUTTONS_REMOVAL_COMPLETE.md
- 物件タイプフィルターボタン_根本原因特定.md

### 既存の実装
- `frontend/src/hooks/usePublicProperties.ts`: `types` パラメータサポート済み
- バックエンドAPI: 複数物件タイプフィルター対応済み

## 次のステップ
1. PublicPropertyFilters.tsx に物件タイプボタンを追加
2. レイアウトを垂直構造に再構成
3. 手動テストで動作確認
4. ブラウザキャッシュクリアして最終確認
