# Call Mode Quick Button Disable - User Guide

## 機能概要

通話モードページのEmailテンプレートとSMSテンプレートのクイックボタンは、一度使用すると自動的に無効化されます。これにより、誤って同じテンプレートを複数回送信することを防ぎます。

## 使い方

### 1. クイックボタンをクリック

通話モードページで、EmailまたはSMSテンプレートを選択します。

**Email送信ドロップダウン**:
- 送信したいEmailテンプレートを選択
- テンプレートが「保存待ち」状態になります（オレンジ色のChip表示）

**SMS送信ドロップダウン**:
- 送信したいSMSテンプレートを選択
- テンプレートが「保存待ち」状態になります（オレンジ色のChip表示）

### 2. 通話メモを入力

通話内容をメモ欄に入力します。

### 3. 保存ボタンをクリック

「保存」ボタンをクリックすると:
- 通話メモが保存されます
- クイックボタンの状態が「使用済み」に変わります（グレーのChip表示）
- ボタンは永久に無効化されます

## 状態の種類

### 🟢 有効（デフォルト）
- ボタンは通常通りクリック可能
- Chipは表示されません

### 🟠 保存待ち（Pending）
- ボタンをクリックしたが、まだ保存していない状態
- オレンジ色の「保存待ち」Chipが表示されます
- ボタンは無効化されています（opacity: 0.5、cursor: not-allowed）
- **保存せずにページを離れると、この状態はリセットされます**

### ⚫ 使用済み（Persisted）
- 保存ボタンをクリックして永続化された状態
- グレーの「使用済み」Chipが表示されます
- ボタンは永久に無効化されています
- **ページをリロードしても状態は保持されます**

## よくある質問

### Q1: 間違ってボタンをクリックしてしまった場合は？

**A**: 保存せずにページを離れれば、pending状態はリセットされます。次回ページを開いたときは、ボタンが再び有効になります。

### Q2: 一度無効化されたボタンを再度有効にできますか？

**A**: 現在のバージョンでは、保存後に無効化されたボタンを再度有効にする機能はありません。これは誤送信を防ぐための設計です。

### Q3: 別の売主のページでは同じテンプレートを使えますか？

**A**: はい、使えます。ボタンの無効化状態は売主ごとに独立して管理されています。

### Q4: ブラウザのプライベートモードでも動作しますか？

**A**: はい、動作します。LocalStorageが利用できない場合は、メモリに状態を保存します（セッション内のみ有効）。

### Q5: 複数のブラウザやデバイスで状態は同期されますか？

**A**: いいえ、状態はブラウザのLocalStorageに保存されるため、デバイスやブラウザごとに独立しています。

## トラブルシューティング

### ボタンが無効化されない

**原因**: LocalStorageが無効になっている可能性があります。

**解決策**:
1. ブラウザの設定でLocalStorageを有効にする
2. プライベートモードを解除する
3. ブラウザのキャッシュをクリアする

### 状態がリセットされてしまう

**原因**: ブラウザのデータがクリアされた可能性があります。

**解決策**:
- ブラウザのキャッシュやCookieをクリアしないようにする
- 定期的にバックアップを取る（将来の機能）

### 「保存待ち」状態が残ってしまう

**原因**: 保存せずにページを離れた可能性があります。

**解決策**:
- ページをリロードすると、pending状態はリセットされます
- 次回ページを開いたときは、ボタンが再び有効になります

## 技術的な詳細

### データの保存場所
- **LocalStorage**: `callModeQuickButtons`キー
- **フォールバック**: メモリ（LocalStorage利用不可時）

### データ構造
```json
{
  "sellerId_123": {
    "email_template1": {
      "state": "persisted",
      "timestamp": 1704067200000
    },
    "sms_template2": {
      "state": "pending",
      "timestamp": 1704067300000
    }
  }
}
```

### 状態の有効期限
- **Pending状態**: ページセッション内のみ有効（ページを離れるとリセット）
- **Persisted状態**: 永続的（ブラウザデータをクリアするまで保持）

## まとめ

クイックボタン無効化機能により、誤送信を防ぎながら効率的に通話対応ができます。

**重要なポイント**:
- ✅ ボタンをクリックすると「保存待ち」状態になる
- ✅ 保存ボタンをクリックすると「使用済み」状態になる
- ✅ 保存せずに離れると「保存待ち」状態はリセットされる
- ✅ 「使用済み」状態は永続的に保持される
- ✅ 売主ごとに独立した状態管理

ご不明な点がございましたら、開発チームまでお問い合わせください。
