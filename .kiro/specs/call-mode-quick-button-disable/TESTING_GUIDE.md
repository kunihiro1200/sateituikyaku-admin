# クイックボタン無効化機能 - テストガイド

## テスト目的
コールモードページの「通話メモ入力」セクションにある定型文挿入用のクイックボタン（Chip）が、クリック後に適切に無効化（グレーアウト）されることを確認する。

## 対象ボタン

以下の11個のChipコンポーネントが対象です：

1. **B'** - 「価格が知りたかっただけ」
2. **木２** - 「木造２F」
3. **土地面積** - 「土地面積：だいたい」
4. **太陽光** - 「太陽光発電あり」
5. **一旦机上** - 「一旦机上査定で」
6. **他社待ち** - 「他社の査定待ち」
7. **高く驚** - 「高くて驚いた」
8. **名義** - 「名義変更が必要」
9. **ローン** - 「ローン残あり」
10. **売る気あり** - 「売却意欲あり」
11. **検討中** - 「検討中」

## テスト環境
- ブラウザ: Chrome, Firefox, Safari
- デバイス: デスクトップ、タブレット

## テストケース

### ✅ TC1: クイックボタンのクリック時のPending状態
**前提条件**: コールモードページを開いている

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 任意のクイックボタン（例: 「B'」）をクリック

**期待結果**:
- ボタンの背景色が黄色（#fff9c4）になる
- ボタンのテキストに取り消し線が表示される
- 通話メモ入力欄に対応するテキスト（「価格が知りたかっただけ」）が追加される
- ボタンはまだクリック可能（無効化されていない）

### ✅ TC2: 保存後のPersisted状態
**前提条件**: TC1を完了している

**手順**:
1. ページ下部の「保存」ボタンをクリック

**期待結果**:
- ボタンの背景色がグレー（#e0e0e0）になる
- ボタンのテキストに取り消し線が表示される
- ボタンが無効化され、クリックできなくなる
- 保存成功のトーストメッセージが表示される

### ✅ TC3: ページリロード後の状態維持
**前提条件**: TC2を完了している

**手順**:
1. ブラウザをリロード（F5キー）
2. 同じ売主のコールモードページを開く
3. 「通話メモ入力」セクションまでスクロール

**期待結果**:
- 無効化されたボタンがグレー背景+取り消し線で表示される
- ボタンがクリックできない状態のまま

### ✅ TC4: 複数ボタンの同時無効化
**前提条件**: コールモードページを開いている

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 「B'」ボタンをクリック
3. 「木２」ボタンをクリック
4. 「土地面積」ボタンをクリック
5. 「保存」ボタンをクリック

**期待結果**:
- 3つのボタンすべてがpending状態（黄色背景）になる
- 保存後、3つのボタンすべてがpersisted状態（グレー背景）になる
- 3つのボタンすべてが無効化される

### ✅ TC5: 保存せずに離脱した場合
**前提条件**: コールモードページを開いている

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 任意のクイックボタンをクリック（pending状態にする）
3. 保存せずに別のページに移動
4. 再度同じ売主のコールモードページを開く
5. 「通話メモ入力」セクションまでスクロール

**期待結果**:
- ボタンが通常の状態（無効化されていない）に戻っている
- pending状態が破棄されている

### ✅ TC6: 売主ごとの独立した状態管理
**前提条件**: 2人以上の売主データがある

**手順**:
1. 売主Aのコールモードページで「B'」ボタンをクリックして保存
2. 売主Bのコールモードページを開く
3. 「通話メモ入力」セクションまでスクロール
4. 売主Bの「B'」ボタンの状態を確認

**期待結果**:
- 売主Bの「B'」ボタンは無効化されていない（通常の状態）
- 売主Aのボタン状態が売主Bに影響していない

### ✅ TC7: 無効化されたボタンのクリック防止
**前提条件**: TC2を完了している（ボタンを無効化）

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 無効化されたボタンをクリックしようとする
3. 通話メモ入力欄を確認

**期待結果**:
- ボタンがクリックできない
- 通話メモ入力欄にテキストが追加されない
- カーソルが「not-allowed」になる

### ✅ TC8: 視覚的フィードバックの確認
**前提条件**: コールモードページを開いている

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 「B'」ボタンをクリック（pending状態）
3. ボタンの見た目を確認
4. 「保存」ボタンをクリック
5. ボタンの見た目を確認

**期待結果**:
- ステップ3（Pending状態）:
  - 背景色: 黄色 (#fff9c4)
  - テキスト: グレー (text.secondary)
  - 取り消し線: あり
- ステップ5（Persisted状態）:
  - 背景色: グレー (#e0e0e0)
  - テキスト: グレー (text.disabled)
  - 取り消し線: あり

### ✅ TC9: 全ボタンの動作確認
**前提条件**: コールモードページを開いている

**手順**:
1. 「通話メモ入力」セクションまでスクロール
2. 各ボタンを順番にクリックして、対応するテキストが通話メモに追加されることを確認
   - 「B'」→「価格が知りたかっただけ」
   - 「木２」→「木造２F」
   - 「土地面積」→「土地面積：だいたい」
   - 「太陽光」→「太陽光発電あり」
   - 「一旦机上」→「一旦机上査定で」
   - 「他社待ち」→「他社の査定待ち」
   - 「高く驚」→「高くて驚いた」
   - 「名義」→「名義変更が必要」
   - 「ローン」→「ローン残あり」
   - 「売る気あり」→「売却意欲あり」
   - 「検討中」→「検討中」
3. 「保存」ボタンをクリック

**期待結果**:
- すべてのボタンが正しいテキストを挿入する
- 保存後、すべてのボタンが無効化される

## パフォーマンステスト

### PT1: LocalStorage容量テスト
**手順**:
1. 複数の売主（50人以上）で各ボタンを無効化
2. ページの読み込み速度を確認
3. ボタンのクリック応答速度を確認

**期待結果**:
- ページ読み込みが1秒以内
- ボタンクリックの応答が即座（100ms以内）

## 不具合報告テンプレート

```
### 不具合タイトル
[簡潔な説明]

### テストケース
TC[番号]: [テストケース名]

### 再現手順
1. [手順1]
2. [手順2]
3. ...

### 期待結果
[期待される動作]

### 実際の結果
[実際に起きた動作]

### 環境
- ブラウザ: [Chrome 120 / Firefox 121 / Safari 17]
- OS: [Windows 11 / macOS 14]
- デバイス: [デスクトップ / タブレット]

### スクリーンショット
[添付]

### コンソールログ
[エラーメッセージがあれば]
```

## トラブルシューティング

### ボタンの状態が保存されない

**原因**: LocalStorageが無効化されている可能性があります

**解決策**:
1. ブラウザの設定でLocalStorageを有効化
2. プライベートブラウジングモードを使用していないか確認

### ページリロード後に状態が消える

**原因**: LocalStorageのデータが破損している可能性があります

**解決策**:
1. ブラウザの開発者ツールを開く
2. Application > Local Storage > `callModeQuickButtons`を削除
3. ページをリロード

## テスト完了チェックリスト

- [ ] TC1: クイックボタンのクリック時のPending状態
- [ ] TC2: 保存後のPersisted状態
- [ ] TC3: ページリロード後の状態維持
- [ ] TC4: 複数ボタンの同時無効化
- [ ] TC5: 保存せずに離脱した場合
- [ ] TC6: 売主ごとの独立した状態管理
- [ ] TC7: 無効化されたボタンのクリック防止
- [ ] TC8: 視覚的フィードバックの確認
- [ ] TC9: 全ボタンの動作確認
- [ ] PT1: LocalStorage容量テスト

## テスト結果記録

| TC | 結果 | 実施日 | 実施者 | 備考 |
|----|------|--------|--------|------|
| TC1 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC2 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC3 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC4 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC5 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC6 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC7 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC8 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| TC9 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |
| PT1 | ⬜ Pass / ⬜ Fail | YYYY-MM-DD | [名前] | |

## 承認

- [ ] 開発者レビュー完了
- [ ] QAテスト完了
- [ ] プロダクトオーナー承認
- [ ] 本番環境デプロイ準備完了
