# 要件ドキュメント：公開物件サイト地図マーカー外部リンク機能

## 概要

公開物件サイトの地図表示において、マーカーをクリックして表示される情報ウィンドウ内の「詳細を見る」ボタンをクリックした際に、別タブで物件詳細ページを開くようにします。これにより、ユーザーは地図画面に戻ることができ、複数の物件を比較しやすくなります。

## 用語集

- **PropertyMapView**: 公開物件サイトの地図表示コンポーネント
- **InfoWindow**: 地図上のマーカーをクリックした際に表示される情報ウィンドウ
- **詳細を見るボタン**: InfoWindow内に表示される、物件詳細ページへのリンクボタン
- **別タブ**: 新しいブラウザタブまたはウィンドウ

## 要件

### 要件1: 地図マーカーからの物件詳細ページ遷移

**ユーザーストーリー**: 地図を閲覧しているユーザーとして、マーカーをクリックして物件詳細を確認した後、地図画面に戻って他の物件も確認したい。

#### 受入基準

1. WHEN ユーザーが地図上のマーカーをクリックしてInfoWindowを表示し、「詳細を見る」ボタンをクリックした場合、THE System SHALL 物件詳細ページを新しいタブで開くこと
2. WHEN 物件詳細ページが新しいタブで開かれた場合、THE System SHALL 元の地図画面のタブを保持すること
3. WHEN ユーザーが新しいタブで物件詳細を確認した後、THE System SHALL ユーザーが元の地図タブに戻れること

### 要件2: ユーザビリティの向上

**ユーザーストーリー**: 地図を使って複数の物件を比較したいユーザーとして、各物件の詳細を確認しながら地図画面を維持したい。

#### 受入基準

1. WHEN ユーザーが複数のマーカーをクリックして詳細を確認する場合、THE System SHALL 各物件詳細ページを別々のタブで開くこと
2. WHEN ユーザーが地図画面に戻る場合、THE System SHALL 地図の表示状態（ズームレベル、中心位置、開いているInfoWindow）を保持すること

### 要件3: 既存機能との互換性

**ユーザーストーリー**: システム管理者として、既存の地図表示機能が正常に動作し続けることを確認したい。

#### 受入基準

1. WHEN リンク動作を変更する場合、THE System SHALL 地図表示、マーカー表示、InfoWindow表示の既存機能に影響を与えないこと
2. WHEN 物件詳細ページが新しいタブで開かれる場合、THE System SHALL 物件詳細ページの表示内容と機能に変更がないこと

## 非機能要件

### NFR-1: ブラウザ互換性
すべての主要なモダンブラウザ（Chrome、Firefox、Safari、Edge）で新しいタブでのリンク動作が正常に機能すること

### NFR-2: アクセシビリティ
スクリーンリーダーやキーボードナビゲーションを使用するユーザーにも、新しいタブで開くことが明確に伝わること

### NFR-3: パフォーマンス
新しいタブでのリンク動作が、既存の地図表示パフォーマンスに影響を与えないこと

## 制約条件

1. React Routerの`navigate()`関数は同一タブ内での遷移のみをサポートするため、別の実装方法を使用する必要がある
2. Google Maps APIのInfoWindowコンポーネント内でのイベント処理を適切に行う必要がある
3. 既存のコンポーネント構造を大きく変更せず、最小限の修正で実装する

## 想定される影響範囲

- **影響を受けるファイル**: `frontend/src/components/PropertyMapView.tsx`
- **影響を受けない機能**: 地図表示、マーカー表示、InfoWindow表示、物件詳細ページの内容
