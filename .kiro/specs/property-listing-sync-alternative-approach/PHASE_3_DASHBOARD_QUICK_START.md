# Phase 3: ダッシュボード - クイックスタートガイド

## 🚀 今すぐダッシュボードを使い始める

Phase 3で実装した同期ダッシュボードを今すぐ使い始めるための手順です。

## ⚡ 3ステップでセットアップ

### ステップ1: バックエンドの起動（1分）

```bash
cd backend
npm run dev
```

**期待される出力:**
```
🚀 Server running on port 3000
✅ Database connected
✅ All routes registered
```

### ステップ2: フロントエンドの起動（1分）

```bash
cd frontend
npm run dev
```

**期待される出力:**
```
  VITE v4.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

### ステップ3: ダッシュボードへのアクセス（30秒）

ブラウザで以下のURLを開く:
```
http://localhost:5173/property-listings/sync/dashboard
```

## 🎯 基本的な使い方

### 1. システム状態の確認

ダッシュボードを開くと、最上部に**システム状態カード**が表示されます。

```
┌─────────────────────────────────────┐
│ 同期システム状態        [🔄 更新]  │
├─────────────────────────────────────┤
│  ✅  システム状態: 正常              │
├─────────────────────────────────────┤
│ 最終同期    | エラー率 | 平均実行時間 │
│ 2025-01-10  | 0.00%   | 2分30秒      │
└─────────────────────────────────────┘
```

**ステータスの意味:**
- ✅ **正常（Healthy）**: エラー率 < 5%、最近のエラー < 20件
- ⚠️ **低下（Degraded）**: エラー率 5-10%、最近のエラー 20-50件
- ❌ **異常（Unhealthy）**: エラー率 > 10%、最近のエラー > 50件

### 2. 手動同期の実行

右上の「🔄 手動同期を実行」ボタンをクリック:

1. ボタンをクリック
2. 確認ダイアログが表示される
3. 同期IDが表示される
4. 同期履歴に新しいレコードが追加される

**実行例:**
```
✅ 同期を開始しました
同期ID: 550e8400-e29b-41d4-a716-446655440000
```

### 3. 統計情報の確認

左側のカードに**過去24時間の統計**が表示されます:

```
┌──────────────┐
│ 統計情報     │
│ (過去24時間) │
├──────────────┤
│ 総同期: 10   │
│ 成功: 9      │
│ 失敗: 1      │
│ 部分: 0      │
└──────────────┘
```

### 4. 同期履歴の確認

右側に**最近20件の同期履歴**が表示されます:

```
┌────────────────────────┐
│ 同期履歴               │
├────────────────────────┤
│ [完了] 手動同期        │
│ 開始: 2025-01-10 12:00 │
│ 実行時間: 2分30秒      │
│ 結果: 成功95/失敗5     │
│ [エラーを表示(5件)]    │
├────────────────────────┤
│ [実行中] 定期同期      │
│ 開始: 2025-01-10 11:30 │
│ 実行時間: -            │
│ 結果: -                │
└────────────────────────┘
```

**ステータスの色:**
- 🟢 **完了（Completed）**: 緑
- 🔵 **実行中（In Progress）**: 青
- ⚪ **待機中（Queued）**: グレー
- 🟡 **部分完了（Partial）**: 黄
- 🔴 **失敗（Failed）**: 赤

### 5. エラーログの確認

失敗した同期の「エラーを表示」ボタンをクリック:

```
┌─────────────────────────────────────┐
│ エラーログ (5件)                    │
├─────────────────────────────────────┤
│ [検索...] [すべてのエラー ▼]       │
├─────────────────────────────────────┤
│ [バリデーション] AA12345            │
│ 🔄 2回リトライ                      │
│ Invalid data format                 │
│ 2025-01-10 12:34:56                 │
├─────────────────────────────────────┤
│ [ネットワーク] AA12346              │
│ Connection timeout                  │
│ 2025-01-10 12:35:12                 │
└─────────────────────────────────────┘
```

**フィルタリング:**
- ドロップダウンでエラータイプを選択
- 検索ボックスで物件番号やメッセージを検索

## 🔧 よくある操作

### 同期の状態を確認する

1. ダッシュボードを開く
2. システム状態カードを確認
3. エラー率が高い場合は、エラーログを確認

### 定期的な監視

ダッシュボードは自動的に更新されます:
- **ヘルス状態**: 30秒ごと
- **同期履歴**: 60秒ごと

手動で更新する場合:
- システム状態カードの「🔄 更新」ボタンをクリック

### エラーの調査

1. 同期履歴で失敗した同期を探す
2. 「エラーを表示」ボタンをクリック
3. エラーログでエラータイプを確認
4. 検索ボックスで特定の物件を検索

### 特定の物件のエラーを探す

1. エラーログの検索ボックスに物件番号を入力
2. 該当するエラーのみが表示される

例: `AA12345` と入力

## 📊 メトリクスの見方

### エラー率

```
エラー率 = 失敗した同期数 / 総同期数
```

**目安:**
- < 5%: 正常
- 5-10%: 注意が必要
- > 10%: 対応が必要

### 平均実行時間

```
平均実行時間 = 全同期の実行時間の合計 / 同期数
```

**目安:**
- < 3分: 良好
- 3-5分: 普通
- > 5分: 改善が必要

### 最近のエラー数

過去1時間のエラー数を表示

**目安:**
- < 20件: 正常
- 20-50件: 注意が必要
- > 50件: 対応が必要

## 🚨 トラブルシューティング

### ダッシュボードが表示されない

**原因:** バックエンドが起動していない

**解決策:**
```bash
cd backend
npm run dev
```

### データが表示されない

**原因:** マイグレーションが実行されていない

**解決策:**
```bash
cd backend
npx ts-node migrations/run-082-migration.ts
```

### エラー: "Sync service not configured"

**原因:** 環境変数が設定されていない

**解決策:**
```bash
# backend/.env を確認
cat backend/.env

# 必要な環境変数
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### 手動同期が失敗する

**原因:** Google Sheets の認証情報が不足

**解決策:**
```bash
# google-service-account.json を確認
ls backend/google-service-account.json

# 環境変数を確認
echo $GOOGLE_SHEETS_SPREADSHEET_ID
```

## 💡 ヒント

### パフォーマンス

- ダッシュボードは軽量で、ブラウザのリソースをほとんど使用しません
- 自動更新は最小限に抑えられています
- 大量のエラーがある場合は、フィルタリングを活用してください

### セキュリティ

- ダッシュボードは認証が必要です
- ログインしていない場合は、ログインページにリダイレクトされます
- API キーは環境変数で管理されています

### 運用

- エラー率が5%を超えたら、エラーログを確認してください
- 定期的に統計情報を確認して、傾向を把握してください
- 手動同期は必要な時のみ実行してください

## 🎯 次のステップ

### 今すぐできること
1. ✅ ダッシュボードを開く
2. ✅ システム状態を確認
3. ✅ 手動同期を実行
4. ✅ エラーログを確認

### さらに活用する
1. ⏳ 定期的な監視の習慣化
2. ⏳ エラー傾向の分析
3. ⏳ 同期パフォーマンスの最適化

### Phase 4への準備
1. ⏳ 統合テストの実施
2. ⏳ ロードテストの実施
3. ⏳ 本番環境へのデプロイ

## 📚 参考資料

- [PHASE_3_COMPLETE.md](./PHASE_3_COMPLETE.md) - Phase 3完了報告
- [PHASE_3_TASK_3.4_COMPLETE.md](./PHASE_3_TASK_3.4_COMPLETE.md) - ダッシュボード実装詳細
- [API_DOCUMENTATION.md](./API_DOCUMENTATION.md) - API仕様書

## 🆘 サポート

問題が発生した場合:
1. エラーメッセージを確認
2. ブラウザのコンソールを確認（F12キー）
3. バックエンドのログを確認
4. 上記のトラブルシューティングを参照

---

**作成日:** 2025-01-10  
**最終更新:** 2025-01-10  
**ステータス:** ✅ 実行可能

