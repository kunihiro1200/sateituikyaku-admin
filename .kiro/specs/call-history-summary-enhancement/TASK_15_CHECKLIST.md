# Task 15: 手動テストと微調整 - チェックリスト

## 📋 概要

このチェックリストは、Task 15（手動テストと微調整）を完了するための具体的な手順を示します。

## ✅ 実施手順

### ステップ1: サーバー起動とテスト準備（5分）

- [ ] バックエンドサーバーを起動
  ```bash
  cd backend
  npm run dev
  ```

- [ ] サーバーが正常に起動したことを確認
  - ログに `Server running on port 3000` が表示される
  - エラーがないことを確認

- [ ] 認証トークンを取得
  ```bash
  curl -X POST http://localhost:3000/api/auth/login \
    -H "Content-Type: application/json" \
    -d '{"email":"your-email@example.com","password":"your-password"}'
  ```
  - トークンをコピーして保存

### ステップ2: 基本機能テスト（10分）

#### テスト2.1: 後方互換性テスト

- [ ] 既存のメモ配列フォーマットでテスト
  ```bash
  curl -X POST http://localhost:3000/api/summarize/call-memos \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -d '{
      "memos": [
        "3/2 12:00 訪問査定の日程調整",
        "2/28 15:30 物件情報のヒアリング",
        "2/25 10:00 初回コンタクト"
      ]
    }'
  ```

- [ ] 結果を確認:
  - [ ] ステータスコード 200
  - [ ] `summary` フィールドが存在
  - [ ] `【通話回数】3回` が含まれる
  - [ ] 日付順に並んでいる（新しい順）

#### テスト2.2: タイムスタンプ解析テスト

- [ ] 様々なタイムスタンプフォーマットをテスト
  - [ ] `3/2 12:00` （単一桁の月日）
  - [ ] `12/25 17:30` （二桁の月日）
  - [ ] `1/1 9:00` （単一桁の時刻）
  - [ ] `10/10 23:59` （24時間形式）

- [ ] 通話回数が正しくカウントされることを確認

### ステップ3: 実際のデータでテスト（20分）

#### テスト3.1: 提供された例1（土地売却、相続）

- [ ] 以下のデータでテスト:
  ```json
  {
    "memos": [
      "10/1 売るのはもう少し様子を見たいとのこと",
      "9/7 今年中に売りたい　県外にいるので大分に来てから実際にいふうとあってから募集するようにしたいとのこと。土地を売ったとしても、買い主様には来年の4月以降に建物を建ててほしい。理由は相続で親戚の方がそこを売りたくないという思いが強いので、自分が今その近くに住んでいて、引っ越したら家を建てても文句を言われないからとのこと（少しあやしい）",
      "9/5 面積はだいたい　更地にしている。駐車場として月極で貸している。売却のご予定あり。土地への思いがあるので変な使い方はされたくない。当社が売買に強く、問合せが多いと伝えるとかなり興味津々でどんな方か？等くいついてきた。訪問査定はまだ考えるとのこと",
      "★希望連絡時間：9時～12時"
    ]
  }
  ```

- [ ] 期待される出力と比較:
  ```
  【次のアクション】訪問査定の日程調整
  【通話回数】1回
  【連絡可能時間】★希望連絡時間：9時～12時
  【状況】当社が売買に強く、問合せが多いと伝えるとかなり興味津々でどんな方か？等くいついてきた今年中に売りたい...
  【売却理由】相続
  【物件情報】面積はだいたい　更地にしている
  【確度】高めだが、売価時期を延期してきた
  ```

- [ ] 品質チェック:
  - [ ] 情報が簡潔にまとめられている
  - [ ] 重複がない
  - [ ] 重要な情報が保持されている
  - [ ] カテゴリー分類が適切

#### テスト3.2: 提供された例2（建物解体、1年後売却）

- [ ] 以下のデータでテスト:
  ```json
  {
    "memos": [
      "10/19 いったんでるが切られる",
      "10/12 自分本人ではない　嫁のお母様が所有　1年後くらいにうる予定。　買いたいという人がいたら紹介してもよい。媒介契約に伺う日程は嫁のお母様と話し合うので来週また電話してほしいとのこと",
      "面積100坪　建物はこわす　土地として売却　机上査定メール希望　まだ売るかどうか不明な状態"
    ]
  }
  ```

- [ ] 期待される出力と比較:
  ```
  【次のアクション】興味のあるお客様がいるので、と連絡
  【通話回数】1回
  【状況】建物は壊すので土地として売却したい
  【名義人】嫁のお母様が所有
  【売却時期】1年後（2026年）
  ```

- [ ] 品質チェック:
  - [ ] 名義人が正しく抽出されている
  - [ ] 売却時期が正しく分類されている
  - [ ] 次のアクションが適切

#### テスト3.3: 提供された例3（他社専任媒介）

- [ ] 以下のデータでテスト:
  ```json
  {
    "memos": [
      "2025/1/31 久光大分で買って専任媒介結んでしまった。3190万で募集中とのこと",
      "2024/11/29 13:09 状況変化なし。",
      "2024/10/4 17:21 訪問査定は他社含めまだ考えていない。引越も急いでいない、時期未定とのこと。",
      "2024/9/30 17:49 金額的にもう少しといったところ。ほかの会社は3000万こえるとのこと。買取で2000万出してもいいと言っている会社もある。赤ちゃんが泣きだしたので電話切られる。",
      "2024/9/28 18:04 太陽光の売電期間は11月に終わる。ハウスメーカーは大和ハウス、次のお住まいは子供が小学校に通っていて、松岡小あたりで検討中"
    ]
  }
  ```

- [ ] 品質チェック:
  - [ ] 通話回数が正しい（タイムスタンプ付きコメントのみカウント）
  - [ ] 最新の情報が優先されている
  - [ ] 他社情報が適切に分類されている

### ステップ4: 売主IDからの自動取得テスト（10分）

- [ ] 売主リストを取得
  ```bash
  curl -X GET http://localhost:3000/api/sellers \
    -H "Authorization: Bearer YOUR_TOKEN"
  ```

- [ ] 売主IDを選択してサマリーを生成
  ```bash
  curl -X GET http://localhost:3000/api/summarize/seller/SELLER_ID \
    -H "Authorization: Bearer YOUR_TOKEN"
  ```

- [ ] 結果を確認:
  - [ ] `summary`, `metadata`, `seller` フィールドが存在
  - [ ] 売主の実際のデータが反映されている
  - [ ] 処理時間が2秒以内

### ステップ5: パフォーマンステスト（5分）

- [ ] キャッシュテスト
  - [ ] 同じリクエストを2回実行
  - [ ] 2回目のレスポンスが高速（キャッシュヒット）
  - [ ] ログに "Cache hit" が表示される

- [ ] 大量データテスト
  - [ ] 200件以上のエントリーでテスト
  - [ ] 処理時間が2秒以内
  - [ ] エラーが発生しない

### ステップ6: エラーハンドリングテスト（5分）

- [ ] 不正なタイムスタンプでテスト
  ```json
  {
    "memos": [
      "13/32 25:99 不正なタイムスタンプ",
      "3/2 12:00 正常なタイムスタンプ"
    ]
  }
  ```
  - [ ] エラーが発生せず処理が継続される
  - [ ] 正常なタイムスタンプはカウントされる

- [ ] 空のデータでテスト
  ```json
  {
    "memos": []
  }
  ```
  - [ ] 適切なエラーメッセージが返される

### ステップ7: 品質評価と調整（15分）

#### 7.1 カテゴリー分類の評価

- [ ] 各カテゴリーの分類精度を確認
  - [ ] 【状況】: 適切な情報が分類されている
  - [ ] 【名義人】: 名義人情報が正しく抽出されている
  - [ ] 【売却時期】: 時期情報が正しく分類されている
  - [ ] 【売却理由】: 理由が適切に抽出されている
  - [ ] 【物件情報】: 物件の詳細が含まれている
  - [ ] 【確度】: 確度に関する情報が分類されている

- [ ] 必要に応じてキーワードリストを調整
  - ファイル: `backend/src/services/ContentSummarizer.ts`
  - キーワードを追加/削除

#### 7.2 要約品質の評価

- [ ] 情報が簡潔にまとめられている（コピペではない）
- [ ] 重要な情報が保持されている
- [ ] 重複した内容が除外されている
- [ ] 読みやすいフォーマット

#### 7.3 次のアクション生成の評価

- [ ] 次のアクションが適切
- [ ] 状況に応じた提案になっている
- [ ] 必要に応じてロジックを調整
  - ファイル: `backend/src/services/SummaryGenerator.ts`
  - `generateNextAction()` メソッド

### ステップ8: テスト結果の記録（5分）

- [ ] テスト結果を記録
  ```markdown
  ## テスト日時: 2024-XX-XX

  ### 全体的な品質
  - タイムスタンプ解析: ✅ 正常 / ❌ 問題あり
  - 通話回数カウント: ✅ 正確 / ❌ 不正確
  - カテゴリー分類: ✅ 適切 / ❌ 要改善
  - 要約品質: ✅ 高 / ⚠️ 中 / ❌ 低
  - パフォーマンス: ✅ 2秒以内 / ❌ 遅い

  ### 発見された問題
  1. [問題の説明]
  2. [問題の説明]

  ### 実施した調整
  1. [調整内容]
  2. [調整内容]

  ### 次のステップ
  - [必要なアクション]
  ```

## 📊 完了基準

以下の全てが満たされた場合、Task 15は完了です:

- [ ] 全てのテストケースが成功
- [ ] 提供された例と同等の品質のサマリーが生成される
- [ ] タイムスタンプが正しく解析される
- [ ] 通話回数が正確にカウントされる
- [ ] カテゴリー分類が適切
- [ ] 情報が簡潔にまとめられている
- [ ] パフォーマンスが要件を満たす（< 2秒）
- [ ] エラーハンドリングが適切
- [ ] テスト結果が記録されている

## 🔧 調整が必要な場合

### キーワードリストの調整

`backend/src/services/ContentSummarizer.ts` を編集:

```typescript
private readonly KEYWORDS = {
  [SummaryCategory.SITUATION]: [
    '検討中', '前向き', '考え中', '様子見',
    // 新しいキーワードを追加
  ],
  // ...
};
```

### 次のアクション生成の調整

`backend/src/services/SummaryGenerator.ts` の `generateNextAction()` を編集

### 要約ロジックの調整

`backend/src/services/ContentSummarizer.ts` の `summarize()` を編集

## 📝 次のタスク

Task 15が完了したら、Task 16（最終チェックポイント）に進みます。

---

**注意**: このチェックリストは、実際のテスト結果に基づいて更新してください。
