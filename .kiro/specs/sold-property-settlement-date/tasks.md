# 実装計画：成約済み物件の決済日表示機能

## 概要

公開物件詳細ページに、成約済み物件の物件番号と決済日（成約日）を表示する機能を実装します。

## タスク

- [x] 1. バックエンド: 決済日取得メソッドの実装
  - [x] 1.1 PropertyServiceに`getSettlementDate`メソッドを追加
    - GoogleSheetsClientを使用して物件シートにアクセス
    - 物件番号で行を検索（A列）
    - E列から決済日を取得
    - 日付を正規化（ISO 8601形式に変換）
    - エラー時はnullを返す
    - _要件: 2.1, 3.1, 3.2, 3.3_
  
  - [x] 1.2 日付正規化関数の実装
    - Googleスプレッドシートの日付形式を処理
    - ISO 8601形式（YYYY-MM-DD）に変換
    - 無効な日付の場合はnullを返す
    - _要件: 2.4_

- [x] 2. バックエンド: APIエンドポイントの追加
  - publicPropertyRoutesに新規エンドポイントを追加
  - `GET /api/public/properties/:propertyNumber/settlement-date`
  - PropertyService.getSettlementDateを呼び出し
  - レスポンス: `{ settlementDate: string | null }`
  - _要件: 2.1, 3.1_

- [ ]* 2.1 APIエンドポイントのユニットテスト
  - 有効な物件番号で決済日が返されることをテスト
  - 無効な物件番号で適切なレスポンスが返されることをテスト
  - 決済日が存在しない場合のテスト
  - _要件: 2.1, 2.3_

- [x] 3. フロントエンド: PublicPropertyDetailPageの修正
  - [x] 3.1 状態管理の追加
    - `settlementDate`と`isLoadingSettlementDate`の状態を追加
    - _要件: 2.1_
  
  - [x] 3.2 決済日取得ロジックの実装
    - useEffectで成約済み物件の場合のみ決済日を取得
    - APIエンドポイントを呼び出し
    - エラー時は何も表示しない
    - _要件: 2.1, 3.3, NFR-2_
  
  - [x] 3.3 成約情報セクションの追加
    - 成約済み物件の場合、物件番号を表示
    - 決済日が存在する場合、「成約日」として表示
    - 日本語形式で日付をフォーマット（例: 2024年1月15日）
    - 物件基本情報の直後に配置
    - _要件: 1.1, 2.2, 2.3, 2.4_
  
  - [x] 3.4 日付フォーマット関数の実装
    - ISO 8601形式を日本語形式に変換
    - 無効な日付の場合は元の文字列を返す
    - _要件: 2.4_

- [x] 4. 動作確認
  - ローカル環境でバックエンドとフロントエンドを起動
  - 成約済み物件の詳細ページにアクセス
  - 物件番号が表示されることを確認
  - 決済日が存在する場合、成約日が表示されることを確認
  - 決済日が存在しない場合、成約日が表示されないことを確認
  - 非成約物件で物件番号が表示されないことを確認
  - _要件: 1.1, 2.2, 2.3, 4.1, 4.2_

- [x] 5. チェックポイント
  - すべてのテストが通過することを確認
  - 動作確認で問題がないことを確認
  - 質問があればユーザーに確認

## 注意事項

- タスク1〜3は必須の実装タスクです
- タスク2.1はオプションのテストタスクです（`*`マーク付き）
- タスク4は手動での動作確認です
- 既存の成約済み物件の表示機能（お問い合わせフォーム非表示、印刷用フッターの電話番号非表示）に影響を与えないよう注意してください
- Googleスプレッドシートのスキーマ（A列: 物件番号、E列: 決済日）を前提としています
