# 要件ドキュメント：成約済み物件の決済日表示機能

## 概要

公開物件詳細ページにおいて、成約済み物件の場合に物件番号を表示し、さらにGoogleスプレッドシートから決済日を取得して「成約日」として表示する機能を追加します。

## 用語集

- **PublicPropertyDetailPage**: 公開物件詳細ページのコンポーネント
- **成約済み物件**: `atbb_status`に「成約済み」が含まれる物件
- **物件シート**: GoogleスプレッドシートID `1tI_iXaiLuWBggs5y0RH7qzkbHs9wnLLdRekAmjkhcLY`、シート名「物件」
- **決済日**: 物件シートのE列に記録されている日付データ
- **物件番号**: 各物件に割り当てられた一意の識別番号（例: AA10424）

## 要件

### 要件1: 成約済み物件の物件番号表示

**ユーザーストーリー**: 公開物件サイトの閲覧者として、成約済み物件の詳細ページで物件番号を確認したい。

#### 受入基準

1. WHEN 物件が成約済みの場合、THE System SHALL 公開物件詳細ページに物件番号を表示すること
2. WHEN 物件が成約済みでない場合、THE System SHALL 物件番号を表示しないこと（既存の動作を維持）
3. WHEN 物件番号を表示する場合、THE System SHALL 見やすい位置とスタイルで表示すること

### 要件2: 決済日の取得と表示

**ユーザーストーリー**: 公開物件サイトの閲覧者として、成約済み物件の決済日（成約日）を確認したい。

#### 受入基準

1. WHEN 物件が成約済みの場合、THE System SHALL Googleスプレッドシート（物件シート）のE列から決済日を取得すること
2. WHEN 決済日が存在する場合、THE System SHALL 「成約日」というラベルとともに日付を表示すること
3. WHEN 決済日が存在しない場合、THE System SHALL 成約日セクションを表示しないこと
4. WHEN 決済日を表示する場合、THE System SHALL 日本語の日付フォーマット（例: 2024年1月15日）で表示すること

### 要件3: データ取得の実装

**ユーザーストーリー**: システム管理者として、Googleスプレッドシートから決済日を効率的に取得したい。

#### 受入基準

1. WHEN 決済日を取得する場合、THE System SHALL 物件番号をキーとしてスプレッドシートを検索すること
2. WHEN スプレッドシートにアクセスする場合、THE System SHALL 既存のGoogleSheetsClientを使用すること
3. WHEN データ取得に失敗した場合、THE System SHALL エラーをログに記録し、決済日を表示しないこと（ページ全体の表示には影響しない）
4. WHEN 決済日データをキャッシュする場合、THE System SHALL 適切なキャッシュ戦略を使用すること

### 要件4: お問い合わせフォームの非表示（既存機能の確認）

**ユーザーストーリー**: 公開物件サイトの閲覧者として、成約済み物件にはお問い合わせできないことを理解したい。

#### 受入基準

1. WHEN 物件が成約済みの場合、THE System SHALL お問い合わせフォームを表示しないこと（既存の実装を維持）
2. WHEN 物件が成約済みの場合、THE System SHALL 印刷用フッターの電話番号を表示しないこと（既存の実装を維持）

## 非機能要件

### NFR-1: パフォーマンス
決済日の取得がページ全体の読み込み速度に大きな影響を与えないこと（非同期取得を推奨）

### NFR-2: エラーハンドリング
決済日の取得に失敗しても、ページ全体の表示が正常に行われること

### NFR-3: データ整合性
物件番号とスプレッドシートの行が正しく対応していること

## 制約条件

1. Googleスプレッドシートのスキーマ変更は行わない（E列が決済日であることを前提とする）
2. 既存のGoogleSheetsClient実装を使用する
3. 成約済み物件の判定ロジック（`getBadgeType`）は既存のものを使用する
4. 物件番号は既存のデータベースフィールド（`property_number`）を使用する

## 想定される影響範囲

- **影響を受けるファイル**: 
  - `frontend/src/pages/PublicPropertyDetailPage.tsx`（表示ロジック）
  - `backend/src/services/PropertyService.ts`または新規サービス（決済日取得ロジック）
  - `backend/src/routes/publicPropertyRoutes.ts`（APIエンドポイント追加の可能性）
- **影響を受けない機能**: 
  - 物件一覧表示
  - 地図表示
  - お問い合わせフォーム（成約済み以外）
