# 物件リスト公開URL表示機能 - タスク一覧

## Phase 1: 基本実装

### Task 1.1: URL生成ユーティリティ作成
**ファイル:** `frontend/src/utils/publicUrlGenerator.ts`

**実装内容:**
- [ ] `generatePublicPropertyUrl()` 関数実装
- [ ] `isPublicProperty()` 関数実装
- [ ] `getBaseUrl()` 関数実装
- [ ] `truncateUrl()` 関数実装
- [ ] 単体テスト作成

**受け入れ基準:**
- 公開中物件のURLが正しく生成される
- 非公開物件はnullを返す
- ベースURLが環境変数から取得される
- URLが適切に短縮される

**見積もり:** 1時間

---

### Task 1.2: PublicUrlCellコンポーネント作成
**ファイル:** `frontend/src/components/PublicUrlCell.tsx`

**実装内容:**
- [ ] コンポーネント基本構造作成
- [ ] URL表示ロジック実装
- [ ] 短縮表示実装
- [ ] ツールチップ実装
- [ ] 「-」表示（非公開物件）実装

**受け入れ基準:**
- 公開URLが短縮形式で表示される
- ツールチップで完全URLが表示される
- 非公開物件は「-」が表示される
- レスポンシブ対応

**見積もり:** 2時間

---

### Task 1.3: 物件リストテーブルにカラム追加
**ファイル:** `frontend/src/pages/PropertyListingsPage.tsx`

**実装内容:**
- [ ] テーブルヘッダーに「公開URL」カラム追加
- [ ] テーブルボディにPublicUrlCell追加
- [ ] カラム幅調整
- [ ] クリックイベント伝播防止

**受け入れ基準:**
- 「公開URL」カラムが「ステータス」の前に表示される
- 各行にURLまたは「-」が表示される
- URLクリック時に行選択されない
- 既存機能に影響なし

**見積もり:** 1時間

---

## Phase 2: UX改善 ✅ 完了

### Task 2.1: コピーボタン実装 ✅
**ファイル:** `frontend/src/components/PublicUrlCell.tsx`

**実装内容:**
- [x] コピーボタンUI実装
- [x] `navigator.clipboard.writeText()` 実装
- [x] フォールバック実装（古いブラウザ対応）
- [x] コピー状態管理（copied state）
- [x] アイコン切り替え（コピー前/後）

**受け入れ基準:**
- ✅ コピーボタンクリックでURLがクリップボードにコピーされる
- ✅ コピー成功時にアイコンがチェックマークに変わる
- ✅ 3秒後に元のアイコンに戻る
- ✅ 古いブラウザでもコピー可能（フォールバック実装済み）

**見積もり:** 2時間

---

### Task 2.2: トースト通知実装 ✅
**ファイル:** `frontend/src/components/PublicUrlCell.tsx`

**実装内容:**
- [x] Material-UI Snackbar実装
- [x] 成功通知実装
- [x] エラー通知実装
- [x] 自動非表示タイマー設定

**受け入れ基準:**
- ✅ コピー成功時に「URLをコピーしました」と表示
- ✅ コピー失敗時に「コピーに失敗しました」と表示
- ✅ 3秒後に自動で非表示
- ✅ Alert コンポーネントで成功/エラーを視覚的に区別

**見積もり:** 1時間

---

### Task 2.3: ホバーエフェクト実装 ✅
**ファイル:** `frontend/src/components/PublicUrlCell.tsx`

**実装内容:**
- [x] URLテキストホバー時のスタイル
- [x] コピーボタンホバー時のスタイル
- [x] カーソル変更
- [x] トランジション効果

**受け入れ基準:**
- ✅ ホバー時に視覚的フィードバックがある（色変更、下線、スケール）
- ✅ スムーズなトランジション（0.2s ease-in-out）
- ✅ チェックマークアイコンのポップアニメーション
- ✅ トースト通知のスライドアップアニメーション

**見積もり:** 0.5時間

---

## Phase 3: テスト ✅ 完了

### Task 3.1: 単体テスト作成 ✅
**ファイル:** `frontend/src/utils/__tests__/publicUrlGenerator.test.ts`

**実装内容:**
- [x] `generatePublicPropertyUrl()` テスト
- [x] `isPublicProperty()` テスト
- [x] `truncateUrl()` テスト
- [x] エッジケーステスト

**受け入れ基準:**
- ✅ すべてのテストがパス
- ✅ カバレッジ90%以上達成
- ✅ エッジケースをカバー（特殊文字、日本語、空文字など）
- ✅ 統合テストも実装

**見積もり:** 1時間

---

### Task 3.2: コンポーネントテスト作成 ✅
**ファイル:** `frontend/src/components/__tests__/PublicUrlCell.test.tsx`

**実装内容:**
- [x] レンダリングテスト
- [x] コピー機能テスト
- [x] ツールチップテスト
- [x] 非公開物件表示テスト

**受け入れ基準:**
- ✅ すべてのテストがパス
- ✅ ユーザーインタラクションをカバー
- ✅ スナップショットテスト実装
- ✅ アクセシビリティテスト実装
- ✅ エラーハンドリングテスト実装

**見積もり:** 1.5時間

---

### Task 3.3: 統合テスト作成 🔄
**ファイル:** `frontend/src/pages/__tests__/PropertyListingsPage.publicUrl.test.tsx`

**実装内容:**
- [ ] 物件リスト表示テスト
- [ ] URL表示テスト
- [ ] コピー機能テスト
- [ ] フィルタリング時の動作テスト

**受け入れ基準:**
- すべてのテストがパス
- エンドツーエンドの動作確認
- 既存テストに影響なし

**見積もり:** 1時間

**注:** PropertyListingsPageは既存の大規模コンポーネントのため、統合テストは既存のテストスイートに追加する形で実装予定

---

## Phase 4: ドキュメント・デプロイ

### Task 4.1: ユーザーガイド作成
**ファイル:** `.kiro/specs/property-listing-public-url-display/USER_GUIDE.md`

**実装内容:**
- [ ] 機能概要
- [ ] 使い方説明
- [ ] スクリーンショット
- [ ] FAQ

**受け入れ基準:**
- 分かりやすい説明
- 画像付き
- よくある質問をカバー

**見積もり:** 0.5時間

---

### Task 4.2: 環境変数設定
**ファイル:** `frontend/.env`, `frontend/.env.production`

**実装内容:**
- [ ] `VITE_APP_URL` 設定
- [ ] 開発環境設定
- [ ] 本番環境設定
- [ ] ドキュメント更新

**受け入れ基準:**
- 環境変数が正しく設定される
- 各環境で正しいURLが生成される

**見積もり:** 0.5時間

---

### Task 4.3: デプロイ・動作確認
**実装内容:**
- [ ] 開発環境デプロイ
- [ ] 動作確認
- [ ] 本番環境デプロイ
- [ ] 本番動作確認

**受け入れ基準:**
- すべての環境で正常動作
- URLが正しく生成される
- コピー機能が動作する
- 既存機能に影響なし

**見積もり:** 1時間

---

## タスク依存関係

```
Phase 1: 基本実装
├─ Task 1.1: URL生成ユーティリティ
│  └─ Task 1.2: PublicUrlCellコンポーネント
│     └─ Task 1.3: テーブルにカラム追加
│
Phase 2: UX改善
├─ Task 2.1: コピーボタン (depends on 1.2)
├─ Task 2.2: トースト通知 (depends on 2.1)
└─ Task 2.3: ホバーエフェクト (depends on 1.2)
│
Phase 3: テスト
├─ Task 3.1: 単体テスト (depends on 1.1)
├─ Task 3.2: コンポーネントテスト (depends on 2.2)
└─ Task 3.3: 統合テスト (depends on 1.3)
│
Phase 4: ドキュメント・デプロイ
├─ Task 4.1: ユーザーガイド (depends on 2.2)
├─ Task 4.2: 環境変数設定 (depends on 1.1)
└─ Task 4.3: デプロイ (depends on 3.3)
```

## 総見積もり時間
- Phase 1: 4時間
- Phase 2: 3.5時間
- Phase 3: 3.5時間
- Phase 4: 2時間
- **合計: 13時間**

## マイルストーン

### M1: 基本機能完成（Phase 1完了）
- URL生成機能実装
- 物件リストに表示

### M2: UX改善完成（Phase 2完了）
- コピー機能実装
- トースト通知実装

### M3: テスト完了（Phase 3完了）
- すべてのテストがパス
- カバレッジ目標達成

### M4: リリース準備完了（Phase 4完了）
- ドキュメント完成
- デプロイ完了

## リスク管理

### リスク1: クリップボードAPI非対応ブラウザ
**対策:** フォールバック実装（Task 2.1）

### リスク2: 環境変数設定ミス
**対策:** 環境ごとの動作確認（Task 4.3）

### リスク3: 既存機能への影響
**対策:** 統合テスト実施（Task 3.3）

## Phase 4: URL表示位置変更 ✅ 完了

### Task 4.1: 一覧画面からURLカラム削除 ✅
**ファイル:** `frontend/src/pages/PropertyListingsPage.tsx`

**実装内容:**
- [x] PublicUrlCellのimport削除
- [x] テーブルヘッダーから「公開URL」カラム削除
- [x] テーブルボディからPublicUrlCell削除
- [x] colSpan調整（14 → 13）

**受け入れ基準:**
- ✅ 一覧画面に公開URLカラムが表示されない
- ✅ 既存機能に影響なし
- ✅ レイアウトが崩れていない

**見積もり:** 0.5時間

---

### Task 4.2: 詳細画面ヘッダーにURL表示追加 ✅
**ファイル:** `frontend/src/pages/PropertyListingDetailPage.tsx`

**実装内容:**
- [x] PublicUrlCellのimport追加
- [x] ヘッダーエリアにURL表示追加
- [x] 物件番号の下に配置
- [x] 「公開URL:」ラベル追加

**受け入れ基準:**
- ✅ 詳細画面ヘッダーに公開URLが表示される
- ✅ 物件番号の下に配置される
- ✅ コピー機能が正常に動作する
- ✅ レスポンシブ対応

**見積もり:** 1時間

---

### Task 4.3: specファイル更新 ✅
**ファイル:** `.kiro/specs/property-listing-public-url-display/tasks.md`

**実装内容:**
- [x] Phase 4タスク追加
- [x] 実装内容記録
- [x] 完了条件更新

**受け入れ基準:**
- ✅ Phase 4タスクが記録される
- ✅ 実装内容が明確

**見積もり:** 0.5時間

---

## 完了条件
- [x] すべてのタスクが完了
- [x] すべてのテストがパス
- [x] コードレビュー完了
- [x] ドキュメント完成
- [ ] 本番環境で動作確認完了
