# 実装計画: 物件詳細画面ステータスバッジ

## 概要

物件公開サイトの詳細画面のヘッダー中央に、物件のステータスを示すバッジ（「成約済み」「配信限定」「公開前」）を表示する機能を実装します。既存のPublicPropertyCardコンポーネントと同じステータス判定ロジックを再利用し、一貫性のあるユーザー体験を提供します。

## タスク

- [x] 1. 共通ユーティリティ関数の作成
  - `frontend/src/utils/propertyStatusUtils.ts`を新規作成
  - `getBadgeType()`関数を実装（atbb_statusからバッジタイプを判定）
  - TypeScriptの型定義を追加
  - _要件: 要件8.2, 要件8.4_

- [ ]* 1.1 getBadgeType関数の単体テストを作成
  - `frontend/src/utils/propertyStatusUtils.test.ts`を作成
  - 各ステータス値に対する正しいバッジタイプの返却を検証
  - エッジケース（null、undefined、空文字列）をテスト
  - _要件: 要件7.1, 要件7.2, 要件8.5_

- [ ]* 1.2 ステータス判定の正確性プロパティテストを作成
  - **プロパティ2: バッジ表示の正確性**
  - **検証要件: 要件1.2, 1.3, 1.4, 1.5, 1.6**
  - すべてのatbb_status値に対して、「公開中」を含む場合はバッジが表示されず、それ以外の場合は適切なバッジが表示されることを検証
  - _要件: 要件1.2, 要件1.3, 要件1.4, 要件1.5, 要件1.6_

- [ ]* 1.3 ステータス判定の一貫性プロパティテストを作成
  - **プロパティ1: ステータス判定の一貫性**
  - **検証要件: 要件1.2, 1.3, 1.4, 1.5, 1.6**
  - すべてのatbb_status値に対して、getBadgeType()を2回呼び出した結果が同じであることを検証
  - _要件: 要件1.2, 要件1.3, 要件1.4, 要件1.5, 要件1.6_

- [ ]* 1.4 エラー時の安全性プロパティテストを作成
  - **プロパティ5: エラー時の安全性**
  - **検証要件: 要件7.1, 7.2, 7.3, 7.4**
  - すべてのエラー状態（null、undefined、空文字列）に対して、getBadgeType()がエラーをスローせず、'sold'を返すことを検証
  - _要件: 要件7.1, 要件7.2, 要件7.3, 要件7.4_

- [x] 2. PublicPropertyCardコンポーネントのリファクタリング
  - `frontend/src/components/PublicPropertyCard.tsx`を修正
  - ローカルの`getBadgeType()`関数を削除
  - 共通の`getBadgeType()`関数をインポート
  - 既存の機能が正常に動作することを確認
  - _要件: 要件6.1, 要件6.2, 要件6.3_

- [ ]* 2.1 PublicPropertyCardの単体テストを更新
  - 共通関数を使用するように既存のテストを更新
  - すべてのテストが引き続きパスすることを確認
  - _要件: 要件6.1_

- [x] 3. PublicPropertyHeaderコンポーネントの修正
  - `frontend/src/components/PublicPropertyHeader.tsx`を修正
  - `atbbStatus`プロパティを追加
  - `getBadgeType()`関数をインポート
  - バッジレンダリングロジックを実装
  - バッジ設定（色、テキスト）を定義
  - ARIAラベルとrole属性を追加
  - _要件: 要件1.1, 要件1.2, 要件1.3, 要件1.4, 要件1.5, 要件1.6, 要件2.1, 要件2.2, 要件2.3, 要件2.4, 要件4.1, 要件4.2_

- [ ]* 3.1 PublicPropertyHeaderの単体テストを作成
  - `frontend/src/components/PublicPropertyHeader.test.tsx`を作成
  - 各バッジタイプが正しく表示されることをテスト
  - バッジが表示されない場合（'none'）をテスト
  - ARIAラベルとrole属性の存在を検証
  - _要件: 要件1.1, 要件1.6, 要件4.1, 要件4.2_

- [ ]* 3.2 色コントラストの十分性プロパティテストを作成
  - **プロパティ4: 色コントラストの十分性**
  - **検証要件: 要件2.9, 要件4.3**
  - すべてのバッジ設定に対して、背景色とテキスト色のコントラスト比が4.5:1以上であることを検証
  - _要件: 要件2.9, 要件4.3_

- [x] 4. PublicPropertyHeaderのCSSを修正
  - `frontend/src/components/PublicPropertyHeader.css`を修正
  - `.header-center`クラスを追加
  - Flexboxレイアウトを3カラム構造に変更
  - `.status-badge`クラスのスタイルを定義
  - レスポンシブデザイン対応（モバイル、タブレット、デスクトップ）
  - _要件: 要件1.7, 要件2.5, 要件2.6, 要件2.7, 要件2.8, 要件3.1, 要件3.2, 要件3.3, 要件3.4, 要件3.5_

- [x] 5. PublicPropertyDetailPageの修正
  - `frontend/src/pages/PublicPropertyDetailPage.tsx`を修正
  - `PublicPropertyHeader`に`atbbStatus`プロパティを渡す
  - 物件データの`atbb_status`を使用
  - _要件: 要件1.1_

- [ ]* 5.1 PublicPropertyDetailPageの統合テストを作成
  - 詳細画面でバッジが正しく表示されることをテスト
  - 各ステータスの物件に対してバッジが適切に表示されることを検証
  - _要件: 要件1.1, 要件1.2, 要件1.3, 要件1.4, 要件1.5, 要件1.6_

- [x] 6. チェックポイント - すべてのテストが成功することを確認
  - すべてのテストが成功することを確認し、質問があればユーザーに尋ねる

- [ ]* 7. E2Eテストの作成（オプション）
  - レスポンシブデザインのテスト（モバイル、タブレット、デスクトップ）
  - バッジの中央配置の検証
  - アクセシビリティのテスト
  - _要件: 要件3.1, 要件3.2, 要件3.3, 要件3.5, 要件4.1, 要件4.2_

- [x] 8. 最終チェックポイント - すべてのテストが成功し、機能が正常に動作することを確認
  - すべてのテストが成功することを確認し、質問があればユーザーに尋ねる

## 注意事項

- `*`マークが付いたタスクはオプションで、コア機能の実装を優先する場合はスキップ可能です
- 各タスクは前のタスクに依存しているため、順番に実装してください
- チェックポイントでは、すべてのテストが成功することを確認し、問題があれば修正してください
- プロパティベーステストは最低100回の反復で実行してください

---

**作成日:** 2026-01-13  
**ステータス:** 実装準備完了  
**推定工数:** 2〜3時間
