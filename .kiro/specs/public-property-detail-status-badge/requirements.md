# 要件定義書

## はじめに

本ドキュメントは、物件公開サイトの詳細画面（物件詳細ページ）のヘッダー中央に、物件のステータスを示すバッジ（「成約済み」「非公開」など）を表示する機能の要件を定義します。これにより、訪問者は物件の現在のステータスを一目で把握できるようになります。

## 用語集

- **Public_Property_Detail_Page**: 物件公開サイトの詳細画面（物件詳細ページ）
- **Status_Badge**: 物件のステータスを示すバッジ（「成約済み」「非公開」など）
- **Header**: 詳細画面の上部領域（ページヘッダー）
- **ATBB_Status**: 物件のステータスを示すデータベースフィールド（atbb_status）
- **Property_Listing**: 物件情報を格納するデータベーステーブル（property_listings）
- **Badge_Position**: バッジの表示位置（ヘッダー中央）
- **Visitor**: 物件公開サイトを閲覧する訪問者

## 要件

### 要件1: ステータスバッジの表示

**ユーザーストーリー:** 訪問者として、物件詳細画面のヘッダー中央にステータスバッジを表示してほしい。そうすれば、物件の現在のステータス（成約済み、非公開など）を一目で把握できる。

#### 受入基準

1. WHEN 訪問者が物件詳細画面を表示する THEN THE Public_Property_Detail_Page SHALL ヘッダーの中央にStatus_Badgeを表示する
2. WHEN 物件のatbb_statusが「非公開案件」を含む THEN THE Public_Property_Detail_Page SHALL 「成約済み」バッジを表示する
3. WHEN 物件のatbb_statusが「公開中」「公開前」「非公開（配信メールのみ）」のいずれも含まない THEN THE Public_Property_Detail_Page SHALL 「成約済み」バッジを表示する
4. WHEN 物件のatbb_statusが「非公開（配信メールのみ）」を含む THEN THE Public_Property_Detail_Page SHALL 「配信限定」バッジを表示する
5. WHEN 物件のatbb_statusが「公開前」を含む THEN THE Public_Property_Detail_Page SHALL 「公開前」バッジを表示する
6. WHEN 物件のatbb_statusが「公開中」を含む（例：「専任・公開中」「一般・公開中」） THEN THE Public_Property_Detail_Page SHALL バッジを表示しない
7. THE Status_Badge SHALL ヘッダーの水平方向の中央に配置される
8. THE Status_Badge SHALL ヘッダー内の他の要素（タイトル、ナビゲーションなど）と視覚的に調和する

### 要件2: バッジのスタイリング

**ユーザーストーリー:** 訪問者として、ステータスバッジが視認性が高く、プロフェッショナルなデザインであってほしい。そうすれば、物件のステータスを素早く理解できる。

#### 受入基準

1. WHEN 「成約済み」バッジを表示する THEN THE Status_Badge SHALL 赤色系の背景色を使用する
2. WHEN 「配信限定」バッジを表示する THEN THE Status_Badge SHALL オレンジ色系の背景色を使用する
3. WHEN 「公開前」バッジを表示する THEN THE Status_Badge SHALL 青色系の背景色を使用する
4. THE Status_Badge SHALL 白色のテキストを使用する
5. THE Status_Badge SHALL 適切なパディング（上下8px、左右16px程度）を持つ
6. THE Status_Badge SHALL 角丸（border-radius: 4px程度）を持つ
7. THE Status_Badge SHALL 適切なフォントサイズ（14px〜16px程度）を使用する
8. THE Status_Badge SHALL 太字（font-weight: 600以上）のテキストを使用する
9. THE Status_Badge SHALL 十分なコントラスト比（WCAG AA基準: 4.5:1以上）を確保する

### 要件3: レスポンシブデザイン

**ユーザーストーリー:** 訪問者として、どのデバイスでもステータスバッジが適切に表示されてほしい。そうすれば、スマートフォン、タブレット、デスクトップのいずれでも物件ステータスを確認できる。

#### 受入基準

1. WHEN モバイルデバイス（320px〜767px幅）で表示する THEN THE Status_Badge SHALL 適切なサイズで表示される
2. WHEN タブレットデバイス（768px〜1023px幅）で表示する THEN THE Status_Badge SHALL 適切なサイズで表示される
3. WHEN デスクトップデバイス（1024px以上の幅）で表示する THEN THE Status_Badge SHALL 適切なサイズで表示される
4. WHEN 画面幅が狭い場合 THEN THE Status_Badge SHALL テキストが省略されずに完全に表示される
5. THE Status_Badge SHALL すべての画面サイズでヘッダーの中央に配置される

### 要件4: アクセシビリティ

**ユーザーストーリー:** 障害を持つ訪問者として、支援技術を使用してステータスバッジの情報にアクセスできるようにしてほしい。そうすれば、すべての訪問者が平等に物件情報を取得できる。

#### 受入基準

1. THE Status_Badge SHALL 適切なARIAラベル（aria-label）を持つ
2. THE Status_Badge SHALL スクリーンリーダーで読み上げ可能である
3. THE Status_Badge SHALL 十分な色コントラスト（WCAG AA基準）を確保する
4. THE Status_Badge SHALL 色だけでなくテキストでもステータスを伝える

### 要件5: パフォーマンス

**ユーザーストーリー:** 訪問者として、ステータスバッジの表示によってページの読み込み速度が遅くならないでほしい。そうすれば、快適に物件情報を閲覧できる。

#### 受入基準

1. THE Status_Badge SHALL ページの初期レンダリング時に表示される
2. THE Status_Badge SHALL 追加のAPIリクエストを必要としない（既存の物件データを使用）
3. THE Status_Badge SHALL ページの読み込み時間に顕著な影響を与えない（50ms以内）
4. THE Status_Badge SHALL CSSのみでスタイリングされる（画像を使用しない）

### 要件6: 一貫性

**ユーザーストーリー:** 訪問者として、ステータスバッジが物件一覧画面のバッジと一貫性のあるデザインであってほしい。そうすれば、サイト全体で統一感のあるユーザー体験が得られる。

#### 受入基準

1. THE Status_Badge SHALL 物件一覧画面のバッジと同じステータス判定ロジックを使用する
2. THE Status_Badge SHALL 物件一覧画面のバッジと同じ色スキームを使用する
3. THE Status_Badge SHALL 物件一覧画面のバッジと同じテキストラベルを使用する
4. THE Status_Badge SHALL 既存のバッジコンポーネントまたはスタイルを再利用する

### 要件7: エラーハンドリング

**ユーザーストーリー:** 訪問者として、物件データが不完全な場合でもページが正常に表示されてほしい。そうすれば、エラーによって物件情報の閲覧が妨げられない。

#### 受入基準

1. WHEN 物件のatbb_statusが未定義またはnullの場合 THEN THE Public_Property_Detail_Page SHALL バッジを表示しない
2. WHEN 物件のatbb_statusが空文字列の場合 THEN THE Public_Property_Detail_Page SHALL バッジを表示しない
3. WHEN 物件データの取得に失敗した場合 THEN THE Public_Property_Detail_Page SHALL エラーメッセージを表示し、バッジは表示しない
4. THE Status_Badge SHALL 表示エラーによってページ全体のレンダリングを妨げない

### 要件8: 保守性

**ユーザーストーリー:** 開発者として、ステータスバッジのロジックとスタイルを一箇所で管理できるようにしてほしい。そうすれば、将来の変更や拡張が容易になる。

#### 受入基準

1. THE Status_Badge SHALL 再利用可能なコンポーネントとして実装される
2. THE Status_Badge SHALL ステータス判定ロジックを共通関数として実装する
3. THE Status_Badge SHALL スタイル定義を一箇所に集約する
4. THE Status_Badge SHALL TypeScriptの型定義を持つ
5. THE Status_Badge SHALL 単体テストでカバーされる

## 非機能要件

### NFR-1: コード品質
- 既存のコンポーネントやスタイルを可能な限り再利用する
- TypeScriptの型安全性を維持する
- Reactのベストプラクティスに従う
- コードの重複を避ける（DRY原則）

### NFR-2: パフォーマンス
- ページ読み込み時間への影響を最小限にする
- レンダリングパフォーマンスへの影響を最小限にする
- 効率的なデータマッピングを行う

### NFR-3: 保守性
- バッジレンダリングの単一の真実の源を持つ
- 一箇所でバッジスタイルを更新できる
- 明確なコンポーネント構造を持つ

### NFR-4: アクセシビリティ
- WCAG 2.1 Level AA基準を満たす
- スクリーンリーダーのサポート
- 十分な色コントラスト比を確保する

## スコープ外

- 物件一覧画面のバッジの変更
- 新しいステータスタイプの追加
- バッジのアニメーション効果
- バッジのクリック可能な機能
- APIの変更
- データベーススキーマの変更

## 依存関係

- 既存の物件公開サイト（public-property-site）
- Material-UI (@mui/material)
- React Router（ナビゲーション用）
- 既存の物件データAPI
- 既存のバッジスタイル（存在する場合）

## リスクと対策

### リスク1: ヘッダーレイアウトの競合
**リスク:** バッジの追加によって既存のヘッダーレイアウトが崩れる可能性  
**対策:** 
- 既存のヘッダー構造を事前に確認する
- FlexboxまたはGridレイアウトを使用して柔軟な配置を実現する
- レスポンシブデザインを徹底的にテストする

### リスク2: ステータス判定ロジックの不一致
**リスク:** 一覧画面と詳細画面でステータス判定が異なる可能性  
**対策:**
- 共通のステータス判定関数を作成する
- 両画面で同じ関数を使用する
- 単体テストでロジックの一貫性を検証する

### リスク3: パフォーマンスへの影響
**リスク:** バッジの追加によってページ読み込みが遅くなる可能性  
**対策:**
- CSSのみでスタイリングする（画像を使用しない）
- 追加のAPIリクエストを避ける
- パフォーマンステストを実施する

## テスト計画

### テストケース1: バッジの表示（成約済み）
1. atbb_statusが「非公開案件」の物件詳細画面にアクセス
2. ヘッダー中央に「成約済み」バッジが表示されることを確認
3. バッジの色が赤色系であることを確認
4. バッジのテキストが白色であることを確認

**期待結果:** 「成約済み」バッジが正しく表示される

### テストケース2: バッジの表示（配信限定）
1. atbb_statusが「非公開（配信メールのみ）」の物件詳細画面にアクセス
2. ヘッダー中央に「配信限定」バッジが表示されることを確認
3. バッジの色がオレンジ色系であることを確認

**期待結果:** 「配信限定」バッジが正しく表示される

### テストケース3: バッジの表示（公開前）
1. atbb_statusが「公開前」の物件詳細画面にアクセス
2. ヘッダー中央に「公開前」バッジが表示されることを確認
3. バッジの色が青色系であることを確認

**期待結果:** 「公開前」バッジが正しく表示される

### テストケース4: バッジの非表示（公開中）
1. atbb_statusが「専任・公開中」または「一般・公開中」の物件詳細画面にアクセス
2. ヘッダーにバッジが表示されないことを確認

**期待結果:** バッジが表示されない

### テストケース5: レスポンシブデザイン
1. デスクトップ（1920x1080）でテスト
2. タブレット（768x1024）でテスト
3. モバイル（375x667）でテスト
4. すべての画面サイズでバッジが中央に表示されることを確認

**期待結果:** すべての画面サイズでバッジが正しく表示される

### テストケース6: アクセシビリティ
1. スクリーンリーダーでバッジを読み上げ
2. 色コントラスト比を測定
3. キーボードナビゲーションをテスト

**期待結果:** アクセシビリティ基準を満たす

### テストケース7: エラーハンドリング
1. atbb_statusがnullの物件詳細画面にアクセス
2. atbb_statusが空文字列の物件詳細画面にアクセス
3. ページが正常に表示され、バッジが表示されないことを確認

**期待結果:** エラーが発生せず、バッジが表示されない

## 受入テスト

### ユーザー受入基準
- [ ] ユーザーが詳細画面のヘッダー中央にバッジが表示されることを確認
- [ ] ユーザーがバッジの色とテキストが適切であることを確認
- [ ] ユーザーがすべてのデバイスでバッジが正しく表示されることを確認
- [ ] ユーザーが他の機能が正常に動作することを確認

## 参考資料

- 既存仕様: `.kiro/specs/public-property-site/`
- 既存仕様: `.kiro/specs/public-property-list-badge-fix/`
- 詳細画面: `frontend/src/pages/PublicPropertyDetailPage.tsx`（推定）
- 一覧画面: `frontend/src/pages/PublicPropertiesPage.tsx`

---

**作成日:** 2026-01-13  
**ステータス:** 実装準備完了  
**優先度:** 中  
**複雑度:** 低  
**推定工数:** 1〜2時間
