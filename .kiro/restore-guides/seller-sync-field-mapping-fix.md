# å£²ä¸»åŒæœŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°ä¿®æ­£ - å¾©å…ƒã‚¬ã‚¤ãƒ‰

## ğŸš¨ å•é¡Œã®ç—‡çŠ¶

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®ç—‡çŠ¶ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š

1. **ä¸é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒåŒæœŸã•ã‚Œãªã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã€Œä¸é€šã€ã¨å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã•ã‚Œãªã„
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ä¸é€šã‚’è¨­å®šã—ã¦ã‚‚ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åæ˜ ã•ã‚Œãªã„

2. **ç‰©ä»¶ä½æ‰€ãŒåŒæœŸã•ã‚Œãªã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®Råˆ—ã€Œç‰©ä»¶æ‰€åœ¨åœ°ã€ã«ä½æ‰€ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã€Œæœªå…¥åŠ›ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ç‰©ä»¶ä½æ‰€ã‚’è¨­å®šã—ã¦ã‚‚ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åæ˜ ã•ã‚Œãªã„

3. **ã‚³ãƒ¡ãƒ³ãƒˆãŒåŒæœŸã•ã‚Œãªã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã€Œã‚³ãƒ¡ãƒ³ãƒˆã€ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã•ã‚Œãªã„
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨­å®šã—ã¦ã‚‚ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åæ˜ ã•ã‚Œãªã„

---

## ğŸ“‹ å¾©å…ƒæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¹ãƒšãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª

```bash
# ã‚¹ãƒšãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
ls .kiro/specs/aa13501-sync-fix/
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
- `requirements.md`
- `design.md`
- `tasks.md`

### ã‚¹ãƒ†ãƒƒãƒ—2: æ­£ã—ã„ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèª

```bash
# æœ€æ–°ã®å‹•ä½œã—ã¦ã„ãŸã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèª
git log --oneline --all -20 | grep -i "sync\|column-mapping\|aa13501"
```

**æ­£ã—ã„ã‚³ãƒŸãƒƒãƒˆ**: æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆï¼ˆã“ã®ã‚¹ãƒšãƒƒã‚¯ãŒå®Œäº†ã—ãŸå¾Œã®ã‚³ãƒŸãƒƒãƒˆï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—3: é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒ

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ã„çŠ¶æ…‹ã‹ç¢ºèªï¼š

1. **`backend/src/config/column-mapping.json`**
   - `"ä¸é€š": "unreachable_status"` â† `is_unreachable`ã§ã¯ãªã„
   - `"ã‚³ãƒ¡ãƒ³ãƒˆ": "comments"` â† å­˜åœ¨ã™ã‚‹
   - `"unreachable_status": "ä¸é€š"` â† databaseToSpreadsheetã«å­˜åœ¨
   - `"property_address": "ç‰©ä»¶æ‰€åœ¨åœ°"` â† databaseToSpreadsheetã«å­˜åœ¨
   - `"comments": "ã‚³ãƒ¡ãƒ³ãƒˆ"` â† databaseToSpreadsheetã«å­˜åœ¨

2. **`backend/src/services/ColumnMapper.ts`**
   - `mapToSheet()`ãƒ¡ã‚½ãƒƒãƒ‰ã§`unreachable_status`ã‚’å„ªå…ˆ

3. **`backend/supabase/migrations/20260130_add_property_address_to_sellers.sql`**
   - `property_address`ã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’ç¢ºèª

```sql
-- property_addressã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'sellers' 
AND column_name = 'property_address';
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**: `property_address` ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã™ã‚‹ï¼ˆTEXTå‹ï¼‰

**ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„å ´åˆ**:
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
psql -h <host> -U <user> -d <database> -f backend/supabase/migrations/20260130_add_property_address_to_sellers.sql
```

### ã‚¹ãƒ†ãƒƒãƒ—5: ç‰¹å®šã®å£²ä¸»ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶åŒæœŸ

```bash
# ä¾‹: AA13501ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶åŒæœŸ
npx ts-node backend/force-sync-aa13501-from-sheet.ts

# ã¾ãŸã¯ã€ä»»æ„ã®å£²ä¸»ç•ªå·ã§åŒæœŸ
npx ts-node backend/sync-seller-from-sheet.ts <å£²ä¸»ç•ªå·>
```

### ã‚¹ãƒ†ãƒƒãƒ—6: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
npx ts-node backend/clear-aa13501-cache.ts

# ã¾ãŸã¯ã€ä»»æ„ã®å£²ä¸»ç•ªå·ã§ã‚¯ãƒªã‚¢
npx ts-node backend/clear-seller-cache.ts <å£²ä¸»ç•ªå·>
```

---

## ğŸ” ç¢ºèªæ–¹æ³•

### 1. column-mapping.jsonã‚’ç¢ºèª

```bash
# spreadsheetToDatabaseã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
cat backend/src/config/column-mapping.json | grep -A 5 "spreadsheetToDatabase"
```

**æ­£ã—ã„çŠ¶æ…‹**:
```json
"spreadsheetToDatabase": {
  "ä¸é€š": "unreachable_status",  // â† is_unreachableã§ã¯ãªã„
  "ç‰©ä»¶æ‰€åœ¨åœ°": "property_address",
  "ã‚³ãƒ¡ãƒ³ãƒˆ": "comments"  // â† å­˜åœ¨ã™ã‚‹
}
```

```bash
# databaseToSpreadsheetã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
cat backend/src/config/column-mapping.json | grep -A 10 "databaseToSpreadsheet"
```

**æ­£ã—ã„çŠ¶æ…‹**:
```json
"databaseToSpreadsheet": {
  "unreachable_status": "ä¸é€š",  // â† å­˜åœ¨ã™ã‚‹
  "property_address": "ç‰©ä»¶æ‰€åœ¨åœ°",  // â† å­˜åœ¨ã™ã‚‹
  "comments": "ã‚³ãƒ¡ãƒ³ãƒˆ",  // â† å­˜åœ¨ã™ã‚‹
  "is_unreachable": "ä¸é€š"  // â† å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™
}
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª

```bash
# ç‰¹å®šã®å£²ä¸»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
npx ts-node backend/check-aa13501-complete.ts
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```
âœ… unreachable_status: "ä¸é€š"
âœ… property_address: "å¤§åˆ†å¸‚åºœå†…ç”º1ä¸ç›®5-29"
âœ… comments: "é•·ã„ã‚³ãƒ¡ãƒ³ãƒˆ..."
```

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

1. é€šè©±ãƒ¢ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ï¼ˆ`/sellers/:id/call`ï¼‰ã‚’é–‹ã
2. ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
   - âœ… ä¸é€šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã€Œä¸é€šã€ã¨è¡¨ç¤º
   - âœ… ç‰©ä»¶æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç‰©ä»¶ä½æ‰€ã«ä½æ‰€ãŒè¡¨ç¤º
   - âœ… ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤º

---

## ğŸš¨ ã‚ˆãã‚ã‚‹é–“é•ã„

### âŒ é–“é•ã„1: `is_unreachable`ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹

**ç—‡çŠ¶**: ä¸é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒåŒæœŸã•ã‚Œãªã„

**åŸå› **: `column-mapping.json`ã§`"ä¸é€š": "is_unreachable"`ã«ãªã£ã¦ã„ã‚‹

**ä¿®æ­£**:
```json
// âŒ é–“é•ã„
"ä¸é€š": "is_unreachable"

// âœ… æ­£ã—ã„
"ä¸é€š": "unreachable_status"
```

### âŒ é–“é•ã„2: `property_address`ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„

**ç—‡çŠ¶**: ç‰©ä»¶ä½æ‰€ãŒã€Œæœªå…¥åŠ›ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **: `sellers`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`property_address`ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„

**ä¿®æ­£**:
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
psql -h <host> -U <user> -d <database> -f backend/supabase/migrations/20260130_add_property_address_to_sellers.sql
```

### âŒ é–“é•ã„3: `comments`ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå­˜åœ¨ã—ãªã„

**ç—‡çŠ¶**: ã‚³ãƒ¡ãƒ³ãƒˆãŒåŒæœŸã•ã‚Œãªã„

**åŸå› **: `column-mapping.json`ã«`comments`ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå­˜åœ¨ã—ãªã„

**ä¿®æ­£**:
```json
// spreadsheetToDatabaseã«è¿½åŠ 
"ã‚³ãƒ¡ãƒ³ãƒˆ": "comments"

// databaseToSpreadsheetã«è¿½åŠ 
"comments": "ã‚³ãƒ¡ãƒ³ãƒˆ"
```

---

## ğŸ“ æ¬¡å›ã®å¾©å…ƒä¾é ¼ã®ä»•æ–¹

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ä¾é ¼ã—ã¦ãã ã•ã„ï¼š

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ç—‡çŠ¶ã‚’ä¼ãˆã‚‹ï¼ˆæ¨å¥¨ï¼‰

```
ä¸é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åŒæœŸã•ã‚Œãªã„ã€‚
å¾©å…ƒã‚¬ã‚¤ãƒ‰ã€Œseller-sync-field-mapping-fix.mdã€ã‚’å‚ç…§ã—ã¦ä¿®æ­£ã—ã¦ã€‚
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¹ãƒšãƒƒã‚¯ã‚’æŒ‡å®š

```
AA13501åŒæœŸä¿®æ­£ã®ã‚¹ãƒšãƒƒã‚¯ï¼ˆ.kiro/specs/aa13501-sync-fix/ï¼‰ã‚’å‚ç…§ã—ã¦ã€
column-mapping.jsonã¨ColumnMapper.tsã‚’ä¿®æ­£ã—ã¦ã€‚
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: å…·ä½“çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š

```
backend/src/config/column-mapping.jsonã§ã€
ã€Œä¸é€šã€ãŒã€Œunreachable_statusã€ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã€‚
é–“é•ã£ã¦ã„ãŸã‚‰ä¿®æ­£ã—ã¦ã€‚
```

---

## ğŸ¯ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **`column-mapping.json`ãŒæœ€é‡è¦**
   - `"ä¸é€š": "unreachable_status"` â† `is_unreachable`ã§ã¯ãªã„
   - `"ã‚³ãƒ¡ãƒ³ãƒˆ": "comments"` â† å¿…ãšå­˜åœ¨
   - databaseToSpreadsheetã«ã‚‚é€†æ–¹å‘ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå¿…è¦

2. **`property_address`ã‚«ãƒ©ãƒ ã®å­˜åœ¨ç¢ºèª**
   - `sellers`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`property_address`ã‚«ãƒ©ãƒ ãŒå¿…è¦
   - å­˜åœ¨ã—ãªã„å ´åˆã¯ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ

3. **å¼·åˆ¶åŒæœŸã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢**
   - ä¿®æ­£å¾Œã¯å¿…ãšå¼·åˆ¶åŒæœŸã‚’å®Ÿè¡Œ
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

4. **ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§**
   - `.kiro/steering/seller-table-column-definition.md` - ã‚«ãƒ©ãƒ åã®å®šç¾©
   - `.kiro/steering/seller-spreadsheet-column-mapping.md` - å®Œå…¨ãªãƒãƒƒãƒ”ãƒ³ã‚°è¡¨

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **ã‚¹ãƒšãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«**: `.kiro/specs/aa13501-sync-fix/`
  - `requirements.md` - è¦ä»¶å®šç¾©
  - `design.md` - è¨­è¨ˆæ›¸
  - `tasks.md` - ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

- **ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
  - `.kiro/steering/seller-table-column-definition.md` - å£²ä¸»ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ å®šç¾©
  - `.kiro/steering/seller-spreadsheet-column-mapping.md` - ã‚«ãƒ©ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°å®Œå…¨ç‰ˆ

- **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
  - `backend/src/config/column-mapping.json` - ã‚«ãƒ©ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š
  - `backend/src/services/ColumnMapper.ts` - ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
  - `backend/supabase/migrations/20260130_add_property_address_to_sellers.sql` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2026å¹´1æœˆ30æ—¥  
**ä½œæˆç†ç”±**: AA13501åŒæœŸå•é¡Œã®å†ç™ºé˜²æ­¢ã¨è¿…é€Ÿãªå¾©å…ƒã®ãŸã‚

