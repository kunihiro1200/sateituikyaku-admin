<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šè©±å±¥æ­´ã‚µãƒãƒªãƒ¼API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-case {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .summary-box {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        .metadata {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .loading {
            color: #2196F3;
            font-weight: bold;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª é€šè©±å±¥æ­´ã‚µãƒãƒªãƒ¼API ãƒ†ã‚¹ãƒˆ</h1>
    
    <div style="background: #fff3cd; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <strong>ğŸ“ ä½¿ã„æ–¹:</strong>
        <ol>
            <li>ã“ã®ãƒšãƒ¼ã‚¸ãŒé–‹ã„ãŸã‚‰ã€è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒé–‹å§‹ã•ã‚Œã¾ã™</li>
            <li>å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
            <li>ç”Ÿæˆã•ã‚ŒãŸã‚µãƒãƒªãƒ¼ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„</li>
        </ol>
    </div>

    <button onclick="runAllTests()" id="runButton">ğŸ”„ ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ</button>

    <div id="results"></div>

    <script>
        const API_BASE_URL = 'http://localhost:3000';
        
        // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•å–å¾—
        const token = localStorage.getItem('session_token');
        
        const testData = {
            test1: {
                name: 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ç°¡å˜ãªãƒ¡ãƒ¢é…åˆ—ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰',
                data: {
                    memos: [
                        '3/2 12:00 è¨ªå•æŸ»å®šã®æ—¥ç¨‹èª¿æ•´ã‚’è¡Œã£ãŸ',
                        '2/28 15:30 ç‰©ä»¶æƒ…å ±ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°å®Œäº†',
                        '2/25 10:00 åˆå›ã‚³ãƒ³ã‚¿ã‚¯ãƒˆã€èˆˆå‘³ã‚ã‚Š'
                    ]
                }
            },
            test2: {
                name: 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ä¾‹1ï¼ˆåœŸåœ°å£²å´ã€ç›¸ç¶šï¼‰',
                data: {
                    memos: [
                        '10/1 å£²ã‚‹ã®ã¯ã‚‚ã†å°‘ã—æ§˜å­ã‚’è¦‹ãŸã„ã¨ã®ã“ã¨',
                        '9/7 ä»Šå¹´ä¸­ã«å£²ã‚ŠãŸã„ã€€çœŒå¤–ã«ã„ã‚‹ã®ã§å¤§åˆ†ã«æ¥ã¦ã‹ã‚‰å®Ÿéš›ã«ã„ãµã†ã¨ã‚ã£ã¦ã‹ã‚‰å‹Ÿé›†ã™ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨ã®ã“ã¨ã€‚åœŸåœ°ã‚’å£²ã£ãŸã¨ã—ã¦ã‚‚ã€è²·ã„ä¸»æ§˜ã«ã¯æ¥å¹´ã®4æœˆä»¥é™ã«å»ºç‰©ã‚’å»ºã¦ã¦ã»ã—ã„ã€‚ç†ç”±ã¯ç›¸ç¶šã§è¦ªæˆšã®æ–¹ãŒãã“ã‚’å£²ã‚ŠãŸããªã„ã¨ã„ã†æ€ã„ãŒå¼·ã„ã®ã§ã€è‡ªåˆ†ãŒä»Šãã®è¿‘ãã«ä½ã‚“ã§ã„ã¦ã€å¼•ã£è¶Šã—ãŸã‚‰å®¶ã‚’å»ºã¦ã¦ã‚‚æ–‡å¥ã‚’è¨€ã‚ã‚Œãªã„ã‹ã‚‰ã¨ã®ã“ã¨ï¼ˆå°‘ã—ã‚ã‚„ã—ã„ï¼‰',
                        '9/5 é¢ç©ã¯ã ã„ãŸã„ã€€æ›´åœ°ã«ã—ã¦ã„ã‚‹ã€‚é§è»Šå ´ã¨ã—ã¦æœˆæ¥µã§è²¸ã—ã¦ã„ã‚‹ã€‚å£²å´ã®ã”äºˆå®šã‚ã‚Šã€‚åœŸåœ°ã¸ã®æ€ã„ãŒã‚ã‚‹ã®ã§å¤‰ãªä½¿ã„æ–¹ã¯ã•ã‚ŒãŸããªã„ã€‚å½“ç¤¾ãŒå£²è²·ã«å¼·ãã€å•åˆã›ãŒå¤šã„ã¨ä¼ãˆã‚‹ã¨ã‹ãªã‚Šèˆˆå‘³æ´¥ã€…ã§ã©ã‚“ãªæ–¹ã‹ï¼Ÿç­‰ãã„ã¤ã„ã¦ããŸã€‚è¨ªå•æŸ»å®šã¯ã¾ã è€ƒãˆã‚‹ã¨ã®ã“ã¨',
                        'â˜…å¸Œæœ›é€£çµ¡æ™‚é–“ï¼š9æ™‚ï½12æ™‚'
                    ]
                }
            },
            test3: {
                name: 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ä¾‹2ï¼ˆå»ºç‰©è§£ä½“ã€1å¹´å¾Œå£²å´ï¼‰',
                data: {
                    memos: [
                        '10/19 ã„ã£ãŸã‚“ã§ã‚‹ãŒåˆ‡ã‚‰ã‚Œã‚‹',
                        '10/12 è‡ªåˆ†æœ¬äººã§ã¯ãªã„ã€€å«ã®ãŠæ¯æ§˜ãŒæ‰€æœ‰ã€€1å¹´å¾Œãã‚‰ã„ã«ã†ã‚‹äºˆå®šã€‚ã€€è²·ã„ãŸã„ã¨ã„ã†äººãŒã„ãŸã‚‰ç´¹ä»‹ã—ã¦ã‚‚ã‚ˆã„ã€‚åª’ä»‹å¥‘ç´„ã«ä¼ºã†æ—¥ç¨‹ã¯å«ã®ãŠæ¯æ§˜ã¨è©±ã—åˆã†ã®ã§æ¥é€±ã¾ãŸé›»è©±ã—ã¦ã»ã—ã„ã¨ã®ã“ã¨',
                        'é¢ç©100åªã€€å»ºç‰©ã¯ã“ã‚ã™ã€€åœŸåœ°ã¨ã—ã¦å£²å´ã€€æœºä¸ŠæŸ»å®šãƒ¡ãƒ¼ãƒ«å¸Œæœ›ã€€ã¾ã å£²ã‚‹ã‹ã©ã†ã‹ä¸æ˜ãªçŠ¶æ…‹'
                    ]
                }
            },
            test4: {
                name: 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹4: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ä¾‹3ï¼ˆä»–ç¤¾å°‚ä»»åª’ä»‹ï¼‰',
                data: {
                    memos: [
                        '2025/1/31 ä¹…å…‰å¤§åˆ†ã§è²·ã£ã¦å°‚ä»»åª’ä»‹çµã‚“ã§ã—ã¾ã£ãŸã€‚3190ä¸‡ã§å‹Ÿé›†ä¸­ã¨ã®ã“ã¨',
                        '2024/11/29 13:09 çŠ¶æ³å¤‰åŒ–ãªã—ã€‚',
                        '2024/10/4 17:21 è¨ªå•æŸ»å®šã¯ä»–ç¤¾å«ã‚ã¾ã è€ƒãˆã¦ã„ãªã„ã€‚å¼•è¶Šã‚‚æ€¥ã„ã§ã„ãªã„ã€æ™‚æœŸæœªå®šã¨ã®ã“ã¨ã€‚',
                        '2024/9/30 17:49 é‡‘é¡çš„ã«ã‚‚ã†å°‘ã—ã¨ã„ã£ãŸã¨ã“ã‚ã€‚ã»ã‹ã®ä¼šç¤¾ã¯3000ä¸‡ã“ãˆã‚‹ã¨ã®ã“ã¨ã€‚è²·å–ã§2000ä¸‡å‡ºã—ã¦ã‚‚ã„ã„ã¨è¨€ã£ã¦ã„ã‚‹ä¼šç¤¾ã‚‚ã‚ã‚‹ã€‚èµ¤ã¡ã‚ƒã‚“ãŒæ³£ãã ã—ãŸã®ã§é›»è©±åˆ‡ã‚‰ã‚Œã‚‹ã€‚',
                        '2024/9/28 18:04 å¤ªé™½å…‰ã®å£²é›»æœŸé–“ã¯11æœˆã«çµ‚ã‚ã‚‹ã€‚ãƒã‚¦ã‚¹ãƒ¡ãƒ¼ã‚«ãƒ¼ã¯å¤§å’Œãƒã‚¦ã‚¹ã€æ¬¡ã®ãŠä½ã¾ã„ã¯å­ä¾›ãŒå°å­¦æ ¡ã«é€šã£ã¦ã„ã¦ã€æ¾å²¡å°ã‚ãŸã‚Šã§æ¤œè¨ä¸­'
                    ]
                }
            }
        };

        async function runTest(testKey, testInfo) {
            const resultsDiv = document.getElementById('results');
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.id = testKey;
            testDiv.innerHTML = `<h2>${testInfo.name}</h2><p class="loading">â³ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>`;
            resultsDiv.appendChild(testDiv);

            try {
                const startTime = Date.now();
                
                const response = await fetch(`${API_BASE_URL}/summarize/call-memos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testInfo.data)
                });

                const processingTime = Date.now() - startTime;

                if (!response.ok) {
                    const error = await response.json();
                    testDiv.innerHTML = `
                        <h2>${testInfo.name}</h2>
                        <p class="error">âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—</p>
                        <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}</p>
                        <pre>${JSON.stringify(error, null, 2)}</pre>
                    `;
                    return;
                }

                const result = await response.json();
                
                let metadataHtml = '';
                if (result.metadata) {
                    metadataHtml = `
                        <div class="metadata">
                            <strong>ğŸ“Š ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿:</strong><br>
                            é€šè©±å›æ•°ï¼ˆå±¥æ­´ï¼‰: ${result.metadata.callsFromHistory}å›<br>
                            é€šè©±å›æ•°ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰: ${result.metadata.callsFromComments}å›<br>
                            åˆè¨ˆé€šè©±å›æ•°: ${result.metadata.totalCalls}å›<br>
                            ç”Ÿæˆã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³: ${result.metadata.sectionsGenerated.join(', ')}<br>
                            ${result.metadata.oldestEntry ? `æœ€å¤ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼: ${result.metadata.oldestEntry}<br>` : ''}
                            ${result.metadata.newestEntry ? `æœ€æ–°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼: ${result.metadata.newestEntry}` : ''}
                        </div>
                    `;
                }
                
                testDiv.innerHTML = `
                    <h2>${testInfo.name}</h2>
                    <p class="success">âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ</p>
                    <p>å‡¦ç†æ™‚é–“: ${processingTime}ms</p>
                    ${metadataHtml}
                    <div class="summary-box">${result.summary}</div>
                `;
            } catch (error) {
                testDiv.innerHTML = `
                    <h2>${testInfo.name}</h2>
                    <p class="error">âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—</p>
                    <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                `;
            }
        }

        async function runAllTests() {
            const button = document.getElementById('runButton');
            button.disabled = true;
            button.textContent = 'â³ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (!token) {
                resultsDiv.innerHTML = `
                    <div class="test-case">
                        <h2 class="error">âŒ ã‚¨ãƒ©ãƒ¼</h2>
                        <p>ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                `;
                button.disabled = false;
                button.textContent = 'ğŸ”„ ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ';
                return;
            }

            for (const [key, testInfo] of Object.entries(testData)) {
                await runTest(key, testInfo);
            }

            button.disabled = false;
            button.textContent = 'ğŸ”„ ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ';
            
            resultsDiv.innerHTML += `
                <div class="test-case" style="background: #e8f5e9;">
                    <h2 class="success">âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†</h2>
                    <p>ç”Ÿæˆã•ã‚ŒãŸã‚µãƒãƒªãƒ¼ã®å“è³ªã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p>
                    <ul>
                        <li>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ­£ã—ãè§£æã•ã‚Œã¦ã„ã‚‹ã‹</li>
                        <li>é€šè©±å›æ•°ãŒæ­£ç¢ºã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹</li>
                        <li>æƒ…å ±ãŒé©åˆ‡ãªã‚«ãƒ†ã‚´ãƒªãƒ¼ã«åˆ†é¡ã•ã‚Œã¦ã„ã‚‹ã‹</li>
                        <li>é‡è¤‡ã—ãŸå†…å®¹ãŒé™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã‹</li>
                        <li>å‡¦ç†æ™‚é–“ãŒ2ç§’ä»¥å†…ã‹</li>
                    </ul>
                </div>
            `;
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.onload = runAllTests;
    </script>
</body>
</html>
