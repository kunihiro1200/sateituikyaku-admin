<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä»¶ã‚«ãƒ¼ãƒ‰ãƒãƒƒã‚¸è¨ºæ–­</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .section h2 {
            margin-top: 0;
            color: #1976d2;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-left: 4px solid #4caf50;
        }
        .error {
            border-left-color: #f44336;
        }
        .warning {
            border-left-color: #ff9800;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        .badge-preview {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç‰©ä»¶ã‚«ãƒ¼ãƒ‰ãƒãƒƒã‚¸è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="section">
            <h2>1. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª</h2>
            <button onclick="checkAPI()">APIã‚’ãƒã‚§ãƒƒã‚¯</button>
            <div id="api-result"></div>
        </div>

        <div class="section">
            <h2>2. ç‰©ä»¶ã‚¿ã‚¤ãƒ—ãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª</h2>
            <button onclick="checkTypeMapping()">ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ãƒã‚§ãƒƒã‚¯</button>
            <div id="mapping-result"></div>
        </div>

        <div class="section">
            <h2>3. DOMè¦ç´ ç¢ºèª</h2>
            <button onclick="checkDOM()">DOMã‚’ãƒã‚§ãƒƒã‚¯</button>
            <div id="dom-result"></div>
        </div>

        <div class="section">
            <h2>4. CSSç¢ºèª</h2>
            <button onclick="checkCSS()">CSSã‚’ãƒã‚§ãƒƒã‚¯</button>
            <div id="css-result"></div>
        </div>
    </div>

    <script>
        async function checkAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<p>ãƒã‚§ãƒƒã‚¯ä¸­...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/api/public/properties?limit=5');
                const data = await response.json();
                
                let html = '<div class="result">';
                html += `<p><strong>å–å¾—ä»¶æ•°:</strong> ${data.properties.length}</p>`;
                html += '<p><strong>ç‰©ä»¶ã‚¿ã‚¤ãƒ—:</strong></p><ul>';
                
                const typeCounts = {};
                data.properties.forEach(prop => {
                    typeCounts[prop.property_type] = (typeCounts[prop.property_type] || 0) + 1;
                });
                
                Object.entries(typeCounts).forEach(([type, count]) => {
                    html += `<li>${type}: ${count}ä»¶</li>`;
                });
                
                html += '</ul>';
                html += '<p><strong>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿:</strong></p>';
                html += '<pre>' + JSON.stringify(data.properties[0], null, 2) + '</pre>';
                html += '</div>';
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p></div>`;
            }
        }

        function checkTypeMapping() {
            const resultDiv = document.getElementById('mapping-result');
            
            const typeConfigs = {
                'detached_house': { label: 'ä¸€æˆ¸å»ºã¦', color: '#8B5CF6', bgColor: '#EDE9FE' },
                'apartment': { label: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', color: '#EC4899', bgColor: '#FCE7F3' },
                'land': { label: 'åœŸåœ°', color: '#14B8A6', bgColor: '#CCFBF1' },
                'other': { label: 'ãã®ä»–', color: '#6B7280', bgColor: '#F3F4F6' },
            };
            
            let html = '<div class="result">';
            html += '<p><strong>ç‰©ä»¶ã‚¿ã‚¤ãƒ—ãƒãƒƒãƒ”ãƒ³ã‚°:</strong></p>';
            
            Object.entries(typeConfigs).forEach(([key, config]) => {
                html += `<div class="badge-preview" style="background-color: ${config.bgColor}; color: ${config.color};">`;
                html += `${config.label} (${key})`;
                html += '</div>';
            });
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        function checkDOM() {
            const resultDiv = document.getElementById('dom-result');
            
            // å…¬é–‹ç‰©ä»¶ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ã„ã‚‹ã‹ç¢ºèª
            if (window.location.pathname.includes('/public/properties')) {
                const badges = document.querySelectorAll('.property-type-badge');
                const cards = document.querySelectorAll('.property-card');
                
                let html = '<div class="result">';
                html += `<p><strong>ç‰©ä»¶ã‚«ãƒ¼ãƒ‰æ•°:</strong> ${cards.length}</p>`;
                html += `<p><strong>ãƒãƒƒã‚¸è¦ç´ æ•°:</strong> ${badges.length}</p>`;
                
                if (badges.length === 0) {
                    html += '<p class="warning">âš ï¸ ãƒãƒƒã‚¸è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼</p>';
                } else {
                    html += '<p><strong>ãƒãƒƒã‚¸ã®å†…å®¹:</strong></p><ul>';
                    badges.forEach((badge, i) => {
                        const text = badge.textContent;
                        const styles = window.getComputedStyle(badge);
                        html += `<li>ãƒãƒƒã‚¸ ${i + 1}: "${text}" (display: ${styles.display}, visibility: ${styles.visibility}, opacity: ${styles.opacity})</li>`;
                    });
                    html += '</ul>';
                }
                
                html += '</div>';
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = '<div class="result warning"><p>âš ï¸ ã“ã®ãƒ„ãƒ¼ãƒ«ã¯å…¬é–‹ç‰©ä»¶ãƒšãƒ¼ã‚¸ (http://localhost:5173/public/properties) ã§å®Ÿè¡Œã—ã¦ãã ã•ã„</p></div>';
            }
        }

        function checkCSS() {
            const resultDiv = document.getElementById('css-result');
            
            // CSSãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª
            const styleSheets = Array.from(document.styleSheets);
            let foundRules = [];
            
            try {
                styleSheets.forEach(sheet => {
                    try {
                        const rules = Array.from(sheet.cssRules || []);
                        rules.forEach(rule => {
                            if (rule.selectorText && rule.selectorText.includes('property-type-badge')) {
                                foundRules.push({
                                    selector: rule.selectorText,
                                    cssText: rule.cssText
                                });
                            }
                        });
                    } catch (e) {
                        // CORSåˆ¶é™ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—
                    }
                });
                
                let html = '<div class="result">';
                if (foundRules.length === 0) {
                    html += '<p class="error">âŒ .property-type-badge ã®CSSãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼</p>';
                } else {
                    html += `<p><strong>è¦‹ã¤ã‹ã£ãŸCSSãƒ«ãƒ¼ãƒ«:</strong> ${foundRules.length}ä»¶</p>`;
                    foundRules.forEach(rule => {
                        html += '<pre>' + rule.cssText + '</pre>';
                    });
                }
                html += '</div>';
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p></div>`;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('è¨ºæ–­ãƒ„ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            console.log('å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨ºæ–­ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>
