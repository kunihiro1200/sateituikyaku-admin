# Accessibility Features - Inline Editable Fields

このドキュメントでは、インライン編集可能フィールドのアクセシビリティ機能について説明します。

## WCAG 2.1 Level AA 準拠

このコンポーネントは、WCAG 2.1 Level AA の基準に準拠するように設計されています。

## 実装されたアクセシビリティ機能

### 1. ARIA Labels と Roles

#### フィールドラベル
- すべての編集可能フィールドに適切な `aria-label` または `aria-labelledby` を設定
- ラベルとフィールドの関連付けに `htmlFor` と `id` を使用
- 編集不可フィールドには `aria-disabled="true"` を設定

#### エラーメッセージ
- エラーメッセージに `role="alert"` と `aria-live="assertive"` を設定
- エラーがある場合、フィールドに `aria-invalid="true"` を設定
- `aria-describedby` でエラーメッセージとフィールドを関連付け

#### ステータス通知
- 保存中、保存完了などの状態変化を `aria-live="polite"` で通知
- スクリーンリーダー用の隠しライブリージョンを実装

#### モーダルダイアログ
- 競合通知モーダルに `role="dialog"` と `aria-modal="true"` を設定
- `aria-labelledby` と `aria-describedby` でモーダルの内容を説明

### 2. キーボードナビゲーション

#### 基本操作
- **Tab**: 次のフィールドに移動（自動保存）
- **Shift+Tab**: 前のフィールドに移動（自動保存）
- **Enter**: 
  - 単一行フィールド: 保存して次のフィールドへ
  - 複数行フィールド: 改行を挿入
- **Escape**: 編集をキャンセルして元の値に戻す
- **Space/Enter** (表示モード): 編集モードを開始

#### フォーカス管理
- 編集モード開始時に自動的に入力フィールドにフォーカス
- モーダル表示時にキャンセルボタンにフォーカス
- モーダル内でフォーカストラップを実装（Tab キーでモーダル外に出ない）

### 3. 視覚的フィードバック

#### フォーカスインジケーター
- すべてのインタラクティブ要素に明確なフォーカスリングを表示
- フォーカスリングの色: `ring-blue-500` (WCAG AA 準拠のコントラスト比)
- リングの太さ: 2px (`ring-2`)
- リングのオフセット: 2px (`ring-offset-2`)

#### 色のコントラスト
- テキストと背景のコントラスト比: 最低 4.5:1 (WCAG AA)
- エラーメッセージ: `text-red-700` on white (7.0:1)
- 成功メッセージ: `text-green-700` on white (4.7:1)
- 情報メッセージ: `text-blue-700` on white (5.1:1)
- ボーダー: 2px の太さで視認性を向上

#### 状態の視覚化
- 編集中: 青いリング + "編集中" バッジ
- 保存中: スピナーアニメーション + "保存中..." テキスト
- 保存完了: チェックマーク + "保存しました" テキスト
- エラー: 警告アイコン + エラーメッセージ
- 読み取り専用: ロックアイコン + グレー背景

### 4. スクリーンリーダー対応

#### 動的コンテンツの通知
```tsx
<div 
  className="sr-only" 
  role="status" 
  aria-live="polite" 
  aria-atomic="true"
>
  {announcement}
</div>
```

#### 通知される内容
- 編集モード開始: "〇〇の編集を開始しました"
- 保存中: "保存中です"
- 保存完了: "保存が完了しました"
- エラー発生: "エラー: 〇〇"
- 競合検出: "編集の競合が検出されました。解決が必要です"

#### 装飾的要素の非表示
- アイコンに `aria-hidden="true"` を設定
- スクリーンリーダーには意味のあるテキストのみを読み上げ

### 5. フォームバリデーション

#### 必須フィールド
- 必須フィールドに `aria-required="true"` を設定
- バリデーションルールに基づいて自動設定

#### エラーハンドリング
- バリデーションエラーを即座に表示
- エラーメッセージをフィールドに関連付け
- エラー状態を視覚的およびプログラム的に示す

## テスト方法

### キーボードのみでのテスト
1. Tab キーでフィールド間を移動できることを確認
2. Enter/Space キーで編集モードを開始できることを確認
3. Escape キーで編集をキャンセルできることを確認
4. Tab/Shift+Tab で保存しながら移動できることを確認

### スクリーンリーダーでのテスト
1. NVDA (Windows) または VoiceOver (Mac) を使用
2. すべてのフィールドが適切に読み上げられることを確認
3. 状態変化（編集中、保存中など）が通知されることを確認
4. エラーメッセージが読み上げられることを確認

### 色覚異常のテスト
1. ブラウザの開発者ツールで色覚異常シミュレーションを使用
2. エラー、成功、情報の状態が色だけでなくアイコンとテキストでも識別できることを確認

### コントラスト比のテスト
1. WAVE や axe DevTools などのアクセシビリティツールを使用
2. すべてのテキストが WCAG AA 基準（4.5:1）を満たすことを確認

## 既知の制限事項

### ブラウザサポート
- Internet Explorer 11: 一部の ARIA 属性が完全にサポートされていない可能性があります
- 古いバージョンのスクリーンリーダー: 最新の ARIA 仕様に対応していない場合があります

### 推奨環境
- Chrome/Edge 最新版 + NVDA 最新版
- Firefox 最新版 + NVDA 最新版
- Safari 最新版 + VoiceOver

## 参考資料

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [ARIA Authoring Practices Guide](https://www.w3.org/WAI/ARIA/apg/)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
